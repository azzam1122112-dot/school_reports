{# templates/500.html أو reports/templates/500.html حسب إعدادك #}
{% extends "base.html" %}

{% block title %}خطأ في الخادم (500){% endblock %}

{% block head %}
<style>
  /* 500 — Page-only polish (RTL + متوافق مع base/app.css) */
  .e500-wrap{ max-width: 860px; margin: 0 auto; padding: 28px 0; }
  .e500-card{
    border: 1px solid var(--line);
    background: linear-gradient(180deg, var(--card), var(--line-2));
    border-radius: 18px;
    box-shadow: 0 18px 55px rgba(2,6,23,.10);
    overflow: hidden;
  }
  .e500-top{
    padding: 18px 18px 10px;
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:12px;
  }
  .e500-badge{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding: 8px 12px;
    border-radius: 999px;
    font-weight: 950;
    font-size: .95rem;
    color:#fff;
    background: linear-gradient(135deg, #ef4444, #b91c1c);
    border: 1px solid rgba(255,255,255,.14);
    box-shadow: 0 14px 30px rgba(239,68,68,.18);
    white-space:nowrap;
  }
  .e500-body{ padding: 6px 18px 18px; }
  .e500-code{
    font-weight: 1000;
    letter-spacing: -1px;
    line-height: 1;
    font-size: clamp(3.2rem, 6vw, 4.6rem);
    margin: 10px 0 6px;
    color: var(--ink);
    opacity: .92;
  }
  .e500-title{
    margin: 0 0 10px;
    font-weight: 950;
    font-size: 1.15rem;
    color: var(--ink);
  }
  .e500-desc{
    margin: 0 0 16px;
    color: var(--muted);
    font-weight: 850;
    line-height: 1.9;
  }
  .e500-actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px; }

  .e500-debug{
    margin-top: 14px;
    border-radius: 14px;
    border: 1px solid rgba(239,68,68,.22);
    background: rgba(239,68,68,.08);
    padding: 12px;
    overflow:auto;
  }
  .e500-debug h4{
    margin: 0 0 8px;
    font-weight: 950;
    color: var(--ink);
    display:flex;
    gap:8px;
    align-items:center;
  }
  .e500-debug pre{
    margin: 0;
    white-space: pre-wrap;
    word-break: break-word;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: .92rem;
    direction: ltr;
    text-align: left;
    color: var(--ink);
  }

  /* Reduce motion */
  @media (prefers-reduced-motion: reduce){
    .e500-card{ box-shadow:none; }
  }
</style>
{% endblock %}

{% block content %}
<div class="e500-wrap">
  <div class="e500-card">
    <div class="e500-top">
      <div class="e500-badge">
        <i class="fa-solid fa-triangle-exclamation" style="opacity:.95"></i>
        حدث خطأ غير متوقع
      </div>

      <div style="color:var(--muted); font-weight:900; font-size:.95rem">
        سيتم تسجيل الخطأ تلقائياً
      </div>
    </div>

    <div class="e500-body">
      <div class="e500-code">500</div>
      <h2 class="e500-title">عذراً، حدث خطأ في الخادم.</h2>
      <p class="e500-desc">
        لا تقلق—تم تسجيل المشكلة وسنقوم بمراجعتها قريباً. جرّب تحديث الصفحة أو العودة للرئيسية.
      </p>

      {% if error and request.user.is_superuser %}
        <div class="e500-debug" dir="ltr">
          <h4><i class="fa-solid fa-bug" style="opacity:.85"></i> Debug Info</h4>
          <pre>{{ error }}</pre>
        </div>
      {% endif %}

      <div class="e500-actions">
        <a href="{% url 'reports:home' %}" class="btn btn-primary">
          <i class="fa-solid fa-house"></i> العودة للرئيسية
        </a>
        <a href="javascript:location.reload();" class="btn btn-ghost">
          <i class="fa-solid fa-rotate"></i> تحديث الصفحة
        </a>
        <a href="javascript:history.back();" class="btn">
          <i class="fa-solid fa-arrow-right"></i> رجوع
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
