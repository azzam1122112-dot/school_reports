{% extends "base.html" %}

{% block title %}ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ (Ø§Ù„Ù…Ù†ØµØ©){% endblock %}

{% block head %}
<style>
  /* 
     PLATFORM TICKETS 2026 â€” NEO-PROFESSIONAL
     Theme: Corporate Blue & Clean White
  */
  .plat-tickets-scope{
    --c-brand: #2563eb;
    --c-brand-light: #eff6ff;
    --c-ink: #0f172a;
    --c-muted: #64748b;
    --c-border: #e2e8f0;
    --c-bg: #f8fafc;
    --c-card: #ffffff;
    
    --shadow-soft: 0 4px 6px -1px rgba(0,0,0,0.05);
    --shadow-hard: 0 10px 15px -3px rgba(0,0,0,0.05);
    
    --radius-xl: 16px;
    --radius-lg: 12px;
    
    --ease: cubic-bezier(0.16, 1, 0.3, 1);
  }

  .plat-tickets-scope .wrap {
      max-width: 1400px; /* Wider for table */
      margin: 0 auto;
      padding: 24px;
      font-family: system-ui, -apple-system, sans-serif;
  }

  /* Header Section */
  .pt-header {
      background: linear-gradient(135deg, var(--c-brand), #1e40af);
      color: white;
      padding: 32px;
      border-radius: var(--radius-xl);
      margin-bottom: 24px;
      box-shadow: var(--shadow-hard);
      position: relative;
      overflow: hidden;
  }
  
  /* Decorative noise/pattern */
  .pt-header::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
  }

  .pt-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      z-index: 2;
      flex-wrap: wrap;
      gap: 16px;
  }

  .pt-title {
      font-size: 1.8rem;
      font-weight: 800;
      margin: 0;
      letter-spacing: -0.02em;
  }

  .pt-subtitle {
      opacity: 0.9;
      margin-top: 6px;
      font-size: 1.05rem;
  }

  .pt-actions .btn-glass {
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      padding: 10px 20px;
      border-radius: var(--radius-lg);
      text-decoration: none;
      font-weight: 600;
      transition: all 0.2s var(--ease);
      display: inline-flex;
      align-items: center;
      gap: 8px;
  }
  
  .pt-actions .btn-glass:hover {
      background: rgba(255,255,255,0.25);
      transform: translateY(-2px);
  }

  /* Filter & Search Bar */
  .pt-controls {
      background: var(--c-card);
      border: 1px solid var(--c-border);
      border-radius: var(--radius-xl);
      padding: 16px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-wrap: wrap;
      gap: 24px;
      align-items: center;
      justify-content: space-between;
  }

  .pt-filters {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 4px; /* Scrollbar space */
  }

  .filter-tab {
      padding: 8px 16px;
      border-radius: 99px;
      font-weight: 600;
      font-size: 0.92rem;
      color: var(--c-muted);
      background: transparent;
      border: 1px solid transparent; /* fixed layout shift */
      text-decoration: none;
      white-space: nowrap;
      transition: all 0.2s;
  }

  .filter-tab:hover {
      background: var(--c-bg);
      color: var(--c-ink);
  }

  .filter-tab.active {
      background: var(--c-brand-light);
      color: var(--c-brand);
      border-color: rgba(37,99,235,0.15);
  }

  .pt-search {
      flex-grow: 1;
      max-width: 400px;
      position: relative;
  }

  .pt-search input {
      width: 100%;
      padding: 10px 16px 10px 42px; /* RTL padding needs check */
      border: 1px solid var(--c-border);
      border-radius: var(--radius-lg);
      font-size: 0.95rem;
      transition: all 0.2s;
      background: var(--c-bg); /* Slight background */
  }

  .pt-search input:focus {
      background: white;
      border-color: var(--c-brand);
      outline: none;
      box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
  }

  .pt-search svg {
      position: absolute;
      left: 14px; /* RTL Logic: in RTL usually icons on right ? no standard is left for LTR. Let's force check dir */
      top: 50%;
      transform: translateY(-50%);
      color: var(--c-muted);
      pointer-events: none;
  }
  
  /* RTL specific fix for search icon */
  .plat-tickets-scope[dir="rtl"] .pt-search input { padding: 10px 42px 10px 16px; }
  .plat-tickets-scope[dir="rtl"] .pt-search svg { left: auto; right: 14px; }

  /* Table */
  .pt-table-card {
      background: var(--c-card);
      border: 1px solid var(--c-border);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-soft);
      overflow: hidden;
  }

  .pt-table-responsive {
      width: 100%;
      overflow-x: auto;
  }

  .pt-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 900px;
  }

  .pt-table th {
      background: #f8fafc;
      text-align: right;
      padding: 16px 20px;
      font-weight: 700;
      color: var(--c-muted);
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      border-bottom: 1px solid var(--c-border);
  }

  .pt-table td {
      padding: 16px 20px;
      border-bottom: 1px solid var(--c-border);
      color: var(--c-ink);
      vertical-align: middle;
      font-size: 0.95rem;
      transition: background 0.1s;
  }

  .pt-table tr:hover td {
      background: rgba(241,245,249, 0.5);
  }

  .pt-table tr:last-child td { border-bottom: none; }

  /* Table Cells */
  .cell-primary {
      font-weight: 600;
      color: var(--c-ink);
  }

  .cell-sub {
      font-size: 0.85rem;
      color: var(--c-muted);
      display: block;
      margin-top: 2px;
  }

  .cell-mono {
      font-family: 'SF Mono', Consolas, monospace;
      font-size: 0.9em;
      color: var(--c-muted);
  }

  /* Chips */
  .pt-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      background: #f1f5f9;
      border-radius: 99px;
      font-size: 0.85rem;
      color: #475569;
      font-weight: 600;
      border: 1px solid #e2e8f0;
  }
  
  .pt-chip.city {
      background: #e0f2fe;
      color: #0369a1;
      border-color: #bae6fd;
  }

  /* Status Badges */
  .pt-badge {
      padding: 6px 12px;
      border-radius: 99px;
      font-size: 0.82rem;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 6px;
  }
  
  .pt-badge.open { background: #eff6ff; color: #2563eb; border: 1px solid #bfdbfe; }
  .pt-badge.in_progress { background: #fffbeb; color: #b45309; border: 1px solid #fde68a; }
  .pt-badge.done { background: #f0fdf4; color: #166534; border: 1px solid #bbf7d0; }
  .pt-badge.rejected { background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }

  /* Empty State */
  .pt-empty {
      text-align: center;
      padding: 48px;
      color: var(--c-muted);
  }
  .pt-empty-icon {
      font-size: 3rem;
      margin-bottom: 16px;
      opacity: 0.3;
  }

</style>
{% endblock %}

{% block content %}
<div class="plat-tickets-scope" dir="rtl">
    <div class="wrap">
        
        <!-- Header -->
        <header class="pt-header">
            <div class="pt-title-row">
                <div>
                    <h1 class="pt-title">ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</h1>
                    <p class="pt-subtitle">Ø¥Ø¯Ø§Ø±Ø© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙˆØ§Ø±Ø¯Ø© Ù…Ù† Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ (Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©).</p>
                </div>
                <div class="pt-actions">
                    <a href="{% url 'reports:platform_admin_dashboard' %}" class="btn-glass">
                        <span>Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</span>
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
                    </a>
                </div>
            </div>
        </header>

        <!-- Controls -->
        <div class="pt-controls">
            <!-- Filter Tabs -->
            <div class="pt-filters">
                <a href="?status=all&q={{ search_query }}" class="filter-tab {% if not current_status or current_status == 'all' %}active{% endif %}">Ø§Ù„ÙƒÙ„</a>
                <a href="?status=open&q={{ search_query }}" class="filter-tab {% if current_status == 'open' %}active{% endif %}">Ø¬Ø¯ÙŠØ¯</a>
                <a href="?status=in_progress&q={{ search_query }}" class="filter-tab {% if current_status == 'in_progress' %}active{% endif %}">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</a>
                <a href="?status=done&q={{ search_query }}" class="filter-tab {% if current_status == 'done' %}active{% endif %}">Ù…ÙƒØªÙ…Ù„</a>
                <a href="?status=rejected&q={{ search_query }}" class="filter-tab {% if current_status == 'rejected' %}active{% endif %}">Ù…Ø±ÙÙˆØ¶</a>
            </div>

            <!-- Search Form -->
            <form method="get" class="pt-search" action="">
                {% if current_status %}<input type="hidden" name="status" value="{{ current_status }}">{% endif %}
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                <input type="text" name="q" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©ØŒ Ø§Ù„ÙƒÙˆØ¯ØŒ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø©..." value="{{ search_query }}">
            </form>
        </div>

        <!-- Data Table -->
        <div class="pt-table-card">
            <div class="pt-table-responsive">
                <table class="pt-table">
                    <thead>
                        <tr>
                            <th width="80">#</th>
                            <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                            <th>Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</th>
                            <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
                            <th>Ø§Ù„Ù…Ø±Ø³Ù„</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th width="100">Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ticket in tickets %}
                        <tr>
                            <td>
                                <span class="cell-mono">#{{ ticket.id }}</span>
                            </td>
                            
                            <td>
                                <div class="cell-primary">{{ ticket.title }}</div>
                            </td>

                            <td>
                                <div class="cell-primary">{% firstof ticket.school.name ticket.school "â€”" %}</div>
                                <span class="cell-sub cell-mono">{% firstof ticket.school.code "" %}</span>
                            </td>
                            
                            <td>
                                {% if ticket.school and ticket.school.city %}
                                    <span class="pt-chip city">
                                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                                        {{ ticket.school.city }}
                                    </span>
                                {% else %}
                                    <span class="cell-sub">â€”</span>
                                {% endif %}
                            </td>

                            <td>
                                <div class="cell-primary">{% firstof ticket.creator.name ticket.creator.username %}</div>
                                <span class="cell-sub">{% firstof ticket.creator.phone "â€”" %}</span>
                            </td>

                            <td>
                                <div class="cell-primary">{{ ticket.created_at|date:"Y-m-d" }}</div>
                                <span class="cell-sub">{{ ticket.created_at|date:"H:i A" }}</span>
                            </td>

                            <td>
                                {% if ticket.status == 'open' %}
                                    <span class="pt-badge open">Ø¬Ø¯ÙŠØ¯</span>
                                {% elif ticket.status == 'in_progress' %}
                                    <span class="pt-badge in_progress">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</span>
                                {% elif ticket.status == 'done' %}
                                    <span class="pt-badge done">Ù…ÙƒØªÙ…Ù„</span>
                                {% elif ticket.status == 'rejected' %}
                                    <span class="pt-badge rejected">Ù…Ø±ÙÙˆØ¶</span>
                                {% endif %}
                            </td>

                            <td>
                                <a href="{% url 'reports:ticket_detail' ticket.id %}" class="btn btn-sm btn-outline-primary" style="border-radius:8px;">
                                    Ø¹Ø±Ø¶
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="8">
                                <div class="pt-empty">
                                    <div class="pt-empty-icon">ğŸ“‚</div>
                                    <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°Ø§ÙƒØ± Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
                                    <p>Ø­Ø§ÙˆÙ„ ØªØºÙŠÙŠØ± ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ù„Ø­Ø§Ù„Ø©.</p>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
    </div>
</div>
{% endblock %}
