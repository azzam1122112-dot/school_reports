{# templates/reports/department_members.html (Ø£Ùˆ Ø§Ø³Ù… Ù…Ù„ÙÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠ) #}
{% extends "base.html" %}
{% load static %}
{% block title %}Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù‚Ø³Ù…{% endblock %}

{% block head %}
<style>
  /* A11y */
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

  /* Scope tokens */
  .dept-scope{
    --ink:#0f172a;--muted:#64748b;--line:#e2e8f0;--card:#ffffff;--bg:#f8fafc;
    --brand:#2563eb;--brand2:#3b82f6;--danger:#b91c1c;--ok:#16a34a;--warn:#d97706;
    --shadow:0 10px 30px rgba(2,6,23,.08);
    --r:16px;--rsm:12px;--t:all .2s ease;
  }
  .dept-scope .wrap{max-width:1100px;margin-inline:auto;padding:16px}
  .dept-scope .header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:16px;flex-wrap:wrap}
  .dept-scope .breadcrumbs{font-size:.9rem;color:var(--muted)}
  .dept-scope .breadcrumbs a{color:inherit;text-decoration:none}
  .dept-scope .title{font-size:1.35rem;font-weight:950;margin:.25rem 0;color:var(--ink)}
  .dept-scope .sub{font-size:.95rem;color:var(--muted)}

  /* Stats pills */
  .dept-scope .stats{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:flex-end}
  .dept-scope .badge{
    display:inline-flex;align-items:center;gap:8px;
    background:#eef2ff;color:#3730a3;border:1px solid rgba(55,48,163,.18);
    border-radius:999px;padding:6px 10px;font-size:.85rem;font-weight:900
  }

  /* Bar */
  .dept-scope .bar{
    display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;
    background:var(--card);border:1px solid var(--line);border-radius:var(--r);
    padding:12px;box-shadow:0 6px 18px rgba(2,6,23,.06)
  }

  /* Forms */
  .dept-scope .hform{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .dept-scope .hform select,.dept-scope .hform button,.dept-scope .hform a{height:40px}
  .dept-scope select{
    min-width:240px;border:1px solid var(--line);border-radius:12px;padding:0 12px;background:var(--card);
    outline:none;transition:var(--t)
  }
  .dept-scope select:focus{border-color:var(--brand2);box-shadow:0 0 0 3px rgba(59,130,246,.14)}
  .dept-scope .btn{
    border:1px solid var(--line);background:#111827;color:#fff;border-radius:12px;padding:0 14px;
    cursor:pointer;transition:var(--t);display:inline-flex;align-items:center;gap:8px;font-weight:900;text-decoration:none
  }
  .dept-scope .btn:hover{transform:translateY(-1px);filter:saturate(1.05)}
  .dept-scope .btn-secondary{background:#f3f4f6;color:#111827}
  .dept-scope .btn-secondary:hover{background:#e5e7eb}
  .dept-scope .btn-danger{background:var(--danger);border-color:transparent}
  .dept-scope .btn-danger:hover{filter:brightness(.95)}
  .dept-scope .btn:disabled{opacity:.6;cursor:not-allowed;transform:none}

  /* Tools */
  .dept-scope .tools{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .dept-scope .search{position:relative}
  .dept-scope .search input{
    height:40px;border:1px solid var(--line);border-radius:12px;padding:0 40px 0 12px;min-width:260px;background:var(--card);
    outline:none;transition:var(--t)
  }
  .dept-scope .search input:focus{border-color:var(--brand2);box-shadow:0 0 0 3px rgba(59,130,246,.14)}
  .dept-scope .search svg{position:absolute;inset-inline-end:12px;top:50%;transform:translateY(-50%);width:18px;height:18px;opacity:.6}
  .dept-scope .hint{font-size:.88rem;color:var(--muted);font-weight:850;margin-top:6px}

  /* Grid */
  .dept-scope .grid{display:grid;gap:12px;margin-top:14px}
  @media (min-width:640px){.dept-scope .grid{grid-template-columns:repeat(2,1fr)}}
  @media (min-width:980px){.dept-scope .grid{grid-template-columns:repeat(3,1fr)}}

  .dept-scope .member-card{
    display:flex;align-items:center;gap:12px;background:var(--card);border:1px solid var(--line);
    border-radius:var(--r);padding:12px;box-shadow:0 6px 18px rgba(2,6,23,.05)
  }
  .dept-scope .avatar{
    width:44px;height:44px;border-radius:50%;display:grid;place-items:center;font-weight:950;
    background:#eef2ff;color:#3730a3;border:1px solid rgba(55,48,163,.18)
  }
  .dept-scope .name{font-weight:950;color:var(--ink);line-height:1.2}
  .dept-scope .meta{font-size:.85rem;color:var(--muted);font-weight:800}
  .dept-scope .role-pill{
    display:inline-flex;align-items:center;gap:6px;
    border-radius:999px;padding:6px 10px;font-size:.82rem;font-weight:950;border:1px solid rgba(0,0,0,.06)
  }
  .dept-scope .role-officer{background:#eef2ff;color:#3730a3}
  .dept-scope .role-member{background:#ecfeff;color:#155e75}
  .dept-scope .actions{margin-inline-start:auto;display:flex;gap:6px;flex-wrap:wrap}

  .dept-scope .empty{
    border:1px dashed var(--line);border-radius:var(--r);padding:20px;text-align:center;color:var(--muted);
    background:rgba(148,163,184,.08);font-weight:900
  }

  /* Mobile polish */
  @media (max-width:560px){
    .dept-scope .search input{min-width:220px;width:100%}
    .dept-scope select{min-width:220px;width:100%}
    .dept-scope .hform{width:100%}
  }
</style>
{% endblock head %}

{% block content %}
<div class="dept-scope">
  <div class="wrap" dir="rtl">
    <div class="header">
      <div>
        <div class="breadcrumbs">
          <a href="{% url 'reports:admin_dashboard' %}">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</a> Â·
          <a href="{% url 'reports:departments_list' %}">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</a> Â·
          <span>Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</span>
        </div>
        <h1 class="title">ğŸ‘¥ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù‚Ø³Ù…: {% firstof department.name dept_label dept_code "-" %}</h1>
        <div class="sub">
          {% if has_dept_model %}ÙˆØ¶Ø¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…ÙÙ‡ÙŠÙƒÙ„ (Department/Member){% else %}ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„ØªØ±Ø§Ø«ÙŠ (Teacher.role){% endif %}
        </div>
      </div>

      <div class="stats" aria-label="Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„Ù‚Ø³Ù…">
        <span class="badge">Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù‚Ø³Ù…: {{ officers|length }}</span>
        <span class="badge">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠÙˆÙ†: {{ teachers|length }}</span>
        <span class="badge">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ù„Ù‘Ù…ÙŠÙ†: {{ all_teachers|length }}</span>
      </div>
    </div>

    <div class="bar">
      <form class="hform" method="post" action="">
        {% csrf_token %}
        <input type="hidden" name="action" value="add">
        <label for="teacher_id" class="sr-only">Ø¥Ø³Ù†Ø§Ø¯ Ù„Ù…Ø¹Ù„Ù‘Ù…</label>
        <select id="teacher_id" name="teacher_id" required>
          <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ù„Ù‘Ù…</option>
          {% for t in available_teachers %}
            <option value="{{ t.id }}">{{ t.name }}</option>
          {% endfor %}
        </select>
        <button type="submit" class="btn">Ø¥Ø³Ù†Ø§Ø¯</button>
        <a href="{% url 'reports:departments_list' %}" class="btn btn-secondary">Ø±Ø¬ÙˆØ¹</a>
      </form>

      <form class="hform" method="post" action="">
        {% csrf_token %}
        <input type="hidden" name="action" value="set_officer">
        <label for="officer_id" class="sr-only">ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù‚Ø³Ù…</label>
        <select id="officer_id" name="teacher_id" required>
          <option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù‚Ø³Ù…</option>
          {% for t in all_teachers %}
            <option value="{{ t.id }}">{{ t.name }}</option>
          {% endfor %}
        </select>
        <button type="submit" class="btn">ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„</button>
      </form>

      <div class="tools">
        <div class="search">
          <input id="q" type="search" placeholder="Ø§Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡â€¦" autocomplete="off" spellcheck="false" aria-label="Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M21 21l-4.2-4.2M10.8 18a7.2 7.2 0 1 1 0-14.4 7.2 7.2 0 0 1 0 14.4z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
        </div>
      </div>
    </div>

    {% if officers or teachers %}
      <div id="membersGrid" class="grid" aria-live="polite" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù‚Ø³Ù…">
        {% for m in officers %}
          <div class="member-card" data-name="{{ m.name|default_if_none:'' }}" data-type="officer">
            <div class="avatar" aria-hidden="true">{{ m.name|default:"ØŸ"|slice:":2" }}</div>
            <div>
              <div class="name">{{ m.name }}</div>
              <div class="meta">
                <span class="role-pill role-officer"><i class="fas fa-user-shield"></i> Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù‚Ø³Ù…</span>
              </div>
            </div>
            <div class="actions">
              <form method="post" onsubmit="return confirm('Ø¥Ù„ØºØ§Ø¡ ØªÙƒÙ„ÙŠÙ {{ m.name }} Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…ØŸ');">
                {% csrf_token %}
                <input type="hidden" name="action" value="remove">
                <input type="hidden" name="teacher_id" value="{{ m.id }}">
                <button type="submit" class="btn btn-danger">Ø¥Ù„ØºØ§Ø¡</button>
              </form>
            </div>
          </div>
        {% endfor %}

        {% for m in teachers %}
          <div class="member-card" data-name="{{ m.name|default_if_none:'' }}" data-type="member">
            <div class="avatar" aria-hidden="true">{{ m.name|default:"ØŸ"|slice:":2" }}</div>
            <div>
              <div class="name">{{ m.name }}</div>
              <div class="meta">
                <span class="role-pill role-member"><i class="fas fa-id-badge"></i> Ø¹Ø¶Ùˆ</span>
              </div>
            </div>
            <div class="actions">
              <form method="post" onsubmit="return confirm('Ø¥Ù„ØºØ§Ø¡ ØªÙƒÙ„ÙŠÙ {{ m.name }} Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…ØŸ');">
                {% csrf_token %}
                <input type="hidden" name="action" value="remove">
                <input type="hidden" name="teacher_id" value="{{ m.id }}">
                <button type="submit" class="btn btn-danger">Ø¥Ù„ØºØ§Ø¡</button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>

      <div class="hint" id="resultHint" aria-live="polite"></div>
    {% else %}
      <div class="empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø¶ÙˆÙŠØ§Øª Ø¨Ø¹Ø¯. Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¥Ø³Ù†Ø§Ø¯ Ø£ÙˆÙ„ Ù…Ø¹Ù„Ù‘Ù….</div>
    {% endif %}
  </div>
</div>

<script>
  // ÙÙ„ØªØ±Ø© ÙÙˆØ±ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù… (Ø¨Ø¯ÙˆÙ† Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ø´Ø¨ÙƒØ©)
  (function(){
    const input = document.getElementById('q');
    const grid  = document.getElementById('membersGrid');
    const hint  = document.getElementById('resultHint');
    if(!input || !grid) return;

    function apply(){
      const q = (input.value || '').trim().toLowerCase();
      const cards = Array.from(grid.querySelectorAll('.member-card'));
      let shown = 0;
      cards.forEach(function(c){
        const name = (c.dataset.name || '').toLowerCase();
        const ok = !q || name.includes(q);
        c.style.display = ok ? '' : 'none';
        if(ok) shown += 1;
      });
      if(hint){
        hint.textContent = q ? ('Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ' + shown) : ('Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ' + shown);
      }
      grid.setAttribute('aria-label', 'Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ' + shown);
    }

    input.addEventListener('input', apply);
    apply();
  })();
</script>
{% endblock content %}
