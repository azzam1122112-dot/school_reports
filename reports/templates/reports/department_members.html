{# templates/reports/department_members.html (Ø£Ùˆ Ø§Ø³Ù… Ù…Ù„ÙÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠ) #}
{% extends "base.html" %}
{% load static %}
{% block title %}Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù‚Ø³Ù…{% endblock %}

{% block head %}
<style>
  /* =========================================================
     Department Members (scoped + RTL + safe)
     - Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹Ø±ÙŠÙ .btn/.card Ø§Ù„Ø¹Ø§Ù…Ø©
     - Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ data-theme (ÙØ§ØªØ­/Ø¯Ø§ÙƒÙ†)
     - Ø¨Ø¯ÙˆÙ† blocks/includes Ø¯Ø§Ø®Ù„ include
     ========================================================= */

  /* A11y */
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

  /* Scope */
  .dept-scope{
    --shadow: 0 10px 30px rgba(2,6,23,.08);
    --r: 16px;
    --rsm: 12px;
    --t: var(--t-fast);
  }
  .dept-scope .wrap{max-width:1100px;margin-inline:auto;padding:16px}

  /* Header */
  .dept-scope .header{
    display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:16px;flex-wrap:wrap
  }
  .dept-scope .header-actions{
    display:flex;
    flex-direction:column;
    align-items:flex-end;
    gap:10px;
  }
  .dept-scope .breadcrumbs{font-size:.92rem;color:var(--muted);font-weight:850}
  .dept-scope .breadcrumbs a{color:inherit;text-decoration:none}
  .dept-scope .breadcrumbs a:hover{text-decoration:underline}
  .dept-scope .title{font-size:1.35rem;font-weight:950;margin:.25rem 0;color:var(--ink)}
  .dept-scope .sub{font-size:.95rem;color:var(--muted);font-weight:850}

  /* Stats chips */
  .dept-scope .stats{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:flex-end}
  .dept-scope .badge{
    display:inline-flex;align-items:center;gap:8px;
    background: rgba(37,99,235,.08);
    color: rgba(30,64,175,.95);
    border: 1px solid rgba(37,99,235,.18);
    border-radius:999px;
    padding:6px 10px;
    font-size:.85rem;
    font-weight:950
  }
  html[data-theme="dark"] .dept-scope .badge{
    background: rgba(37,99,235,.14);
    color: rgba(219,234,254,.95);
    border-color: rgba(37,99,235,.26);
  }

  /* Bar */
  .dept-scope .bar{
    display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;
    background:var(--card);
    border:1px solid var(--line);
    border-radius:var(--r);
    padding:12px;
    box-shadow:0 6px 18px rgba(2,6,23,.06)
  }

  /* Forms + controls */
  .dept-scope .hform{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .dept-scope .hform select,.dept-scope .hform button,.dept-scope .hform a{min-height:40px}
  .dept-scope select{
    min-width:240px;
    border:1px solid var(--line);
    border-radius:12px;
    padding:0 12px;
    background:var(--card);
    outline:none;
    transition: var(--t);
    font-weight:900;
    color: var(--ink);
  }
  .dept-scope select:focus{
    border-color: rgba(59,130,246,.55);
    box-shadow: 0 0 0 3px rgba(59,130,246,.14);
  }

  /* Local buttons (Ù„Ø§ Ù†Ù„Ù…Ø³ .btn Ø§Ù„Ø¹Ø§Ù…Ø©) */
  .dept-scope .d-btn{
    border:1px solid var(--line);
    background:#111827;
    color:#fff;
    border-radius:12px;
    padding:0 14px;
    cursor:pointer;
    transition: var(--t);
    display:inline-flex;
    align-items:center;
    gap:8px;
    font-weight:950;
    text-decoration:none;
    white-space:nowrap;
  }
  .dept-scope .d-btn:hover{transform:translateY(-1px);filter:saturate(1.05)}
  .dept-scope .d-btn:disabled{opacity:.6;cursor:not-allowed;transform:none}

  .dept-scope .d-btn-secondary{background: var(--line-2); color: var(--ink)}
  .dept-scope .d-btn-secondary:hover{background: rgba(148,163,184,.18)}

  .dept-scope .d-btn-danger{
    background: rgba(185,28,28,.96);
    border-color: rgba(185,28,28,.20);
  }
  .dept-scope .d-btn-danger:hover{filter:brightness(.95)}

  /* Tools */
  .dept-scope .tools{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .dept-scope .search{position:relative}
  .dept-scope .search input{
    min-height:40px;
    border:1px solid var(--line);
    border-radius:12px;
    padding:0 40px 0 12px;
    min-width:260px;
    background:var(--card);
    outline:none;
    transition: var(--t);
    font-weight:900;
    color: var(--ink);
  }
  .dept-scope .search input:focus{
    border-color: rgba(59,130,246,.55);
    box-shadow: 0 0 0 3px rgba(59,130,246,.14);
  }
  .dept-scope .search svg{
    position:absolute;inset-inline-end:12px;top:50%;
    transform:translateY(-50%);
    width:18px;height:18px;opacity:.6;
    color: var(--muted);
  }
  .dept-scope .hint{font-size:.9rem;color:var(--muted);font-weight:850;margin-top:8px}

  /* Grid */
  .dept-scope .grid{display:grid;gap:12px;margin-top:14px}
  @media (min-width:640px){.dept-scope .grid{grid-template-columns:repeat(2,1fr)}}
  @media (min-width:980px){.dept-scope .grid{grid-template-columns:repeat(3,1fr)}}

  .dept-scope .member-card{
    display:flex;align-items:center;gap:12px;
    background:var(--card);
    border:1px solid var(--line);
    border-radius:var(--r);
    padding:12px;
    box-shadow:0 6px 18px rgba(2,6,23,.05);
    transition: var(--t);
  }
  .dept-scope .member-card:hover{
    transform: translateY(-1px);
    box-shadow: 0 14px 30px rgba(2,6,23,.08);
  }

  .dept-scope .avatar{
    width:44px;height:44px;border-radius:50%;
    display:grid;place-items:center;font-weight:950;
    background: rgba(37,99,235,.10);
    color: rgba(30,64,175,.95);
    border:1px solid rgba(37,99,235,.18);
    flex: 0 0 auto;
  }
  html[data-theme="dark"] .dept-scope .avatar{
    background: rgba(37,99,235,.16);
    color: rgba(219,234,254,.95);
    border-color: rgba(37,99,235,.28);
  }

  .dept-scope .name{font-weight:950;color:var(--ink);line-height:1.2}
  .dept-scope .meta{font-size:.85rem;color:var(--muted);font-weight:850;margin-top:6px}

  .dept-scope .role-pill{
    display:inline-flex;align-items:center;gap:6px;
    border-radius:999px;padding:6px 10px;
    font-size:.82rem;font-weight:950;
    border:1px solid rgba(0,0,0,.06);
    background: rgba(148,163,184,.10);
    color: var(--ink);
  }
  html[data-theme="dark"] .dept-scope .role-pill{
    border-color: rgba(148,163,184,.18);
    background: rgba(148,163,184,.12);
  }

  .dept-scope .role-officer{background: rgba(37,99,235,.10); color: rgba(30,64,175,.98); border-color: rgba(37,99,235,.18)}
  html[data-theme="dark"] .dept-scope .role-officer{background: rgba(37,99,235,.16); color: rgba(219,234,254,.95); border-color: rgba(37,99,235,.28)}

  .dept-scope .role-member{background: rgba(16,185,129,.10); color: rgba(6,95,70,.98); border-color: rgba(16,185,129,.18)}
  html[data-theme="dark"] .dept-scope .role-member{background: rgba(16,185,129,.14); color: rgba(209,250,229,.95); border-color: rgba(16,185,129,.26)}

  .dept-scope .actions{margin-inline-start:auto;display:flex;gap:6px;flex-wrap:wrap;align-items:center}

  .dept-scope .empty{
    border:1px dashed var(--line);
    border-radius:var(--r);
    padding:20px;
    text-align:center;
    color:var(--muted);
    background: linear-gradient(180deg, var(--card), var(--line-2));
    font-weight:950
  }

  /* Mobile */
  @media (max-width:560px){
    .dept-scope .search input{min-width:220px;width:100%}
    .dept-scope select{min-width:220px;width:100%}
    .dept-scope .hform{width:100%}
    .dept-scope .bar{gap:10px}
  }

  /* Reduce motion */
  @media (prefers-reduced-motion: reduce){
    .dept-scope *{transition:none !important}
    .dept-scope .member-card:hover,
    .dept-scope .d-btn:hover{transform:none !important}
  }
</style>
{% endblock head %}

{% block content %}
<div class="dept-scope">
  <div class="wrap" dir="rtl">
    <div class="header">
      <div>
        <div class="breadcrumbs">
          <a href="{% url 'reports:admin_dashboard' %}">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</a> Â·
          <a href="{% url 'reports:departments_list' %}">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</a> Â·
          <span>Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</span>
        </div>

        <h1 class="title">ğŸ‘¥ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù‚Ø³Ù…: {% firstof department.name dept_label dept_code "-" %}</h1>

        <div class="sub">
          {% if has_dept_model %}ÙˆØ¶Ø¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…ÙÙ‡ÙŠÙƒÙ„ (Department/Member){% else %}ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„ØªØ±Ø§Ø«ÙŠ (Teacher.role){% endif %}
        </div>
      </div>

      <div class="header-actions">
        <a href="{% url 'reports:departments_list' %}" class="d-btn d-btn-secondary">
          <i class="fa-solid fa-arrow-right" aria-hidden="true"></i> Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø£Ù‚Ø³Ø§Ù…
        </a>

        <div class="stats" aria-label="Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„Ù‚Ø³Ù…">
          <span class="badge">Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù‚Ø³Ù…: {{ officers|length }}</span>
          <span class="badge">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠÙˆÙ†: {{ teachers|length }}</span>
          <span class="badge">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ù„Ù‘Ù…ÙŠÙ†: {{ all_teachers|length }}</span>
        </div>
      </div>
    </div>

    <div class="bar">
      <form class="hform" method="post" action="">
        {% csrf_token %}
        <input type="hidden" name="action" value="add">

        <label for="teacher_id" class="sr-only">Ø¥Ø³Ù†Ø§Ø¯ Ù„Ù…Ø¹Ù„Ù‘Ù…</label>
        <select id="teacher_id" name="teacher_id" required>
          <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ù„Ù‘Ù…</option>
          {% for t in available_teachers %}
            <option value="{{ t.id }}">{{ t.name }}</option>
          {% endfor %}
        </select>

        <button type="submit" class="d-btn">
          <i class="fa-solid fa-user-plus" aria-hidden="true"></i> Ø¥Ø³Ù†Ø§Ø¯
        </button>

        <a href="{% url 'reports:departments_list' %}" class="d-btn d-btn-secondary">
          <i class="fa-solid fa-arrow-rotate-right" aria-hidden="true"></i> Ø±Ø¬ÙˆØ¹
        </a>
      </form>

      <form class="hform" method="post" action="">
        {% csrf_token %}
        <input type="hidden" name="action" value="set_officer">

        <label for="officer_id" class="sr-only">ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù‚Ø³Ù…</label>
        <select id="officer_id" name="teacher_id" required>
          <option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù‚Ø³Ù…</option>
          {% for t in all_teachers %}
            <option value="{{ t.id }}">{{ t.name }}</option>
          {% endfor %}
        </select>

        <button type="submit" class="d-btn">
          <i class="fa-solid fa-user-shield" aria-hidden="true"></i> ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„
        </button>
      </form>

      <div class="tools">
        <div class="search">
          <input
            id="q"
            type="search"
            placeholder="Ø§Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡â€¦"
            autocomplete="off"
            spellcheck="false"
            aria-label="Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡"
          >
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M21 21l-4.2-4.2M10.8 18a7.2 7.2 0 1 1 0-14.4 7.2 7.2 0 0 1 0 14.4z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
        </div>
      </div>
    </div>

    {% if officers or teachers %}
      <div id="membersGrid" class="grid" aria-live="polite" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù‚Ø³Ù…">
        {% for m in officers %}
          <div class="member-card" data-name="{{ m.name|default_if_none:'' }}" data-type="officer">
            <div class="avatar" aria-hidden="true">{{ m.name|default:"ØŸ"|slice:":2" }}</div>

            <div>
              <div class="name">{{ m.name }}</div>
              <div class="meta">
                <span class="role-pill role-officer">
                  <i class="fa-solid fa-user-shield" aria-hidden="true"></i> Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù‚Ø³Ù…
                </span>
              </div>
            </div>

            <div class="actions">
              <form method="post" onsubmit="return confirm('Ø¥Ù„ØºØ§Ø¡ ØªÙƒÙ„ÙŠÙ {{ m.name }} Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…ØŸ');">
                {% csrf_token %}
                <input type="hidden" name="action" value="remove">
                <input type="hidden" name="teacher_id" value="{{ m.id }}">
                <button type="submit" class="d-btn d-btn-danger">
                  <i class="fa-solid fa-user-minus" aria-hidden="true"></i> Ø¥Ù„ØºØ§Ø¡
                </button>
              </form>
            </div>
          </div>
        {% endfor %}

        {% for m in teachers %}
          <div class="member-card" data-name="{{ m.name|default_if_none:'' }}" data-type="member">
            <div class="avatar" aria-hidden="true">{{ m.name|default:"ØŸ"|slice:":2" }}</div>

            <div>
              <div class="name">{{ m.name }}</div>
              <div class="meta">
                <span class="role-pill role-member">
                  <i class="fa-solid fa-id-badge" aria-hidden="true"></i> Ø¹Ø¶Ùˆ
                </span>
              </div>
            </div>

            <div class="actions">
              <form method="post" onsubmit="return confirm('Ø¥Ù„ØºØ§Ø¡ ØªÙƒÙ„ÙŠÙ {{ m.name }} Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…ØŸ');">
                {% csrf_token %}
                <input type="hidden" name="action" value="remove">
                <input type="hidden" name="teacher_id" value="{{ m.id }}">
                <button type="submit" class="d-btn d-btn-danger">
                  <i class="fa-solid fa-user-minus" aria-hidden="true"></i> Ø¥Ù„ØºØ§Ø¡
                </button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>

      <div class="hint" id="resultHint" aria-live="polite"></div>
    {% else %}
      <div class="empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø¶ÙˆÙŠØ§Øª Ø¨Ø¹Ø¯. Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¥Ø³Ù†Ø§Ø¯ Ø£ÙˆÙ„ Ù…Ø¹Ù„Ù‘Ù….</div>
    {% endif %}
  </div>
</div>
{% endblock content %}

{% block scripts %}
<script>
  // ÙÙ„ØªØ±Ø© ÙÙˆØ±ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù… (Ø¨Ø¯ÙˆÙ† Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ø´Ø¨ÙƒØ©)
  (function(){
    var input = document.getElementById('q');
    var grid  = document.getElementById('membersGrid');
    var hint  = document.getElementById('resultHint');
    if(!input || !grid) return;

    function apply(){
      var q = (input.value || '').trim().toLowerCase();
      var cards = Array.prototype.slice.call(grid.querySelectorAll('.member-card'));
      var shown = 0;

      cards.forEach(function(c){
        var name = (c.getAttribute('data-name') || '').toLowerCase();
        var ok = !q || name.indexOf(q) !== -1;
        c.style.display = ok ? '' : 'none';
        if(ok) shown += 1;
      });

      if(hint){
        hint.textContent = q ? ('Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ' + shown) : ('Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ' + shown);
      }
      grid.setAttribute('aria-label', 'Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ' + shown);
    }

    input.addEventListener('input', apply);
    apply();
  })();
</script>
{% endblock scripts %}
