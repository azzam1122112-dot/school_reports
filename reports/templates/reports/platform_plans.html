{# reports/templates/reports/platform/plans_list.html (Ù…Ø«Ø§Ù„ Ø§Ø³Ù…) #}
{% extends "base.html" %}

{% block title %}Ø®Ø·Ø· Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ{% endblock %}

{% block head %}
<style>
  /* =========================================================
     PLANS (page-only) â€” Scoped Ø¯Ø§Ø®Ù„ .plans-scope ÙÙ‚Ø·
     - Ø¨Ø¯ÙˆÙ† Ù„Ù…Ø³ .btn / .card Ø§Ù„Ø¹Ø§Ù…Ø©
     - Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ data-theme
     ========================================================= */
  .plans-scope{
    --pl-brand: var(--brand, #2563eb);
    --pl-ink: var(--ink, #0f172a);
    --pl-muted: var(--muted, #64748b);
    --pl-line: var(--line-2, var(--line, #e5e7eb));
    --pl-card: var(--card, #fff);
    --pl-shadow: var(--shadow, 0 14px 36px rgba(2,6,23,.10));
    --pl-danger: var(--danger, #ef4444);
    --pl-ok: var(--accent, #10b981);
    --pl-t: var(--t-fast, .18s ease);
  }

  /* Head */
  .plans-scope .page-head{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
    margin-bottom: 12px;
  }
  .plans-scope .page-title{
    margin:0;
    font-weight:950;
    color:var(--pl-ink);
    letter-spacing:-.3px;
  }
  .plans-scope .page-subtitle{
    margin:6px 0 0;
    color:var(--pl-muted);
    font-weight:850;
    line-height:1.7;
  }

  .plans-scope .head-actions{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    justify-content:flex-start;
    align-items:center;
  }
  @media(max-width:560px){
    .plans-scope .head-actions{width:100%}
    .plans-scope .head-actions .btn{width:100%; justify-content:center}
  }

  /* Grid */
  .plans-scope .plans-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));
    gap:12px;
  }

  /* Card (Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ§Ø±Ø¯ Ø§Ù„Ø¹Ø§Ù…Ø©) */
  .plans-scope .p-card{
    position:relative;
    overflow:hidden;
    border-radius:16px;
    box-shadow: var(--pl-shadow);
    border:1px solid var(--pl-line);
    background: var(--pl-card);
    transition: var(--pl-t);
  }
  .plans-scope .p-card:hover{
    transform: translateY(-2px);
    box-shadow: 0 18px 46px rgba(2,6,23,.12);
  }
  .plans-scope .p-card::before{
    content:"";
    position:absolute;
    inset:0 0 auto 0;
    height:4px;
    background: linear-gradient(135deg, var(--pl-brand), #4f46e5 65%, var(--pl-ok));
    opacity:.95;
  }

  .plans-scope .p-body{
    padding: 14px;
  }

  .plans-scope .p-top{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:12px;
  }

  .plans-scope .p-name{
    margin:0;
    font-weight:950;
    font-size:1.06rem;
    color:var(--pl-ink);
  }

  .plans-scope .p-meta{
    margin-top:8px;
    display:grid;
    gap:6px;
    color:var(--pl-muted);
    font-weight:850;
    line-height:1.55;
  }

  .plans-scope .p-meta b{
    color:var(--pl-ink);
    font-weight:950;
  }

  .plans-scope .price{
    margin-top:12px;
    font-size:1.55rem;
    font-weight:950;
    color:var(--pl-brand);
    display:flex;
    align-items:baseline;
    gap:8px;
  }
  .plans-scope .price small{
    font-weight:900;
    color:var(--pl-muted);
    font-size:.9rem;
  }

  .plans-scope .desc{
    margin-top:10px;
    color:var(--pl-muted);
    font-weight:850;
    min-height:44px;
    line-height:1.75;
  }

  .plans-scope .p-actions{
    margin-top:14px;
    display:grid;
    gap:10px;
  }
  .plans-scope .btn-block{
    width:100%;
    justify-content:center;
  }

  /* Badge (Ø¢Ù…Ù†Ø© Ø­ØªÙ‰ Ù„Ùˆ Ù…Ø§ Ø¹Ù†Ø¯Ùƒ badge Ø¨Ø§Ù„Ù€app.css) */
  .plans-scope .badge{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(15,23,42,.10);
    background: rgba(148,163,184,.10);
    color: var(--pl-ink);
    font-weight:900;
    font-size:.85rem;
    white-space:nowrap;
  }
  .plans-scope .badge.success{
    background: rgba(16,185,129,.12);
    color: var(--pl-ok);
    border-color: rgba(16,185,129,.22);
  }

  /* Footer small bar */
  .plans-scope .p-foot{
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px dashed var(--pl-line);
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
    color: var(--pl-muted);
    font-weight:850;
    font-size:.95rem;
  }

  /* Empty */
  .plans-scope .empty{
    grid-column:1/-1;
    text-align:center;
    padding:22px;
    font-weight:900;
    color:var(--pl-muted);
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce){
    .plans-scope .p-card{ transition:none !important; }
    .plans-scope .p-card:hover{ transform:none !important; }
  }
</style>
{% endblock %}

{% block content %}
<div class="container plans-scope" dir="rtl">
  <div class="page-head">
    <div>
      <h1 class="page-title">Ø®Ø·Ø· Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h1>
      <p class="page-subtitle">Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ø¯Ø§Ø±Ø³.</p>
    </div>

    <div class="head-actions">
      <a href="{% url 'reports:platform_plan_add' %}" class="btn btn-primary">
        <i class="fa-solid fa-plus" aria-hidden="true"></i>
        Ø¥Ø¶Ø§ÙØ© Ø®Ø·Ø© Ø¬Ø¯ÙŠØ¯Ø©
      </a>

      <a href="{% url 'reports:platform_admin_dashboard' %}" class="btn btn-outline">
        <i class="fa-solid fa-arrow-right" aria-hidden="true"></i>
        Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†ØµØ©
      </a>
    </div>
  </div>

  <div class="plans-grid">
    {% for plan in plans %}
      <div class="card p-card">
        <div class="p-body">
          <div class="p-top">
            <div>
              <h3 class="p-name">{{ plan.name }}</h3>

              <div class="p-meta">
                <div>â±ï¸ Ø§Ù„Ù…Ø¯Ø©: <b>{{ plan.days_duration }}</b> ÙŠÙˆÙ…</div>
                <div>
                  ğŸ‘¥ Ø­Ø¯ {{ SCHOOL_TEACHERS_OBJ_LABEL|default:"Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†" }}:
                  {% if plan.max_teachers and plan.max_teachers > 0 %}
                    <b>{{ plan.max_teachers }}</b>
                  {% else %}
                    <b>ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯</b>
                  {% endif %}
                </div>
              </div>
            </div>

            {% if plan.is_active %}
              <span class="badge success">
                <i class="fa-solid fa-circle-check" aria-hidden="true"></i> ÙØ¹Ø§Ù„
              </span>
            {% else %}
              <span class="badge">
                <i class="fa-regular fa-circle" aria-hidden="true"></i> ØºÙŠØ± ÙØ¹Ø§Ù„
              </span>
            {% endif %}
          </div>

          <div class="price">
            {{ plan.price }} <small>Ø±ÙŠØ§Ù„</small>
          </div>

          <div class="desc">
            {{ plan.description|default:"â€”"|truncatechars:120 }}
          </div>

          <div class="p-actions">
            <a href="{% url 'reports:platform_plan_edit' plan.id %}" class="btn btn-outline btn-block">
              <i class="fa-solid fa-pen-to-square" aria-hidden="true"></i>
              ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø®Ø·Ø©
            </a>

            <form method="post" action="{% url 'reports:platform_plan_delete' plan.id %}" data-confirm="1">
              {% csrf_token %}
              <input type="hidden" name="next" value="{{ request.get_full_path }}">
              <button type="submit" class="btn btn-danger btn-block">
                <i class="fa-solid fa-trash" aria-hidden="true"></i>
                Ø­Ø°Ù Ø§Ù„Ø®Ø·Ø©
              </button>
            </form>
          </div>

          <div class="p-foot" aria-label="Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©">
            <span>Ø§Ù„Ù…Ø¹Ø±Ù‘Ù: <b style="color:var(--pl-ink)">{{ plan.id }}</b></span>
            {% if plan.updated_at %}
              <span>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span dir="ltr">{{ plan.updated_at|date:"Y-m-d H:i" }}</span></span>
            {% endif %}
          </div>
        </div>
      </div>
    {% empty %}
      <div class="card empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø·Ø· Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ø¶Ø§ÙØ©.</div>
    {% endfor %}
  </div>
</div>
{% endblock %}

{% block scripts %}
<script nonce="{{ CSP_NONCE }}">
  (function(){
    function onReady(fn){
      if(document.readyState === "loading") document.addEventListener("DOMContentLoaded", fn);
      else fn();
    }

    onReady(function(){
      document.querySelectorAll('form[data-confirm="1"]').forEach(function(f){
        f.addEventListener("submit", function(e){
          var ok = confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©ØŸ");
          if(!ok) e.preventDefault();
        });
      });
    });
  })();
</script>
{% endblock %}
