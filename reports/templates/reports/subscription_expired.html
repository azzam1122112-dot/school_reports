{# reports/templates/reports/subscription_expired.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}{% if subscription and subscription.is_cancelled %}الاشتراك ملغي{% else %}الاشتراك منتهي{% endif %}{% endblock %}

{% block head %}
<style>
  /* صفحة انتهاء الاشتراك — تحسينات محلية بدون لمس .btn / .card */
  .se-wrap{
    --t: var(--t-fast);
    padding: clamp(10px, 2vw, 18px);
  }
  .se-card{
    max-width: 860px;
    margin: 0 auto;
  }
  .se-top{
    display:flex;
    gap:14px;
    align-items:flex-start;
    flex-wrap:wrap;
  }
  .se-ico{
    width:64px;
    height:64px;
    border-radius: 18px;
    display:grid;
    place-items:center;
    background: var(--brand-ghost);
    border: 1px solid var(--line);
    font-size: 30px;
    flex: 0 0 auto;
  }
  .se-body{
    flex:1 1 320px;
    min-width: 260px;
  }
  .se-title{
    margin:0;
    font-weight: 950;
    letter-spacing: -.3px;
  }
  .se-sub{
    margin-top:6px;
    line-height: 1.9;
    font-weight: 850;
    color: var(--muted);
  }
  .se-sub b{ color: var(--ink); }

  .se-box{
    margin-top: 12px;
    padding: 14px;
    border: 1px solid var(--line);
    border-radius: 14px;
    background: linear-gradient(180deg, var(--line-2), var(--card));
  }
  .se-box-row{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    justify-content:space-between;
    align-items:center;
  }
  .se-box-ttl{
    font-weight: 950;
    color: var(--muted);
  }
  .se-box-val{
    font-weight: 950;
    color: var(--ink);
  }

  .se-hint{
    margin-top: 10px;
    font-weight: 850;
    color: var(--muted);
  }

  .se-actions{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top: 16px;
  }

  .se-help{
    margin-top: 14px;
    font-weight: 850;
    text-align: center;
    color: var(--muted);
  }
  .se-help a{
    font-weight: 900;
    color: var(--brand);
    text-decoration: none;
  }
  .se-help a:hover{ text-decoration: underline; }

  @media (prefers-reduced-motion: reduce){
    .se-wrap *{ transition:none !important; }
  }
</style>
{% endblock %}

{% block content %}
<div class="container se-wrap" dir="rtl">
  <section class="card se-card">
    <div class="se-top">
      <div class="se-ico" aria-hidden="true">⛔</div>

      <div class="se-body">
        <h1 class="page-title se-title">
          {% if subscription and subscription.is_cancelled %}
            عفوًا، تم إلغاء الاشتراك
          {% else %}
            عفوًا، انتهت فترة الاشتراك
          {% endif %}
        </h1>

        <p class="page-subtitle se-sub">
          {% if school %}
            {% if subscription and subscription.is_cancelled %}
              تم إلغاء اشتراك مدرسة <b>{{ school.name }}</b>.
            {% else %}
              انتهت صلاحية اشتراك مدرسة <b>{{ school.name }}</b>.
            {% endif %}
          {% else %}
            {% if subscription and subscription.is_cancelled %}
              تم إلغاء اشتراك المدرسة.
            {% else %}
              انتهت صلاحية اشتراك المدرسة.
            {% endif %}
          {% endif %}

          {% if user.is_authenticated and is_manager %}
            يمكنك تجديد الاشتراك لاستعادة الوصول.
          {% else %}
            لا يمكن استخدام المنصة حتى يتم تجديد الاشتراك.
          {% endif %}
        </p>

        <div class="se-box">
          <div class="se-box-row">
            <div class="se-box-ttl">تفاصيل الاشتراك</div>

            {% if subscription and subscription.end_date %}
              <div class="se-box-val">
                تاريخ الانتهاء:
                <span dir="ltr">{{ subscription.end_date|date:"Y-m-d" }}</span>
              </div>
            {% else %}
              <div class="se-box-ttl" style="font-weight:850">لا تتوفر تفاصيل اشتراك</div>
            {% endif %}
          </div>

          {% if subscription and subscription.is_cancelled and subscription.cancel_reason %}
            <div style="margin-top:10px; font-weight:900; color: var(--ink)">سبب الإلغاء</div>
            <div style="margin-top:6px; font-weight:850; color: var(--muted); line-height:1.9">
              {{ subscription.cancel_reason }}
            </div>
          {% endif %}
        </div>

        {% if user.is_authenticated and not is_manager %}
          <div class="se-hint">
            تواصل مع <b>مدير المدرسة</b> لتجديد الاشتراك.
          </div>
        {% endif %}
      </div>
    </div>

    <div class="se-actions">
      {% if user.is_authenticated %}
        {% if is_manager %}
          <a href="{% url 'reports:my_subscription' %}" class="btn btn-primary">
            تجديد الاشتراك
          </a>
        {% endif %}
        <a href="{% url 'reports:logout' %}" class="btn btn-outline">
          تسجيل الخروج
        </a>
      {% else %}
        <a href="{% url 'reports:login' %}" class="btn btn-primary">
          تسجيل الدخول
        </a>
      {% endif %}

      {# اختياري: افتح تذكرة دعم لو عندك المسار #}
      {# <a href="{% url 'reports:support_ticket_create' %}" class="btn">فتح تذكرة دعم</a> #}
    </div>

    <div class="se-help">
      للمساعدة: تواصل مع الدعم الفني عبر البريد الإلكتروني
      <a href="mailto:xmansx1122@gmail.com" dir="ltr">xmansx1122@gmail.com</a>
    </div>
  </section>
</div>
{% endblock %}
