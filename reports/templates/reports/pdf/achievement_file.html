{% load static %}
<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ملف إنجاز - {{ file.teacher_name }} - {{ file.academic_year }}</title>

  <style>
    /* =========================
       Print setup
       ========================= */
    @page { size: A4; margin: 14mm 12mm; }

    :root {
      --brand: {{ theme.brand|default:"#2563eb" }};
      --ink: #0f172a;
      --muted: #475569;
      --line: #e2e8f0;
      --soft: #f8fafc;
    }

    * { box-sizing: border-box; }
    body{
      font-family: DejaVu Sans, Arial, sans-serif;
      color: var(--ink);
      margin: 0;
      padding: 0;
      line-height: 1.65;
      background: #fff;
    }

    /* =========================
       Screen-only wrapper
       ========================= */
    .screen-only{ display:none; }

    @media screen {
      body{ background: #f1f5f9; }
      .screen-only{ display:block; }

      .screen-bar{
        max-width: 920px;
        margin: 12px auto 0;
        padding: 10px 12px;
        border: 1px solid var(--line);
        border-radius: 14px;
        background: #fff;
        display: flex;
        gap: 10px;
        align-items: center;
        justify-content: space-between;
      }

      .btn{
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 10px 14px;
        border-radius: 12px;
        border: 1px solid rgba(2,6,23,.08);
        background: var(--brand);
        color: #fff;
        font-weight: 900;
        text-decoration: none;
        cursor: pointer;
        box-shadow: 0 10px 24px rgba(2,6,23,.08);
      }
      .btn:active{ transform: translateY(1px); }

      .hint{
        color: var(--muted);
        font-size: 12px;
        font-weight: 800;
      }

      .paper{
        max-width: 920px;
        margin: 12px auto 16px;
        background: #fff;
        border: 1px solid rgba(2,6,23,.06);
        border-radius: 16px;
        padding: 14mm 12mm;
        box-shadow: 0 18px 50px rgba(2,6,23,.10);
      }
    }

    @media print{
      .screen-only{ display:none !important; }
      .paper{ padding: 0 !important; }
    }

    /* =========================
       Header (Hero)
       ========================= */
    .hero{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:18px;
      border-radius:14px;
      margin: 0 0 12px 0;
      background: linear-gradient(135deg, rgba(37,99,235,.92), rgba(16,185,129,.78));
      color:#fff;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
      border: 1px solid rgba(255,255,255,.14);
    }

    .hero-side{ flex:1; min-width:0; }
    .hero-right{ text-align:right; }
    .hero-left{ text-align:left; }

    .hero-center{
      flex:0 0 auto;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:6px;
      min-width: 92px;
    }

    .ministry-logo{
      width:74px;
      height:74px;
      object-fit:contain;
      background:#fff;
      border-radius:14px;
      padding:8px;
      border:1px solid rgba(255,255,255,.22);
    }

    .hero-school{
      margin:0;
      font-weight:950;
      font-size:18px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .hero-stage{
      margin-top:6px;
      opacity:.95;
      font-weight:850;
      font-size:13px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .hero-type-label{
      opacity:.98;
      font-weight:950;
      font-size:18px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .hero-teacher{
      margin-top:6px;
      opacity:.98;
      font-weight:900;
      font-size:15px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .hero-year{
      opacity:.95;
      font-weight:900;
      font-size:12.5px;
      white-space:nowrap;
    }

    /* =========================
       Sections
       ========================= */
    .section{
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px 14px;
      margin: 10px 0;
      background: #fff;
      break-inside: avoid;
      page-break-inside: avoid;
    }

    .section-title{
      margin: 0 0 8px;
      font-size: 14.5px;
      font-weight: 950;
      color: var(--ink);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .badge{
      display:inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(37,99,235,.25);
      background: rgba(37,99,235,.06);
      color: var(--ink);
      font-size: 12px;
      font-weight: 900;
      white-space:nowrap;
    }

    .two-col{ display: table; width: 100%; }
    .two-col .col{
      display: table-cell;
      vertical-align: top;
      width: 50%;
      padding-left: 10px;
    }

    .kv{ margin: 0 0 10px; }
    .k{
      font-weight: 950;
      color: var(--ink);
      font-size: 12.5px;
      margin: 0 0 2px 0;
    }
    .v{
      color: var(--muted);
      font-weight: 800;
      font-size: 12.5px;
      white-space: pre-line;
    }

    /* Evidence grid */
    .evidence{
      margin-top: 8px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }

    .evidence .cell{
      width: calc(25% - 4.5px);
      border: 1px solid var(--line);
      border-radius: 12px;
      overflow: hidden;
      background: var(--soft);
      height: 92px;
    }

    .evidence .cell img{
      width: 100%;
      height: 92px;
      object-fit: cover;
      display:block;
    }

    @media screen and (max-width: 680px){
      .evidence .cell{ width: calc(50% - 3px); }
      .two-col, .two-col .col{ display:block; width:100%; padding-left:0; }
    }

    .footer{
      margin-top: 12px;
      color: var(--muted);
      font-size: 11px;
      font-weight: 800;
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="screen-only screen-bar">
    <button class="btn" type="button" onclick="window.print()">طباعة / حفظ PDF</button>
    <div class="hint">من نافذة الطباعة اختر “Save as PDF” وألغِ “Headers and footers” لنتيجة مطابقة</div>
  </div>

  <div class="paper">
    <header class="hero">
      <div class="hero-side hero-right">
        <div class="hero-school">{{ school.name }}</div>
        <div class="hero-stage">{{ school.get_stage_display }}</div>
      </div>

      <div class="hero-center">
        <img class="ministry-logo" src="{% if ministry_logo_src %}{{ ministry_logo_src }}{% else %}{% static 'img/UntiTtled-1.png' %}{% endif %}" alt="شعار الوزارة">
        <div class="hero-year">{{ file.academic_year }} هـ</div>
      </div>

      <div class="hero-side hero-left">
        <div class="hero-type-label">ملف الإنجاز</div>
        <div class="hero-teacher">{{ file.teacher_name }}</div>
      </div>
    </header>

    <div class="section">
      <div class="section-title">
        <span>البيانات العامة</span>
        <span class="badge">العام الدراسي: {{ file.academic_year }} هـ</span>
      </div>

      <div class="two-col">
        <div class="col">
          <div class="kv">
            <div class="k">المؤهلات</div>
            <div class="v">{{ file.qualifications|default:"-" }}</div>
          </div>

          <div class="kv">
            <div class="k">الخبرات المهنية</div>
            <div class="v">{{ file.professional_experience|default:"-" }}</div>
          </div>

          <div class="kv">
            <div class="k">التخصص</div>
            <div class="v">{{ file.specialization|default:"-" }}</div>
          </div>
        </div>

        <div class="col">
          <div class="kv">
            <div class="k">نصاب الحصص</div>
            <div class="v">{{ file.teaching_load|default:"-" }}</div>
          </div>

          <div class="kv">
            <div class="k">مواد التدريس</div>
            <div class="v">{{ file.subjects_taught|default:"-" }}</div>
          </div>

          <div class="kv">
            <div class="k">بيانات التواصل</div>
            <div class="v">{{ file.contact_info|default:"-" }}</div>
          </div>
        </div>
      </div>
    </div>

    {% if file.manager_notes %}
      <div class="section">
        <div class="section-title"><span>ملاحظات المدير</span></div>
        <div class="v">{{ file.manager_notes|linebreaksbr }}</div>
      </div>
    {% endif %}

    {% for s in sections %}
      <div class="section">
        <div class="section-title">
          <span>{{ s.get_code_display }}</span>
          {% if s.is_completed %}<span class="badge">مكتمل</span>{% endif %}
        </div>

        <div class="kv">
          <div class="k">ملاحظات المعلّم</div>
          <div class="v">{{ s.teacher_notes|default:"-"|linebreaksbr }}</div>
        </div>

        {% with imgs=s.evidence_images.all %}
          {% if imgs %}
            <div class="kv">
              <div class="k">الشواهد (حتى 8)</div>
              <div class="evidence">
                {% for img in imgs|slice:":8" %}
                  <div class="cell"><img src="{{ img.image.url }}" alt="شاهد" /></div>
                {% endfor %}
              </div>
            </div>
          {% endif %}
        {% endwith %}
      </div>
    {% endfor %}

    <div class="footer">
      تم توليد هذا الملف آليًا من النظام — {{ now|date:"Y-m-d H:i" }}
    </div>
  </div>
</body>
</html>
