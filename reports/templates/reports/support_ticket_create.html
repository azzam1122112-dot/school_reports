{# reports/templates/reports/ticket_create.html (Ù…Ø«Ø§Ù„) #}
{% extends "base.html" %}
{% load static %}

{% block title %}Ø·Ù„Ø¨ Ø¯Ø¹Ù… ÙÙ†ÙŠ Ø¬Ø¯ÙŠØ¯{% endblock %}

{% block head %}
<style>
  /* =========================================================
     Ticket Create (page-only polish) â€” Ø¨Ø¯ÙˆÙ† Ù„Ù…Ø³ .btn / .card Ø§Ù„Ø¹Ø§Ù…Ø©
     - RTL
     - Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ theme variables ÙÙŠ base/app.css Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù†
     ========================================================= */

  .ticket-wrap{
    max-width: 860px;
    margin: 0 auto;
    padding: 16px;
    --t: var(--t-fast);
  }

  .ticket-hero{
    border-radius: 18px;
    padding: 16px 16px;
    background:
      radial-gradient(800px 220px at 10% 0%, rgba(255,255,255,.18), transparent 60%),
      radial-gradient(800px 260px at 95% 90%, rgba(16,185,129,.12), transparent 55%),
      linear-gradient(135deg, #2563eb 0%, #1e40af 55%, #0f2a6a 100%);
    color: #fff;
    border: 1px solid rgba(255,255,255,.14);
    box-shadow: 0 18px 50px rgba(2,6,23,.10);
    margin-bottom: 12px;
    position: relative;
    overflow: hidden;
  }
  .ticket-hero::before{
    content:"";
    position:absolute;
    inset:-2px;
    background:
      radial-gradient(closest-side, rgba(255,255,255,.14), transparent 60%) 20% 15%/220px 220px no-repeat,
      radial-gradient(closest-side, rgba(255,255,255,.10), transparent 60%) 85% 70%/260px 260px no-repeat;
    opacity:.85;
    pointer-events:none;
  }
  .ticket-hero-inner{
    position: relative;
    display:flex;
    align-items:flex-start;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
  }
  .ticket-hero h1{
    margin: 0;
    font-weight: 950;
    letter-spacing: -.4px;
    line-height: 1.2;
    font-size: clamp(1.25rem, 2.8vw, 1.7rem);
    color: #eef2ff;
    display:flex;
    align-items:center;
    gap: 10px;
  }
  .ticket-hero p{
    margin: 8px 0 0;
    color: rgba(255,255,255,.92);
    font-weight: 850;
    max-width: 760px;
  }

  /* Card */
  .ticket-card{
    border: 1px solid var(--line);
    background: var(--card);
    border-radius: 18px;
    box-shadow: 0 10px 30px rgba(2,6,23,.06);
    overflow: hidden;
  }
  .ticket-card-hd{
    padding: 14px 16px;
    border-bottom: 1px solid var(--line);
    background: linear-gradient(180deg, var(--line-2), var(--card));
    display:flex;
    align-items:center;
    justify-content: space-between;
    gap: 10px;
    flex-wrap: wrap;
  }
  .ticket-card-hd .hint{
    color: var(--muted);
    font-weight: 850;
  }

  .ticket-card-bd{
    padding: 16px;
  }

  /* Alerts */
  .t-alert{
    border-radius: 14px;
    border: 1px solid var(--line);
    padding: 12px 12px;
    margin-bottom: 14px;
    font-weight: 900;
    background: linear-gradient(180deg, var(--line-2), var(--card));
    color: var(--ink);
  }
  .t-alert.t-danger{
    border-color: rgba(239,68,68,.30);
    background: rgba(239,68,68,.08);
    color: #b91c1c;
  }

  /* Form */
  .t-form{
    display:grid;
    gap: 14px;
  }
  .t-group label{
    display:block;
    font-weight: 950;
    margin-bottom: 8px;
    color: var(--ink);
  }

  /* Ù†Ù†Ø³Ù‘Ù‚ Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙÙˆØ±Ù… Ø³ÙˆØ§Ø¡ ÙƒØ§Ù†Øª Django widgets Ø£Ùˆ inputs Ø¹Ø§Ø¯ÙŠØ© */
  .t-group input,
  .t-group textarea,
  .t-group select{
    width:100%;
    padding: 12px 12px;
    border: 1px solid var(--line);
    border-radius: 12px;
    font-size: 1rem;
    background: var(--card);
    color: var(--ink);
    transition: var(--t);
  }
  .t-group textarea{ min-height: 140px; resize: vertical; }

  .t-group input:focus,
  .t-group textarea:focus,
  .t-group select:focus{
    outline: none;
    border-color: rgba(37,99,235,.55);
    box-shadow: 0 0 0 4px rgba(37,99,235,.14);
  }

  /* File helper row */
  .t-help{
    margin-top: 6px;
    font-weight: 850;
    color: var(--muted);
    font-size: .92rem;
    display:flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items:center;
  }
  .t-help .tag{
    display:inline-flex;
    align-items:center;
    gap: 8px;
    border: 1px solid var(--line);
    background: var(--line-2);
    color: var(--ink);
    padding: 6px 10px;
    border-radius: 999px;
    font-weight: 950;
    font-size: .85rem;
  }

  .t-err{
    margin-top: 6px;
    color: #dc2626;
    font-weight: 900;
    font-size: .92rem;
  }

  /* Actions */
  .t-actions{
    margin-top: 4px;
    display:flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items:center;
    justify-content: flex-start;
  }

  .t-actions .btn{
    min-height: 44px;
    border-radius: 999px;
    padding: 10px 16px;
    transition: var(--t);
  }

  .t-submit{
    width: 100%;
    display:flex;
    align-items:center;
    justify-content:center;
    gap: 10px;
  }
  @media(min-width: 640px){
    .t-submit{ width: auto; min-width: 220px; }
  }

  .t-actions .btn[disabled]{
    opacity: .75;
    cursor: not-allowed;
    transform: none !important;
  }

  /* Reduce motion */
  @media (prefers-reduced-motion: reduce){
    .ticket-wrap *{ transition: none !important; }
  }
</style>
{% endblock %}

{% block content %}
<div class="ticket-wrap" dir="rtl">
  <section class="ticket-hero" aria-label="Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ø© Ø§Ù„Ø¯Ø¹Ù…">
    <div class="ticket-hero-inner">
      <div>
        <h1><span aria-hidden="true">ğŸ§</span> Ø·Ù„Ø¨ Ø¯Ø¹Ù… ÙÙ†ÙŠ Ù„Ù„Ù…Ù†ØµØ©</h1>
        <p>Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¨ÙˆØ¶ÙˆØ­ØŒ ÙˆØ£Ø±ÙÙ‚ ØµÙˆØ±Ø© Ø¥Ù† Ù„Ø²Ù…. Ø³ÙŠØµÙ„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.</p>
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;font-weight:900;opacity:.95">
        <span style="display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.16);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);white-space:nowrap">
          <i class="fa-solid fa-user" style="opacity:.95"></i>
          {{ request.user.name|default:"Ù…Ø³ØªØ®Ø¯Ù…" }}
        </span>
      </div>
    </div>
  </section>

  <div class="ticket-card">
    <div class="ticket-card-hd">
      <div style="font-weight:950;display:flex;gap:10px;align-items:center;">
        <i class="fa-solid fa-life-ring" style="opacity:.9"></i>
        <span>Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ Ø§Ù„Ø¯Ø¹Ù…</span>
      </div>
      <div class="hint">Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¹Ù„Ø§Ù…Ø© * Ø¥Ù„Ø²Ø§Ù…ÙŠØ©</div>
    </div>

    <div class="ticket-card-bd">
      <form method="post" enctype="multipart/form-data" id="supportForm" class="t-form" novalidate>
        {% csrf_token %}

        {% if form.non_field_errors %}
          <div class="t-alert t-danger">{{ form.non_field_errors }}</div>
        {% elif form.errors %}
          <div class="t-alert t-danger">ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø£Ø¯Ù†Ø§Ù‡.</div>
        {% endif %}

        <div class="t-group">
          <label for="{{ form.title.id_for_label }}">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø·Ù„Ø¨ *</label>
          {{ form.title }}
          {% if form.title.errors %}<div class="t-err">{{ form.title.errors.0 }}</div>{% endif %}
        </div>

        <div class="t-group">
          <label for="{{ form.body.id_for_label }}">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© *</label>
          {{ form.body }}
          {% if form.body.errors %}<div class="t-err">{{ form.body.errors.0 }}</div>{% endif %}
        </div>

        <div class="t-group">
          <label for="{{ form.attachment.id_for_label }}">Ù…Ø±ÙÙ‚ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          {{ form.attachment }}

          <div class="t-help">
            <span class="tag"><i class="fa-solid fa-image"></i> ØµÙˆØ± ÙÙ‚Ø·</span>
            <span>JPG / PNG â€” ÙŠÙØ¶Ù‘Ù„ Ø£Ù‚Ù„ Ù…Ù† 10MB</span>
          </div>

          {% if form.attachment.errors %}<div class="t-err">{{ form.attachment.errors.0 }}</div>{% endif %}
        </div>

        <div class="t-actions">
          <button type="submit" class="btn btn-primary t-submit" id="submitBtn">
            <i class="fa-solid fa-paper-plane"></i>
            <span>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</span>
          </button>

          <a class="btn btn-ghost" href="{% url 'reports:my_requests' %}" data-smart-back="1">
            <i class="fa-solid fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹ Ù„Ø·Ù„Ø¨Ø§ØªÙŠ
          </a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script nonce="{{ CSP_NONCE }}">
  (function(){
    var form = document.getElementById('supportForm');
    var btn = document.getElementById('submitBtn');
    if(!form || !btn) return;

    var fileInput = form.querySelector('input[type="file"]');
    if(fileInput){
      // ØªØ­Ø³ÙŠÙ† Ø¨Ø³ÙŠØ·: Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØµÙˆØ± ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„/Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨
      try{ fileInput.setAttribute('accept','image/*'); }catch(e){ /* ignore */ }
    }

    form.addEventListener('submit', function(){
      btn.disabled = true;
      btn.setAttribute('aria-busy', 'true');
      btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i><span> Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„â€¦</span>';
    });
  })();
</script>
{% endblock %}
