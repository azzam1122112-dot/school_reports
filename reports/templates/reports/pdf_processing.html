{% extends "base.html" %}
{% load static %}

{% block title %}جاري تجهيز ملف PDF{% endblock %}

{% block content %}
<div class="container py-5 text-center">
    <div class="card shadow-sm p-5">
        <div class="mb-4">
            <i class="fas fa-file-pdf fa-4x text-danger animate-pulse"></i>
        </div>
        <h2 class="mb-3">جاري تجهيز التقرير...</h2>
        <p class="text-muted mb-4">
            نحن نقوم الآن بتوليد ملف PDF الخاص بتقريرك. قد يستغرق ذلك بضع ثوانٍ.
        </p>
        
        {% if r.pdf_status == 'failed' %}
        <div class="alert alert-danger">
            <i class="fas fa-exclamation-triangle me-2"></i>
            عذراً، فشل توليد ملف PDF. يرجى المحاولة مرة أخرى أو التواصل مع الدعم.
        </div>
        <div class="mt-3">
            <a href="{% url 'reports:report_pdf' r.pk %}" class="btn btn-danger">
                <i class="fas fa-sync me-2"></i> إعادة المحاولة
            </a>
        </div>
        {% else %}
        <div class="progress mb-4" style="height: 10px;">
            <div class="progress-bar progress-bar-striped progress-bar-animated bg-danger" role="progressbar" style="width: 100%"></div>
        </div>

        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            سيتم تحديث هذه الصفحة تلقائياً بمجرد اكتمال الملف.
        </div>
        {% endif %}

        <div class="mt-3">
            <a href="{% url 'reports:my_reports' %}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-right me-2"></i> العودة لتقاريري
            </a>
        </div>
    </div>
</div>

<script>
    // Refresh the page every 3 seconds if not failed
    {% if r.pdf_status != 'failed' %}
    setTimeout(function() {
        location.reload();
    }, 3000);
    {% endif %}
</script>

<style>
    @keyframes pulse {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.1); opacity: 0.7; }
        100% { transform: scale(1); opacity: 1; }
    }
    .animate-pulse {
        animation: pulse 2s infinite ease-in-out;
    }
</style>
{% endblock %}
