{# reports/templates/reports/home.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}Ù…Ø±Ø­Ø¨Ø§Ù‹ {{ request.user.name|default:"" }}{% endblock %}

{% block head %}
<style>
  /* =========================================================
     HOME (page-only polish) â€” Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹Ø±ÙŠÙ .btn / .card
     ========================================================= */
  .home-wrap{
    --h-radius: 18px;
    --h-shadow: 0 18px 50px rgba(2,6,23,.10);
    --h-ring: 0 0 0 4px rgba(37,99,235,.20);
  }

  .home-hero{
    position:relative;
    overflow:hidden;
    border-radius: var(--h-radius);
    background:
      radial-gradient(900px 380px at 15% 0%, rgba(255,255,255,.22), transparent 60%),
      radial-gradient(900px 420px at 95% 85%, rgba(16,185,129,.18), transparent 55%),
      linear-gradient(135deg, #2563eb 0%, #1e40af 55%, #0f2a6a 100%);
    color:#fff;
    box-shadow: var(--h-shadow);
    border: 1px solid rgba(255,255,255,.14);
  }

  .home-hero::before{
    content:"";
    position:absolute;
    inset:-2px;
    background:
      radial-gradient(closest-side, rgba(255,255,255,.14), transparent 60%) 20% 15%/220px 220px no-repeat,
      radial-gradient(closest-side, rgba(255,255,255,.10), transparent 60%) 85% 70%/260px 260px no-repeat;
    pointer-events:none;
    opacity:.85;
  }

  .home-hero-inner{
    position:relative;
    padding: clamp(16px, 3vw, 28px);
    display:grid;
    gap:16px;
  }

  .hero-top{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
  }

  .hero-title{
    margin:0;
    font-weight: 950;
    letter-spacing: -.5px;
    line-height:1.2;
    font-size: clamp(1.35rem, 3.2vw, 2.05rem);
    color:#eef2ff;
  }

  .hero-sub{
    margin:8px 0 0;
    font-weight: 800;
    opacity:.92;
    max-width: 740px;
    font-size: clamp(.98rem, 1.8vw, 1.12rem);
  }

  .hero-meta{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
    font-weight: 900;
    opacity:.95;
  }

  .hero-chip{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 12px;
    border-radius: 999px;
    background: rgba(255,255,255,.12);
    border: 1px solid rgba(255,255,255,.16);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    white-space:nowrap;
  }
  .hero-chip i{ opacity:.95; }

  .hero-actions{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-top: 2px;
  }

  /* Ø£Ø²Ø±Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‡ÙŠØ±Ùˆ ÙÙ‚Ø· (Ø¨Ø¯ÙˆÙ† Ù„Ù…Ø³ .btn Ø§Ù„Ø¹Ø§Ù…Ø©) */
  .hero-actions .btn{
    border-radius: 999px;
    min-height: 44px;
    padding: 10px 16px;
    border-color: rgba(255,255,255,.18);
  }
  .btn-hero{
    background:#fff;
    color:#1e40af;
    border-color:#fff;
  }
  .btn-hero:hover{
    transform: translateY(-2px);
    box-shadow: 0 18px 35px rgba(2,6,23,.18);
  }
  .btn-hero-outline{
    background: rgba(255,255,255,.10);
    color:#eef2ff;
    border-color: rgba(255,255,255,.22);
  }
  .btn-hero-outline:hover{
    background: rgba(255,255,255,.16);
    transform: translateY(-2px);
  }

  /* Layout */
  .home-grid{
    display:grid;
    gap:14px;
    margin-top: 14px;
  }
  @media(min-width: 980px){
    .home-grid{
      grid-template-columns: 1.35fr .65fr;
      align-items:start;
    }
  }

  /* KPI */
  .kpis{
    display:grid;
    gap:12px;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  }
  .kpi{
    border-radius: 16px;
    border: 1px solid var(--line);
    background: linear-gradient(180deg, var(--line-2), var(--card));
    padding: 14px;
    position:relative;
    overflow:hidden;
    transition: var(--t);
  }
  .kpi:hover{
    transform: translateY(-2px);
    box-shadow: 0 10px 26px rgba(2,6,23,.08);
  }
  @media(prefers-color-scheme: dark){
    .kpi{
      background: linear-gradient(180deg, #122043, #0f1629);
      border-color: #1b2744;
    }
  }

  .kpi .v{
    font-weight: 950;
    font-size: clamp(1.2rem, 2.2vw, 1.65rem);
    color: var(--ink);
    line-height:1.1;
  }
  .kpi .l{
    margin-top: 6px;
    font-weight: 900;
    color: var(--muted);
    font-size: .95rem;
  }
  .kpi .bub{
    position:absolute;
    left: 12px;
    bottom: 12px;
    width: 40px;
    height: 40px;
    border-radius: 14px;
    display:grid;
    place-items:center;
    background: rgba(37,99,235,.10);
    border: 1px solid rgba(37,99,235,.18);
    color: rgba(37,99,235,.95);
  }
  .kpi.kpi-green .bub{ background: rgba(16,185,129,.10); border-color: rgba(16,185,129,.20); color: rgba(16,185,129,.95); }
  .kpi.kpi-amber .bub{ background: rgba(245,158,11,.12); border-color: rgba(245,158,11,.22); color: rgba(245,158,11,.95); }
  .kpi.kpi-red   .bub{ background: rgba(239,68,68,.10);  border-color: rgba(239,68,68,.22);  color: rgba(239,68,68,.95); }

  /* Modern list rows */
  .list{
    display:grid;
    gap:10px;
  }
  .item{
    display:grid;
    grid-template-columns: 1fr auto;
    gap:10px;
    padding: 12px;
    border-radius: 14px;
    border: 1px solid var(--line);
    background: var(--line-2);
    text-decoration:none;
    color: inherit;
    transition: var(--t);
  }
  .item:hover{
    transform: translateY(-1px);
    box-shadow: 0 10px 22px rgba(2,6,23,.07);
    background: rgba(219,234,254,.60);
  }
  @media(prefers-color-scheme: dark){
    .item{ background: rgba(20,35,73,.40); border-color:#1b2744; }
    .item:hover{ background: rgba(26,44,83,.70); }
  }

  .item strong{
    font-weight: 950;
    color: var(--ink);
    display:block;
  }
  .item .meta{
    margin-top: 4px;
    font-weight: 800;
    color: var(--muted);
    font-size: .95rem;
  }

  .pill{
    align-self:center;
    justify-self:end;
    border-radius: 999px;
    padding: 6px 10px;
    font-weight: 950;
    font-size: .85rem;
    color:#fff;
    white-space:nowrap;
  }
  .p-blue{ background:#2563eb; }
  .p-green{ background:#10b981; }
  .p-amber{ background:#f59e0b; }
  .p-red{ background:#ef4444; }
  .p-gray{ background:#64748b; }

  /* Empty state */
  .empty{
    padding: 14px;
    border-radius: 16px;
    border: 1px dashed var(--line);
    background: linear-gradient(180deg, var(--card), var(--line-2));
    color: var(--muted);
    font-weight: 850;
  }
  .empty b{ color: var(--ink); }

  /* Motivator button (subtle) */
  .motivate{
    display:inline-flex;
    align-items:center;
    gap:8px;
    font-weight: 950;
    margin-top: 8px;
    border:0;
    background: transparent;
    color: rgba(255,255,255,.95);
    cursor:pointer;
    opacity:.95;
    transition: var(--t);
    padding: 6px 0;
    text-align:start;
  }
  .motivate:hover{ opacity:1; transform: translateY(-1px); }
  .motivate i{ color:#fbbf24; }

  /* Reduce motion */
  @media (prefers-reduced-motion: reduce){
    .kpi, .item, .hero-actions .btn, .motivate{ transition:none !important; }
    .kpi:hover, .item:hover, .hero-actions .btn:hover, .motivate:hover{ transform:none !important; }
  }
</style>
{% endblock %}

{% block content %}
<div class="home-wrap">
  <!-- HERO -->
  <section class="home-hero" aria-labelledby="welcomeTitle">
    <div class="home-hero-inner">
      <div class="hero-top">
        <div>
          <h1 class="hero-title" id="welcomeTitle">Ø£Ù‡Ù„Ù‹Ø§ {{ request.user.name|default:"Ø¨Ùƒ" }} ğŸ‘‹</h1>
          <p class="hero-sub">
            Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ! ÙˆØ«Ù‘Ù‚ Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒØŒ ØªØ§Ø¨Ø¹ Ø·Ù„Ø¨Ø§ØªÙƒØŒ ÙˆØ§Ø·Ù‘Ù„Ø¹ Ø¹Ù„Ù‰ Ø¢Ø®Ø± Ø§Ù„Ù…Ø³ØªØ¬Ø¯Ø§Øª Ø¨Ø³Ø±Ø¹Ø©.
          </p>

          {% if NAV_NOTIFICATION_HERO %}
            <button type="button" class="motivate" onclick="window.showNotification(this)" aria-label="Ø§ÙØªØ­ Ø¢Ø®Ø± Ø¥Ø´Ø¹Ø§Ø±">
              <i class="fa-solid fa-sparkles"></i> Ø­ÙÙ‘Ø²Ù†ÙŠ Ø§Ù„Ø¢Ù†
            </button>
          {% endif %}
        </div>

        <div class="hero-meta" aria-label="Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø©">
          <span class="hero-chip">
            <i class="fa-solid fa-building"></i>
            {% if SCHOOL_NAME %}{{ SCHOOL_NAME }}{% else %}Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±{% endif %}
          </span>
          <span class="hero-chip">
            <i class="fa-solid fa-user"></i>
            {% firstof request.user.role "Ù…Ø³ØªØ®Ø¯Ù…" %}
          </span>
        </div>
      </div>

      <div class="hero-actions" aria-label="Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©">
        <a class="btn btn-hero" href="{% url 'reports:add_report' %}">
          <i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØªÙ‚Ø±ÙŠØ±
        </a>

        <a class="btn btn-hero-outline" href="{% url 'reports:my_reports' %}">
          <i class="fa-solid fa-file-lines"></i> ØªÙ‚Ø§Ø±ÙŠØ±ÙŠ
        </a>

        {% url 'reports:assigned_to_me' as inbox_url %}
        {% if inbox_url %}
          <a class="btn btn-hero-outline" href="{{ inbox_url }}">
            <i class="fa-solid fa-inbox"></i> Ø§Ù„ÙˆØ§Ø±Ø¯
          </a>
        {% endif %}

        <a class="btn btn-hero-outline" href="{% url 'reports:my_requests' %}">
          <i class="fa-solid fa-rectangle-list"></i> Ø·Ù„Ø¨Ø§ØªÙŠ
        </a>
      </div>
    </div>
  </section>

  {% if login_notification %}
    <section class="card" aria-label="Ø¢Ø®Ø± Ø¥Ø´Ø¹Ø§Ø±" style="margin-top:14px">
      <h3 style="margin:0 0 10px; font-weight:950; display:flex; gap:10px; align-items:center;">
        <i class="fa-solid fa-bell" style="opacity:.85"></i>
        Ø¢Ø®Ø± Ø¥Ø´Ø¹Ø§Ø±
        {% if login_notification.is_important %}<span class="pill p-red">Ù‡Ø§Ù…</span>{% endif %}
      </h3>
      {% if login_notification.title %}
        <div style="font-weight:950; margin-bottom:6px">{{ login_notification.title }}</div>
      {% endif %}
      <div class="muted" style="white-space:pre-wrap">{{ login_notification.message|linebreaksbr }}</div>
      <div class="muted" style="margin-top:10px; font-weight:800; font-size:.95rem">
        Ø§Ù„Ù…Ø±Ø³Ù„: {% firstof login_notification.created_by.name login_notification.created_by.phone "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©" %}
        {% if login_notification.created_at %} â€” <span dir="ltr">{{ login_notification.created_at|date:"Y-m-d H:i" }}</span>{% endif %}
      </div>
    </section>
  {% endif %}

  <div class="home-grid">
    <!-- LEFT -->
    <div class="grid" style="align-content:start">
      <div class="card">
        <h3 style="margin:0 0 10px; font-weight:950; display:flex; gap:10px; align-items:center;">
          <i class="fa-solid fa-chart-simple" style="opacity:.85"></i> Ù†Ø¸Ø±Ø© Ø³Ø±ÙŠØ¹Ø©
        </h3>

        <div class="kpis" role="list">
          <div class="kpi" role="listitem">
            <div class="v">{{ stats.today_count|default:"0" }}</div>
            <div class="l">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…</div>
            <div class="bub" aria-hidden="true"><i class="fa-solid fa-sun"></i></div>
          </div>

          <div class="kpi" role="listitem">
            <div class="v">{{ stats.total_count|default:"0" }}</div>
            <div class="l">Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙ‚Ø§Ø±ÙŠØ±ÙŠ</div>
            <div class="bub" aria-hidden="true"><i class="fa-solid fa-layer-group"></i></div>
          </div>

          <div class="kpi kpi-amber" role="listitem">
            <div class="v">{{ req_stats.open|default:"0" }}</div>
            <div class="l">Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>
            <div class="bub" aria-hidden="true"><i class="fa-solid fa-door-open"></i></div>
          </div>

          <div class="kpi kpi-green" role="listitem">
            <div class="v">{{ req_stats.in_progress|default:"0" }}</div>
            <div class="l">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</div>
            <div class="bub" aria-hidden="true"><i class="fa-solid fa-hourglass-half"></i></div>
          </div>
        </div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 10px; font-weight:950; display:flex; gap:10px; align-items:center;">
          <i class="fa-solid fa-file-circle-check" style="opacity:.85"></i> Ø£Ø­Ø¯Ø« ØªÙ‚Ø§Ø±ÙŠØ±ÙŠ
        </h3>

        {% if recent_reports %}
          <div class="list" role="list">
            {% for r in recent_reports %}
              <a class="item" role="listitem" href="{% url 'reports:report_print' r.id %}" title="ÙØªØ­ Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±">
                <div>
                  <strong>{{ r.title }}</strong>
                  <div class="meta">Ø¨ØªØ§Ø±ÙŠØ® {{ r.report_date }} â€” {{ r.day_name }}</div>
                </div>

                {# Ù„Ùˆ Ù…Ø§ ÙÙŠÙ‡ category.name Ù†Ø®Ù„ÙŠÙ‡Ø§ Ø§ÙØªØ±Ø§Ø¶ÙŠ #}
                <span class="pill p-blue">{% if r.category and r.category.name %}{{ r.category.name }}{% else %}â€”{% endif %}</span>
              </a>
            {% endfor %}
          </div>

          <div style="margin-top:14px; display:flex; gap:8px; flex-wrap:wrap">
            <a class="btn btn-ghost" href="{% url 'reports:my_reports' %}">
              <i class="fa-solid fa-list"></i> Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ ØªÙ‚Ø§Ø±ÙŠØ±ÙŠ
            </a>
            <a class="btn btn-primary" href="{% url 'reports:add_report' %}">
              <i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØªÙ‚Ø±ÙŠØ±
            </a>
          </div>
        {% else %}
          <div class="empty">
            Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ø­Ø¯ÙŠØ«Ø© Ø¨Ø¹Ø¯ â€” <b>Ø§Ø¨Ø¯Ø£ Ø¨ØªÙˆØ«ÙŠÙ‚ Ø£ÙˆÙ„ Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø¢Ù†</b>.
            <div style="margin-top:12px">
              <a class="btn btn-primary" href="{% url 'reports:add_report' %}">
                <i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯
              </a>
            </div>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- RIGHT -->
    <div class="grid" style="align-content:start">
      <div class="card">
        <h3 style="margin:0 0 10px; font-weight:950; display:flex; gap:10px; align-items:center;">
          <i class="fa-solid fa-clipboard-check" style="opacity:.85"></i> Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ø§ØªÙŠ
        </h3>

        <div class="list" role="list">
          <div class="item" role="listitem" style="cursor:default">
            <div><strong>Ù…ÙƒØªÙ…Ù„Ø©</strong></div>
            <span class="pill p-green">{{ req_stats.done|default:"0" }}</span>
          </div>

          <div class="item" role="listitem" style="cursor:default">
            <div><strong>Ù…Ø±ÙÙˆØ¶Ø©</strong></div>
            <span class="pill p-red">{{ req_stats.rejected|default:"0" }}</span>
          </div>
        </div>

        <div style="margin-top:14px; display:flex; gap:8px; flex-wrap:wrap">
          <a class="btn btn-ghost" href="{% url 'reports:request_create' %}">
            <i class="fa-solid fa-ticket"></i> ÙØªØ­ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
          </a>
          <a class="btn" href="{% url 'reports:my_requests' %}">
            <i class="fa-solid fa-rectangle-list"></i> Ø·Ù„Ø¨Ø§ØªÙŠ
          </a>
        </div>
      </div>

      <div class="card" id="motivateCard" aria-live="polite">
        <h3 style="margin:0 0 10px; font-weight:950; display:flex; gap:10px; align-items:center;">
          <i class="fa-solid fa-bolt" style="opacity:.85"></i> Ø¯ÙØ¹Ø© Ø·Ø§Ù‚Ø©
        </h3>

        <div class="meta" style="font-weight:900">
          Ø§Ø¨Ø¯Ø£ ÙŠÙˆÙ…Ùƒ Ø¨Ø®Ø·ÙˆØ© ØµØºÙŠØ±Ø© Ø§Ù„Ø¢Ù†. Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø© Ù‚Ø¯ ØªØºÙŠÙ‘Ø± Ù†ØªÙŠØ¬Ø© ÙŠÙˆÙ…Ùƒ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.
        </div>

        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:14px;">
          <a class="btn btn-primary" href="{% url 'reports:add_report' %}">
            <i class="fa-solid fa-plus"></i> ØªÙˆØ«ÙŠÙ‚ Ø¥Ù†Ø¬Ø§Ø²
          </a>

          {% if NAV_NOTIFICATION_HERO %}
            <button type="button" class="btn" onclick="window.showNotification(document.getElementById('motivateCard'))">
              <i class="fa-solid fa-sparkles"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            </button>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
