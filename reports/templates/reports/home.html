{# reports/templates/reports/home.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}Ù…Ø±Ø­Ø¨Ø§Ù‹ {{ request.user.name|default:"" }}{% endblock %}

{% block head %}
<style>
  /* =========================================================
     HOME (page-only polish)
     - Scoped Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¯Ø§Ø®Ù„ .home-wrap Ù„ØªØ¬Ù†Ø¨ ØªØ¹Ø§Ø±Ø¶Ø§Øª app.css
     - Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ data-theme (Ø¨Ø¯Ù„ prefers-color-scheme)
     - Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹Ø±ÙŠÙ .btn / .card Ø§Ù„Ø¹Ø§Ù…Ø©
     ========================================================= */

  .home-wrap{
    --h-radius: 18px;
    --h-shadow: 0 18px 50px rgba(2,6,23,.10);
    --h-ring: 0 0 0 4px rgba(37,99,235,.20);
    --t: var(--t-fast);
  }

  /* HERO */
  .home-wrap .home-hero{
    position:relative;
    overflow:hidden;
    border-radius: var(--h-radius);
    background:
      radial-gradient(900px 380px at 15% 0%, rgba(255,255,255,.22), transparent 60%),
      radial-gradient(900px 420px at 95% 85%, rgba(16,185,129,.18), transparent 55%),
      linear-gradient(135deg, #2563eb 0%, #1e40af 55%, #0f2a6a 100%);
    color:#fff;
    box-shadow: var(--h-shadow);
    border: 1px solid rgba(255,255,255,.14);
  }

  .home-wrap .home-hero::before{
    content:"";
    position:absolute;
    inset:-2px;
    background:
      radial-gradient(closest-side, rgba(255,255,255,.14), transparent 60%) 20% 15%/220px 220px no-repeat,
      radial-gradient(closest-side, rgba(255,255,255,.10), transparent 60%) 85% 70%/260px 260px no-repeat;
    pointer-events:none;
    opacity:.85;
  }

  .home-wrap .home-hero-inner{
    position:relative;
    padding: clamp(16px, 3vw, 28px);
    display:grid;
    gap:16px;
  }

  .home-wrap .hero-top{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
  }

  .home-wrap .hero-title{
    margin:0;
    font-weight: 950;
    letter-spacing: -.5px;
    line-height:1.2;
    font-size: clamp(1.35rem, 3.2vw, 2.05rem);
    color:#eef2ff;
  }

  .home-wrap .hero-sub{
    margin:8px 0 0;
    font-weight: 800;
    opacity:.92;
    max-width: 740px;
    font-size: clamp(.98rem, 1.8vw, 1.12rem);
  }

  .home-wrap .hero-meta{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
    font-weight: 900;
    opacity:.95;
  }

  .home-wrap .hero-chip{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 12px;
    border-radius: 999px;
    background: rgba(255,255,255,.12);
    border: 1px solid rgba(255,255,255,.16);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    white-space:nowrap;
  }
  .home-wrap .hero-chip i{ opacity:.95; }

  .home-wrap .hero-actions{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-top: 2px;
  }

  /* Ø£Ø²Ø±Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‡ÙŠØ±Ùˆ ÙÙ‚Ø· */
  .home-wrap .hero-actions .btn{
    border-radius: 999px;
    min-height: 44px;
    padding: 10px 16px;
    border-color: rgba(255,255,255,.18);
    transition: var(--t);
  }
  .home-wrap .btn-hero{
    background:#fff;
    color:#1e40af;
    border-color:#fff;
  }
  .home-wrap .btn-hero:hover{
    transform: translateY(-2px);
    box-shadow: 0 18px 35px rgba(2,6,23,.18);
  }
  .home-wrap .btn-hero-outline{
    background: rgba(255,255,255,.10);
    color:#eef2ff;
    border-color: rgba(255,255,255,.22);
  }
  .home-wrap .btn-hero-outline:hover{
    background: rgba(255,255,255,.16);
    transform: translateY(-2px);
  }

  /* Layout */
  .home-wrap .home-grid{
    display:grid;
    gap:14px;
    margin-top: 14px;
  }
  @media(min-width: 980px){
    .home-wrap .home-grid{
      grid-template-columns: 1.35fr .65fr;
      align-items:start;
    }
  }

  /* KPI */
  .home-wrap .kpis{
    display:grid;
    gap:12px;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  }
  .home-wrap .kpi{
    border-radius: 16px;
    border: 1px solid var(--line);
    background: linear-gradient(180deg, var(--line-2), var(--card));
    padding: 14px;
    position:relative;
    overflow:hidden;
    transition: var(--t);
  }
  .home-wrap .kpi:hover{
    transform: translateY(-2px);
    box-shadow: 0 10px 26px rgba(2,6,23,.08);
  }
  html[data-theme="dark"] .home-wrap .kpi{
    background: linear-gradient(180deg, #122043, #0f1629);
    border-color: #1b2744;
  }

  .home-wrap .kpi .v{
    font-weight: 950;
    font-size: clamp(1.2rem, 2.2vw, 1.65rem);
    color: var(--ink);
    line-height:1.1;
  }
  .home-wrap .kpi .l{
    margin-top: 6px;
    font-weight: 900;
    color: var(--muted);
    font-size: .95rem;
  }
  .home-wrap .kpi .bub{
    position:absolute;
    left: 12px;
    bottom: 12px;
    width: 40px;
    height: 40px;
    border-radius: 14px;
    display:grid;
    place-items:center;
    background: rgba(37,99,235,.10);
    border: 1px solid rgba(37,99,235,.18);
    color: rgba(37,99,235,.95);
  }
  .home-wrap .kpi.kpi-green .bub{ background: rgba(16,185,129,.10); border-color: rgba(16,185,129,.20); color: rgba(16,185,129,.95); }
  .home-wrap .kpi.kpi-amber .bub{ background: rgba(245,158,11,.12); border-color: rgba(245,158,11,.22); color: rgba(245,158,11,.95); }
  .home-wrap .kpi.kpi-red   .bub{ background: rgba(239,68,68,.10);  border-color: rgba(239,68,68,.22);  color: rgba(239,68,68,.95); }

  /* Modern list rows (scoped) */
  .home-wrap .list{
    display:grid;
    gap:10px;
  }
  .home-wrap .item{
    display:grid;
    grid-template-columns: 1fr auto;
    gap:10px;
    padding: 12px;
    border-radius: 14px;
    border: 1px solid var(--line);
    background: var(--line-2);
    text-decoration:none;
    color: inherit;
    transition: var(--t);
  }
  .home-wrap .item:hover{
    transform: translateY(-1px);
    box-shadow: 0 10px 22px rgba(2,6,23,.07);
    background: rgba(219,234,254,.60);
  }
  html[data-theme="dark"] .home-wrap .item{ background: rgba(20,35,73,.40); border-color:#1b2744; }
  html[data-theme="dark"] .home-wrap .item:hover{ background: rgba(26,44,83,.70); }

  .home-wrap .item strong{
    font-weight: 950;
    color: var(--ink);
    display:block;
  }
  .home-wrap .item .meta{
    margin-top: 4px;
    font-weight: 800;
    color: var(--muted);
    font-size: .95rem;
  }

  /* Pill (new) */
  .home-wrap .hpill{
    align-self:center;
    justify-self:end;
    border-radius: 999px;
    padding: 6px 10px;
    font-weight: 950;
    font-size: .85rem;
    color:#fff;
    white-space:nowrap;
  }
  .home-wrap .hp-blue{ background:#2563eb; }
  .home-wrap .hp-green{ background:#10b981; }
  .home-wrap .hp-amber{ background:#f59e0b; }
  .home-wrap .hp-red{ background:#ef4444; }
  .home-wrap .hp-gray{ background:#64748b; }

  /* Empty state */
  .home-wrap .empty{
    padding: 14px;
    border-radius: 16px;
    border: 1px dashed var(--line);
    background: linear-gradient(180deg, var(--card), var(--line-2));
    color: var(--muted);
    font-weight: 850;
  }
  .home-wrap .empty b{ color: var(--ink); }

  /* Reduce motion */
  @media (prefers-reduced-motion: reduce){
    .home-wrap .kpi,
    .home-wrap .item,
    .home-wrap .hero-actions .btn{
      transition:none !important;
    }
    .home-wrap .kpi:hover,
    .home-wrap .item:hover,
    .home-wrap .hero-actions .btn:hover{
      transform:none !important;
    }
  }

  /* ===== Home Notification Modal (center) ===== */
  .home-wrap .hn-overlay{
    position: fixed;
    inset: 0;
    background: rgba(2,6,23,.55);
    z-index: 12500;
    display: none;
    place-items: center;
    padding: 12px;
  }
  .home-wrap .hn-overlay.is-open{ display: grid; }
  .home-wrap .hn-modal{
    width: min(560px, 94vw);
    background: var(--card);
    border: 1px solid var(--line);
    border-radius: 18px;
    box-shadow: 0 40px 90px rgba(2,6,23,.28);
    overflow: hidden;
  }
  .home-wrap .hn-hd{
    padding: 14px 16px;
    border-bottom: 1px solid var(--line);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    background: linear-gradient(180deg, var(--line-2), var(--card));
  }
  .home-wrap .hn-hd .ttl{
    margin: 0;
    font-weight: 950;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--ink);
  }
  .home-wrap .hn-close{
    width: 44px;
    height: 44px;
    border-radius: 999px;
    border: 1px solid var(--line);
    background: var(--card);
    cursor: pointer;
    font-weight: 900;
    color: var(--ink);
  }
  .home-wrap .hn-bd{ padding: 14px 16px; }
  .home-wrap .hn-title{ font-weight: 950; margin: 0 0 8px 0; color: var(--ink); }
  .home-wrap .hn-body{ color: var(--ink); font-weight: 800; line-height: 1.8; }
  .home-wrap .hn-meta{
    margin-top: 10px;
    color: var(--muted);
    font-weight: 800;
    font-size: .95rem;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
  }
</style>
{% endblock %}

{% block content %}
<div class="home-wrap">
  {% if home_notification %}
    <div
      class="hn-overlay is-open"
      id="homeNotifOverlay"
      role="dialog"
      aria-modal="true"
      aria-label="Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯"
      {% if home_notification_recipient_id %}
        data-recipient-id="{{ home_notification_recipient_id }}"
        data-mark-url="{% url 'reports:notification_mark_read' home_notification_recipient_id %}"
      {% endif %}
    >
      <div class="hn-modal" role="document">
        <div class="hn-hd">
          <h3 class="ttl">
            <i class="fa-solid fa-bell" style="opacity:.9"></i>
            Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
            {% if home_notification.is_important %}<span class="hpill hp-red">Ù‡Ø§Ù…</span>{% endif %}
          </h3>
          <button type="button" class="hn-close" id="homeNotifClose" aria-label="Ø¥ØºÙ„Ø§Ù‚">âœ•</button>
        </div>
        <div class="hn-bd">
          {% if home_notification.title %}
            <div class="hn-title">{{ home_notification.title }}</div>
          {% endif %}
          <div class="hn-body">{{ home_notification.message|linebreaksbr }}</div>
          <div class="hn-meta">
            <span>Ø§Ù„Ù…Ø±Ø³Ù„: {% firstof home_notification.created_by.name home_notification.created_by.phone "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©" %}</span>
            {% if home_notification.created_at %}<span dir="ltr">{{ home_notification.created_at|date:"Y-m-d H:i" }}</span>{% endif %}
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  <!-- HERO -->
  <section class="home-hero" aria-labelledby="welcomeTitle">
    <div class="home-hero-inner">
      <div class="hero-top">
        <div>
          <h1 class="hero-title" id="welcomeTitle">Ø£Ù‡Ù„Ù‹Ø§ {{ request.user.name|default:"Ø¨Ùƒ" }} ğŸ‘‹</h1>
          <p class="hero-sub">
            Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ! ÙˆØ«Ù‘Ù‚ Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒØŒ ØªØ§Ø¨Ø¹ Ø·Ù„Ø¨Ø§ØªÙƒØŒ ÙˆØ§Ø·Ù‘Ù„Ø¹ Ø¹Ù„Ù‰ Ø¢Ø®Ø± Ø§Ù„Ù…Ø³ØªØ¬Ø¯Ø§Øª Ø¨Ø³Ø±Ø¹Ø©.
          </p>
        </div>

        <div class="hero-meta" aria-label="Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø©">
          <span class="hero-chip">
            <i class="fa-solid fa-building"></i>
            {% if SCHOOL_NAME %}{{ SCHOOL_NAME }}{% else %}Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±{% endif %}
          </span>
          <span class="hero-chip">
            <i class="fa-solid fa-user"></i>
            {% firstof request.user.role "Ù…Ø³ØªØ®Ø¯Ù…" %}
          </span>
        </div>
      </div>

      <div class="hero-actions" aria-label="Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©">
        <a class="btn btn-hero" href="{% url 'reports:add_report' %}">
          <i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØªÙ‚Ø±ÙŠØ±
        </a>

        <a class="btn btn-hero-outline" href="{% url 'reports:my_reports' %}">
          <i class="fa-solid fa-file-lines"></i> ØªÙ‚Ø§Ø±ÙŠØ±ÙŠ
        </a>

        {% url 'reports:assigned_to_me' as inbox_url %}
        {% if inbox_url %}
          <a class="btn btn-hero-outline" href="{{ inbox_url }}">
            <i class="fa-solid fa-inbox"></i> Ø§Ù„ÙˆØ§Ø±Ø¯
          </a>
        {% endif %}

        <a class="btn btn-hero-outline" href="{% url 'reports:my_requests' %}">
          <i class="fa-solid fa-rectangle-list"></i> Ø·Ù„Ø¨Ø§ØªÙŠ
        </a>
      </div>
    </div>
  </section>

  <div class="home-grid">
    <!-- LEFT -->
    <div class="grid" style="align-content:start">
      <div class="card">
        <h3 style="margin:0 0 10px; font-weight:950; display:flex; gap:10px; align-items:center;">
          <i class="fa-solid fa-chart-simple" style="opacity:.85"></i> Ù†Ø¸Ø±Ø© Ø³Ø±ÙŠØ¹Ø©
        </h3>

        <div class="kpis" role="list">
          <div class="kpi" role="listitem">
            <div class="v">{{ stats.today_count|default:"0" }}</div>
            <div class="l">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…</div>
            <div class="bub" aria-hidden="true"><i class="fa-solid fa-sun"></i></div>
          </div>

          <div class="kpi" role="listitem">
            <div class="v">{{ stats.total_count|default:"0" }}</div>
            <div class="l">Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙ‚Ø§Ø±ÙŠØ±ÙŠ</div>
            <div class="bub" aria-hidden="true"><i class="fa-solid fa-layer-group"></i></div>
          </div>

          <div class="kpi kpi-amber" role="listitem">
            <div class="v">{{ req_stats.open|default:"0" }}</div>
            <div class="l">Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>
            <div class="bub" aria-hidden="true"><i class="fa-solid fa-door-open"></i></div>
          </div>

          <div class="kpi kpi-green" role="listitem">
            <div class="v">{{ req_stats.in_progress|default:"0" }}</div>
            <div class="l">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</div>
            <div class="bub" aria-hidden="true"><i class="fa-solid fa-hourglass-half"></i></div>
          </div>
        </div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 10px; font-weight:950; display:flex; gap:10px; align-items:center;">
          <i class="fa-solid fa-file-circle-check" style="opacity:.85"></i> Ø£Ø­Ø¯Ø« ØªÙ‚Ø§Ø±ÙŠØ±ÙŠ
        </h3>

        {% if recent_reports %}
          <div class="list" role="list">
            {% for r in recent_reports %}
              <a class="item" role="listitem" href="{% url 'reports:report_print' r.id %}" title="ÙØªØ­ Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±">
                <div>
                  <strong>{{ r.title }}</strong>
                  <div class="meta">Ø¨ØªØ§Ø±ÙŠØ® {{ r.report_date }} â€” {{ r.day_name }}</div>
                </div>

                <span class="hpill hp-blue">
                  {% if r.category and r.category.name %}{{ r.category.name }}{% else %}â€”{% endif %}
                </span>
              </a>
            {% endfor %}
          </div>

          <div style="margin-top:14px; display:flex; gap:8px; flex-wrap:wrap">
            <a class="btn btn-ghost" href="{% url 'reports:my_reports' %}">
              <i class="fa-solid fa-list"></i> Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ ØªÙ‚Ø§Ø±ÙŠØ±ÙŠ
            </a>
            <a class="btn btn-primary" href="{% url 'reports:add_report' %}">
              <i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØªÙ‚Ø±ÙŠØ±
            </a>
          </div>
        {% else %}
          <div class="empty">
            Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ø­Ø¯ÙŠØ«Ø© Ø¨Ø¹Ø¯ â€” <b>Ø§Ø¨Ø¯Ø£ Ø¨ØªÙˆØ«ÙŠÙ‚ Ø£ÙˆÙ„ Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø¢Ù†</b>.
            <div style="margin-top:12px">
              <a class="btn btn-primary" href="{% url 'reports:add_report' %}">
                <i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯
              </a>
            </div>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- RIGHT -->
    <div class="grid" style="align-content:start">
      <div class="card">
        <h3 style="margin:0 0 10px; font-weight:950; display:flex; gap:10px; align-items:center;">
          <i class="fa-solid fa-clipboard-check" style="opacity:.85"></i> Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ø§ØªÙŠ
        </h3>

        <div class="list" role="list">
          <div class="item" role="listitem" style="cursor:default">
            <div><strong>Ù…ÙƒØªÙ…Ù„Ø©</strong></div>
            <span class="hpill hp-green">{{ req_stats.done|default:"0" }}</span>
          </div>

          <div class="item" role="listitem" style="cursor:default">
            <div><strong>Ù…Ø±ÙÙˆØ¶Ø©</strong></div>
            <span class="hpill hp-red">{{ req_stats.rejected|default:"0" }}</span>
          </div>
        </div>

        <div style="margin-top:14px; display:flex; gap:8px; flex-wrap:wrap">
          <a class="btn btn-ghost" href="{% url 'reports:request_create' %}">
            <i class="fa-solid fa-ticket"></i> ÙØªØ­ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
          </a>
          <a class="btn" href="{% url 'reports:my_requests' %}">
            <i class="fa-solid fa-rectangle-list"></i> Ø·Ù„Ø¨Ø§ØªÙŠ
          </a>
        </div>
      </div>

      <div class="card" id="motivateCard" aria-live="polite">
        <h3 style="margin:0 0 10px; font-weight:950; display:flex; gap:10px; align-items:center;">
          <i class="fa-solid fa-bolt" style="opacity:.85"></i> Ø¯ÙØ¹Ø© Ø·Ø§Ù‚Ø©
        </h3>

        <div class="meta" style="font-weight:900">
          Ø§Ø¨Ø¯Ø£ ÙŠÙˆÙ…Ùƒ Ø¨Ø®Ø·ÙˆØ© ØµØºÙŠØ±Ø© Ø§Ù„Ø¢Ù†. Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø© Ù‚Ø¯ ØªØºÙŠÙ‘Ø± Ù†ØªÙŠØ¬Ø© ÙŠÙˆÙ…Ùƒ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.
        </div>

        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:14px;">
          <a class="btn btn-primary" href="{% url 'reports:add_report' %}">
            <i class="fa-solid fa-plus"></i> ØªÙˆØ«ÙŠÙ‚ Ø¥Ù†Ø¬Ø§Ø²
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script nonce="{{ CSP_NONCE }}">
  (function(){
    var overlay = document.getElementById('homeNotifOverlay');
    if(!overlay) return;

    var closeBtn = document.getElementById('homeNotifClose');
    var modal = overlay.querySelector('.hn-modal');

    var recipientId = overlay.getAttribute('data-recipient-id') || '';
    var storageKey = recipientId ? ('hn_dismissed_recipient_' + recipientId) : '';

    function hide(){
      overlay.classList.remove('is-open');
      try{
        if(window.__lockScroll) window.__lockScroll(false);
        if(window.__trapFocus && modal) window.__trapFocus(modal, false);
      }catch(e){
        // ignore
      }
    }

    async function markRead(){
      var url = overlay.getAttribute('data-mark-url');
      if(!url) return;

      try{
        var csrftoken = (window.getCsrfToken ? window.getCsrfToken() : (window.csrfToken || ''));
        await fetch(url, {
          method: 'POST',
          headers: {
            'X-CSRFToken': csrftoken || '',
            'X-Requested-With': 'XMLHttpRequest'
          },
          credentials: 'same-origin'
        });
      }catch(e){
        // ignore
      }
    }

    function openModal(){
      try{
        if(window.__lockScroll) window.__lockScroll(true);
        if(window.__trapFocus && modal) window.__trapFocus(modal, true);
      }catch(e){
        // ignore
      }
    }

    // Ø¥Ù† ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ØºÙ„Ù‚Ù‡Ø§ Ø³Ø§Ø¨Ù‚Ø§Ù‹ Ù„Ù†ÙØ³ Ø§Ù„Ù…Ø³ØªÙ„Ù…
    try{
      if(storageKey && window.localStorage && localStorage.getItem(storageKey) === '1'){
        hide();
        markRead();
        return;
      }
    }catch(e){
      // ignore
    }

    // Ù…ÙˆØ¯Ø§Ù„ Ù…ÙØªÙˆØ­ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø¥Ø´Ø¹Ø§Ø±
    openModal();

    // Ø¥ØºÙ„Ø§Ù‚ Ø¨Ø§Ù„Ø²Ø±
    if(closeBtn){
      closeBtn.addEventListener('click', function(){
        try{
          if(storageKey && window.localStorage) localStorage.setItem(storageKey, '1');
        }catch(e){
          // ignore
        }
        markRead();
        hide();
      });
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
    overlay.addEventListener('click', function(ev){
      if(ev.target === overlay){
        try{
          if(storageKey && window.localStorage) localStorage.setItem(storageKey, '1');
        }catch(e){
          // ignore
        }
        markRead();
        hide();
      }
    });

    // Ø¥ØºÙ„Ø§Ù‚ Ø¨Ù€ ESC
    document.addEventListener('keydown', function(ev){
      if(ev.key === 'Escape' && overlay.classList.contains('is-open')){
        try{
          if(storageKey && window.localStorage) localStorage.setItem(storageKey, '1');
        }catch(e){
          // ignore
        }
        markRead();
        hide();
      }
    });
  })();
</script>
{% endblock %}
