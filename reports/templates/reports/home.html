{# reports/templates/reports/home.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© | {{ request.user.name|default:"Ù…Ø±Ø­Ø¨Ø§Ù‹" }}{% endblock %}

{% block head %}
<style>
  /* === Neo-Professional 2026 Dashboard Theme === */
  :root {
    --dash-brand: #2563eb;       /* Royal Blue */
    --dash-brand-dark: #1e40af;
    --dash-brand-light: #eff6ff;
    --dash-accent: #059669;      /* Emerald */
    --dash-ink: #0f172a;         /* Slate 900 */
    --dash-muted: #64748b;       /* Slate 500 */
    --dash-border: #e2e8f0;      /* Slate 200 */
    --dash-bg: #f8fafc;          /* Slate 50 */
    --dash-card: #ffffff;
    
    --radius-xl: 20px;
    --radius-lg: 16px;
    --radius-md: 12px;
    
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
    --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.08);
  }

  .home-wrapper {
    max-width: 1280px;
    margin: 0 auto;
    font-family: 'Tajawal', sans-serif;
    color: var(--dash-ink);
    padding-bottom: 60px;
  }

  /* 1. Hero Section */
  .hero-section {
    position: relative;
    background: linear-gradient(135deg, var(--dash-brand) 0%, var(--dash-brand-dark) 100%);
    border-radius: var(--radius-xl);
    padding: 32px 40px;
    color: #fff;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    gap: 24px;
    margin-bottom: 24px;
  }
  
  /* Abstract Pattern Overlay */
  .hero-section::before {
    content: ''; position: absolute; inset: 0;
    background-image: radial-gradient(circle at 10% 10%, rgba(255,255,255,0.08) 0%, transparent 20%),
                      radial-gradient(circle at 90% 90%, rgba(255,255,255,0.08) 0%, transparent 20%);
    pointer-events: none;
  }

  .hero-content { position: relative; z-index: 2; max-width: 650px; }
  .hero-sub { 
    text-transform: uppercase; 
    letter-spacing: 1px; 
    font-size: 0.85rem; 
    font-weight: 700; 
    opacity: 0.8; 
    margin-bottom: 8px; 
  }
  .hero-title { 
    font-size: clamp(1.8rem, 4vw, 2.5rem); 
    font-weight: 800; 
    margin: 0 0 12px 0; 
    line-height: 1.2; 
  }
  .hero-desc { 
    font-size: 1.05rem; 
    line-height: 1.6; 
    opacity: 0.95; 
    max-width: 50ch; 
  }

  .hero-grid-actions {
    display: flex; gap: 12px; flex-wrap: wrap; margin-top: 24px;
  }

  .btn-white {
    background: #fff; color: var(--dash-brand); border: none; font-weight: 700;
    padding: 12px 24px; border-radius: 10px; display: inline-flex; align-items: center; gap: 8px;
    text-decoration: none; transition: transform 0.2s, box-shadow 0.2s;
  }
  .btn-white:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); color: var(--dash-brand-dark); }
  
  .btn-glass {
    background: rgba(255,255,255,0.15); color: #fff; border: 1px solid rgba(255,255,255,0.3);
    font-weight: 600; padding: 12px 24px; border-radius: 10px; display: inline-flex; align-items: center; gap: 8px;
    text-decoration: none; backdrop-filter: blur(4px); transition: background 0.2s;
  }
  .btn-glass:hover { background: rgba(255,255,255,0.25); border-color: #fff; }

  /* 2. Stats Grid */
  .stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 16px;
    margin-bottom: 32px;
  }

  .stat-card {
    background: var(--dash-card);
    border: 1px solid var(--dash-border);
    border-radius: var(--radius-lg);
    padding: 24px;
    position: relative;
    overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: var(--shadow-sm);
  }
  .stat-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); border-color: #cbd5e1; }
  
  .stat-head { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
  .stat-icon {
    width: 48px; height: 48px; border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.4rem;
  }
  .stat-val { font-size: 2.2rem; font-weight: 800; color: var(--dash-ink); line-height: 1; margin-bottom: 4px; }
  .stat-lbl { font-size: 0.95rem; font-weight: 600; color: var(--dash-muted); }

  /* Stat Variants */
  .st-prim .stat-icon { background: var(--dash-brand-light); color: var(--dash-brand); }
  .st-accent .stat-icon { background: #ecfdf5; color: #059669; } /* Green */
  .st-warn .stat-icon { background: #fffbeb; color: #d97706; }   /* Amber */
  .st-info .stat-icon { background: #f0f9ff; color: #0ea5e9; }   /* Sky */

  /* 3. Main Split */
  .main-split { display: grid; gap: 24px; grid-template-columns: 2.2fr 1fr; }
  @media (max-width: 900px) { .main-split { grid-template-columns: 1fr; } }
  
  /* Section Headers */
  .sec-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
  .sec-title { font-size: 1.15rem; font-weight: 800; margin: 0; display: flex; align-items: center; gap: 8px; }
  .sec-link { font-size: 0.9rem; color: var(--dash-brand); text-decoration: none; font-weight: 600; }
  .sec-link:hover { text-decoration: underline; }

  /* List Items */
  .lux-list { display: flex; flex-direction: column; gap: 10px; }
  .lux-item {
    background: var(--dash-card);
    border: 1px solid var(--dash-border);
    border-radius: var(--radius-md);
    padding: 16px;
    display: flex;
    align-items: center;
    gap: 16px;
    text-decoration: none;
    color: var(--dash-ink);
    transition: all 0.2s;
  }
  .lux-item:hover { transform: translateX(-4px); border-color: var(--dash-border); box-shadow: var(--shadow-sm); }
  
  .li-icon {
    width: 42px; height: 42px; background: var(--dash-bg); color: var(--dash-muted);
    border-radius: 10px; display: flex; align-items: center; justify-content: center;
    font-size: 1.1rem; flex-shrink: 0;
  }
  .li-body { flex: 1; min-width: 0; }
  .li-title { font-weight: 700; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .li-meta { font-size: 0.85rem; color: var(--dash-muted); display: flex; align-items: center; gap: 10px; }
  
  /* Sidebar Widgets */
  .widget-card {
    background: var(--dash-card);
    border: 1px solid var(--dash-border);
    border-radius: var(--radius-lg);
    padding: 20px;
    margin-bottom: 16px;
    box-shadow: var(--shadow-sm);
  }
  
  /* Notifications Badge */
  .notif-badge { 
    background: #ef4444; color: #fff; font-size: 0.75rem; font-weight: 700; 
    padding: 2px 8px; border-radius: 99px; margin-right: 6px; 
  }

  /* Motivation Banner */
  .motiv-banner {
    background: linear-gradient(135deg, #10b981 0%, #047857 100%);
    color: #fff;
    padding: 24px;
    border-radius: var(--radius-lg);
  }

  /* --- Notification Modal (Overlay) --- */
  .hn-overlay {
    position: fixed; inset: 0; z-index: 9000;
    background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px);
    display: none; place-items: center; padding: 16px;
  }
  .hn-overlay.is-open { display: grid; }
  
  .hn-modal {
    width: 100%; max-width: 500px;
    background: #fff; border-radius: 20px;
    box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
    overflow: hidden; animation: popIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }
  @keyframes popIn { from { opacity:0; transform:scale(0.95) translateY(10px); } to { opacity:1; transform:none; } }
  
  .hn-head {
    background: #f8fafc; padding: 16px 20px; border-bottom: 1px solid #e2e8f0;
    display: flex; justify-content: space-between; align-items: center;
  }
  .hn-head h3 { margin: 0; font-size: 1.1rem; font-weight: 800; color: #0f172a; display: flex; align-items: center; gap: 8px; }
  .hn-close { 
    background: transparent; border: none; font-size: 1.5rem; color: #64748b; cursor: pointer; line-height: 1; 
  }
  .hn-close:hover { color: #ef4444; }
  
  .hn-body { padding: 24px; font-size: 1rem; line-height: 1.6; color: #334155; }
  .hn-foot { 
    padding: 12px 24px; background: #fff; font-size: 0.9rem; color: #64748b; 
    border-top: 1px solid #f1f5f9; display: flex; justify-content: space-between;
  }

  /* Mobile tweaks */
  @media (max-width: 600px) {
    .hero-section { padding: 24px; flex-direction: column; align-items: stretch; }
    .hero-title { font-size: 1.8rem; }
    .hero-grid-actions { flex-direction: column; }
    .btn-white, .btn-glass { width: 100%; justify-content: center; }
  }
</style>
{% endblock %}

{% block content %}
<div class="home-wrapper" dir="rtl">

  <!-- NOTIFICATION POPUP -->
  {% if home_notification %}
    <div class="hn-overlay is-open" id="notifOverlay"
         {% if home_notification_recipient_id %}
           data-recipient="{{ home_notification_recipient_id }}"
           data-url="{% url 'reports:notification_mark_read' home_notification_recipient_id %}"
         {% endif %}>
      <div class="hn-modal">
        <div class="hn-head">
          <h3>
             <i class="fa-solid fa-bell" style="color:#f59e0b;"></i>
             Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
             {% if home_notification.is_important %}
               <span style="background:#fee2e2;color:#ef4444;font-size:0.7em;padding:2px 8px;border-radius:12px;margin-right:6px">Ù‡Ø§Ù…</span>
             {% endif %}
          </h3>
          <button type="button" class="hn-close" id="notifClose">Ã—</button>
        </div>
        <div class="hn-body">
            {% if home_notification.title %}
              <div style="font-weight:800; margin-bottom:8px; font-size:1.1rem; color:#0f172a;">{{ home_notification.title }}</div>
            {% endif %}
            {{ home_notification.message|linebreaksbr }}
        </div>
        <div class="hn-foot">
            <span style="font-weight:700">
                <i class="fa-solid fa-user-pen"></i>&nbsp;
                {% if home_notification.created_by %}
                {% firstof home_notification.created_by.name home_notification.created_by.phone "â€”" %}
                {% else %}
                    Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                {% endif %}
            </span>
            <span dir="ltr">{{ home_notification.created_at|date:"Y-m-d H:i" }}</span>
        </div>
      </div>
    </div>
  {% endif %}

  <!-- 1. HERO SECTION -->
  <section class="hero-section">
    <div class="hero-content">
      <div class="hero-sub">{% if SCHOOL_NAME %}{{ SCHOOL_NAME }}{% else %}Ù…Ù†ØµØ© ØªÙˆØ«Ù€ÙŠÙ‚{% endif %}</div>
      <h1 class="hero-title">Ø£Ù‡Ù„Ù‹Ø§ØŒ {{ request.user.name|default:"Ù…Ø³ØªØ®Ø¯Ù…Ù†Ø§ Ø§Ù„Ø¹Ø²ÙŠØ²" }} ğŸ‘‹</h1>
      <p class="hero-desc">
        Ø¹ÙˆØ¯Ø§Ù‹ Ø­Ù…ÙŠØ¯Ø§Ù‹! Ù„Ø¯ÙŠÙƒ Ø§Ù„ÙŠÙˆÙ… ÙØ±ØµØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªÙˆØ«ÙŠÙ‚ Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© ØªÙ‚Ø¯Ù…Ùƒ Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø©.
      </p>

      <div class="hero-grid-actions">
        <!-- Main CTAs -->
        <a href="{% url 'reports:add_report' %}" class="btn-white">
          <i class="fa-solid fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© ØªÙ‚Ø±ÙŠØ±
        </a>
        <a href="{% url 'reports:my_reports' %}" class="btn-glass">
            <i class="fa-solid fa-folder-open"></i> ØªÙ‚Ø§Ø±ÙŠØ±ÙŠ
        </a>
        
        <!-- Conditional CTAs based on nav/context -->
        {% url 'reports:my_notifications' as notifUrl %}
        {% if notifUrl %}
            <a href="{{ notifUrl }}" class="btn-glass" style="position:relative">
                <i class="fa-regular fa-bell"></i>
                {% if NAV_NOTIFICATIONS_UNREAD %}
                    <span style="position:absolute;top:-5px;right:-5px;background:#ef4444;width:10px;height:10px;border-radius:50%;border:2px solid var(--dash-brand)"></span>
                {% endif %}
            </a>
        {% endif %}

        {% url 'reports:my_circulars' as circUrl %}
        {% if circUrl %}
            <a href="{{ circUrl }}" class="btn-glass" title="Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ…">
                <i class="fa-solid fa-bullhorn"></i>
                {% if NAV_SIGNATURES_PENDING %}<span class="notif-badge" style="background:#fff;color:#ef4444;margin-right:6px">{{ NAV_SIGNATURES_PENDING }}</span>{% endif %}
            </a>
        {% endif %}
      </div>
    </div>
    
    <!-- Optional Graphic/Icon on the left for larger screens -->
    <div style="font-size:8rem; opacity:0.15; transform:rotate(-15deg); display:none; @media(min-width:768px){display:block;}">
        <i class="fa-solid fa-chart-pie"></i>
    </div>
  </section>

  <!-- PENDING SIGNATURES ALERT -->
  {% if NAV_SIGNATURES_PENDING %}
    <div style="background:#fef2f2; border:1px solid #fecaca; border-radius:12px; padding:16px; margin-bottom:24px; display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px;">
        <div style="display:flex; align-items:center; gap:12px; color:#991b1b;">
            <i class="fa-solid fa-triangle-exclamation fa-lg"></i>
            <div>
                <div style="font-weight:800; font-size:1.05rem;">ØªÙ†Ø¨ÙŠÙ‡: ØªØ¹Ø§Ù…ÙŠÙ… Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</div>
                <div style="font-size:0.9rem; opacity:0.9;">Ù„Ø¯ÙŠÙƒ <strong>{{ NAV_SIGNATURES_PENDING }}</strong> ØªØ¹Ù…ÙŠÙ… ÙŠØªØ·Ù„Ø¨ Ø§Ø·Ù„Ø§Ø¹Ùƒ ÙˆØªÙˆÙ‚ÙŠØ¹Ùƒ.</div>
            </div>
        </div>
        <a href="{% url 'reports:my_circulars' %}" style="background:#dc2626; color:#fff; text-decoration:none; padding:8px 16px; border-radius:8px; font-weight:700; font-size:0.9rem;">Ø¹Ø±Ø¶ ÙˆØªÙˆÙ‚ÙŠØ¹</a>
    </div>
  {% endif %}

  <!-- 2. STATS OVERVIEW -->
  <section class="stats-container">
    <!-- Today -->
    <div class="stat-card st-prim">
      <div class="stat-head">
        <div class="stat-icon"><i class="fa-solid fa-calendar-day"></i></div>
        {% if stats.today_count > 0 %} <span style="background:#dbeafe;color:#1e40af;padding:4px 10px;border-radius:20px;font-size:0.8rem;font-weight:700;">Ù†Ø´Ø· Ø§Ù„ÙŠÙˆÙ…</span> {% endif %}
      </div>
      <div class="stat-val">{{ stats.today_count|default:"0" }}</div>
      <div class="stat-lbl">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…</div>
    </div>

    <!-- Total -->
    <div class="stat-card st-info">
      <div class="stat-head">
        <div class="stat-icon"><i class="fa-solid fa-layer-group"></i></div>
      </div>
      <div class="stat-val">{{ stats.total_count|default:"0" }}</div>
      <div class="stat-lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
    </div>

    <!-- In Progress Requests -->
    <div class="stat-card st-accent">
      <div class="stat-head">
        <div class="stat-icon"><i class="fa-solid fa-hourglass-half"></i></div>
      </div>
      <div class="stat-val">{{ req_stats.in_progress|default:"0" }}</div>
      <div class="stat-lbl">Ø·Ù„Ø¨Ø§Øª Ø¬Ø§Ø±ÙŠØ©</div>
    </div>

    <!-- Alerts/Inbox -->
    <div class="stat-card st-warn">
      <div class="stat-head">
        <div class="stat-icon"><i class="fa-regular fa-bell"></i></div>
      </div>
      <div class="stat-val">{{ req_stats.open|default:"0" }}</div>
      <div class="stat-lbl">Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©/ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</div>
    </div>
  </section>

  <!-- 3. MAIN SPLIT CONTENT -->
  <div class="main-split">
    
    <!-- LEFT: RECENT REPORTS -->
    <div>
        <div class="sec-header">
            <h3 class="sec-title"><i class="fa-solid fa-clock-rotate-left" style="color:var(--dash-brand);"></i> Ø£Ø­Ø¯Ø« Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</h3>
            <a href="{% url 'reports:my_reports' %}" class="sec-link">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
        </div>
        
        {% if recent_reports %}
            <div class="lux-list">
                {% for r in recent_reports %}
                <a href="{% url 'reports:report_print' r.id %}?next={{ request.get_full_path|urlencode }}" class="lux-item">
                    <div class="li-icon">
                        <i class="fa-regular fa-file-lines"></i>
                    </div>
                    <div class="li-body">
                        <div class="li-title">{{ r.title }}</div>
                        <div class="li-meta">
                            <span><i class="fa-regular fa-calendar" style="font-size:0.8em"></i> {{ r.report_date }}</span>
                            <span>â€¢</span>
                            <span>{{ r.day_name }}</span>
                            {% if r.category %}<span style="background:#f1f5f9;padding:2px 8px;border-radius:6px;font-size:0.8em;font-weight:600">{{ r.category.name }}</span>{% endif %}
                        </div>
                    </div>
                    <div style="color:var(--dash-muted);opacity:0.5">
                        <i class="fa-solid fa-chevron-left"></i>
                    </div>
                </a>
                {% endfor %}
            </div>
        {% else %}
            <div style="background:var(--dash-card); border:1px dashed var(--dash-border); border-radius:var(--radius-lg); padding:40px; text-align:center;">
                <i class="fa-regular fa-folder-open fa-3x" style="color:#cbd5e1; margin-bottom:16px; display:block;"></i>
                <div style="font-weight:700; color:var(--dash-text); margin-bottom:8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ø­Ø¯ÙŠØ«Ø©</div>
                <div style="color:var(--dash-muted); margin-bottom:16px;">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù„ØªÙˆØ«ÙŠÙ‚Ù‡Ø§ Ù‡Ù†Ø§.</div>
                <a href="{% url 'reports:add_report' %}" style="color:var(--dash-brand); font-weight:700; text-decoration:none;">Ø£Ø¶Ù ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¢Ù† &larr;</a>
            </div>
        {% endif %}
    </div>

    <!-- RIGHT: SIDEBAR -->
    <div class="sidebar-stack">
        
        <!-- Requests Summary Widget -->
        <div class="widget-card">
            <h4 style="margin:0 0 12px 0; font-size:1rem; font-weight:800; display:flex; align-items:center; gap:8px;">
                <i class="fa-solid fa-ticket" style="color:#8b5cf6;"></i> Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            </h4>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:16px;">
                <div style="background:var(--dash-bg); padding:10px; border-radius:10px; text-align:center;">
                    <div style="font-size:1.4rem; font-weight:800; color:#059669">{{ req_stats.done|default:"0" }}</div>
                    <div style="font-size:0.8rem; font-weight:600; color:#64748b">Ù…ÙƒØªÙ…Ù„Ø©</div>
                </div>
                <div style="background:var(--dash-bg); padding:10px; border-radius:10px; text-align:center;">
                    <div style="font-size:1.4rem; font-weight:800; color:#ef4444">{{ req_stats.rejected|default:"0" }}</div>
                    <div style="font-size:0.8rem; font-weight:600; color:#64748b">Ù…Ø±ÙÙˆØ¶Ø©</div>
                </div>
            </div>
            
            <a href="{% url 'reports:request_create' %}" style="display:block; width:100%; padding:10px; text-align:center; background:#8b5cf6; color:#fff; border-radius:8px; text-decoration:none; font-weight:700; margin-bottom:8px; transition:opacity 0.2s;">
                <i class="fa-solid fa-plus"></i> ÙØªØ­ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
            </a>
            <a href="{% url 'reports:my_requests' %}" style="display:block; width:100%; padding:10px; text-align:center; background:var(--dash-bg); color:var(--dash-ink); border-radius:8px; text-decoration:none; font-weight:600;">
                Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            </a>
        </div>

        {% url 'reports:assigned_to_me' as assignedUrl %}
        {% if assignedUrl %}
        <a href="{{ assignedUrl }}" class="widget-card" style="display:flex; align-items:center; justify-content:space-between; text-decoration:none; color:inherit; transition:transform 0.2s;">
            <div style="display:flex; align-items:center; gap:12px;">
                <div style="width:36px; height:36px; background:#eff6ff; color:#2563eb; border-radius:8px; display:flex; align-items:center; justify-content:center;"><i class="fa-solid fa-inbox"></i></div>
                <div style="font-weight:700;">Ø§Ù„ÙˆØ§Ø±Ø¯ (Ø§Ù„Ù…Ø¹ÙŠÙ† Ù„ÙŠ)</div>
            </div>
            <i class="fa-solid fa-chevron-left" style="font-size:0.8em; opacity:0.5"></i>
        </a>
        {% endif %}

        <a href="{% url 'reports:achievement_my_files' %}" class="widget-card" style="display:flex; align-items:center; justify-content:space-between; text-decoration:none; color:inherit; transition:transform 0.2s;">
            <div style="display:flex; align-items:center; gap:12px;">
                <div style="width:36px; height:36px; background:#fff7ed; color:#ea580c; border-radius:8px; display:flex; align-items:center; justify-content:center;"><i class="fa-solid fa-briefcase"></i></div>
                <div style="font-weight:700;">Ù…Ù„Ù Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</div>
            </div>
            <i class="fa-solid fa-chevron-left" style="font-size:0.8em; opacity:0.5"></i>
        </a>

        <!-- Motivation -->
        <div class="motiv-banner">
            <h4 style="margin:0 0 8px 0; font-size:1.1rem;"><i class="fa-solid fa-bolt"></i> Ø¥Ù†Ø¬Ø§Ø² Ø³Ø±ÙŠØ¹!</h4>
            <p style="margin:0 0 16px 0; font-size:0.95rem; opacity:0.9; line-height:1.5;">
                Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ÙÙˆØ±ÙŠ ÙŠÙˆÙØ± Ø¬Ù‡Ø¯Ùƒ ÙˆÙˆÙ‚ØªÙƒ Ù„Ø§Ø­Ù‚Ø§Ù‹. Ù„Ø§ ØªØ¤Ø¬Ù„ Ø¹Ù…Ù„ Ø§Ù„ÙŠÙˆÙ….
            </p>
            <a href="{% url 'reports:add_report' %}" style="display:inline-block; background:rgba(255,255,255,0.2); color:#fff; padding:6px 14px; border-radius:6px; font-size:0.9rem; font-weight:700; text-decoration:none;">ÙˆØ«Ù‘Ù‚ Ø§Ù„Ø¢Ù†</a>
        </div>

    </div>
  </div>

</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const overlay = document.getElementById('notifOverlay');
    if(!overlay) return;

    const closeBtn = document.getElementById('notifClose');
    const recipientId = overlay.dataset.recipient;
    const markUrl = overlay.dataset.url;
    const storageKey = recipientId ? `hn_saw_${recipientId}` : null;

    // Check localStorage
    if(storageKey && localStorage.getItem(storageKey)){
        overlay.classList.remove('is-open');
        overlay.remove(); // Remove entirely
        if(markUrl) markRead(markUrl); // Should be marked read anyway
        return;
    }

    const closeNotif = () => {
        overlay.classList.remove('is-open');
        if(storageKey) localStorage.setItem(storageKey, '1');
        if(markUrl) markRead(markUrl);
    };

    if(closeBtn) closeBtn.addEventListener('click', closeNotif);
    overlay.addEventListener('click', (e) => {
        if(e.target === overlay) closeNotif();
    });
    document.addEventListener('keydown', (e) => {
        if(e.key === 'Escape') closeNotif();
    });

    async function markRead(url){
        try {
            const token = document.querySelector('[name=csrfmiddlewaretoken]')?.value 
                          || document.cookie.split('; ').find(r => r.startsWith('csrftoken='))?.split('=')[1];
            await fetch(url, {
                method: 'POST',
                headers: { 'X-CSRFToken': token, 'X-Requested-With': 'XMLHttpRequest' }
            });
        } catch(e) { console.error(e); }
    }
});
</script>
{% endblock %}
