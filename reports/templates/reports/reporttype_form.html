{# reports/templates/reports/reporttype_form.html (Ù…Ø«Ø§Ù„ Ø§Ø³Ù…) #}
{% extends "base.html" %}

{% block title %}
  {% if mode == "edit" %}ØªØ¹Ø¯ÙŠÙ„ Ù†ÙˆØ¹ ØªÙ‚Ø±ÙŠØ±{% else %}Ø¥Ø¶Ø§ÙØ© Ù†ÙˆØ¹ ØªÙ‚Ø±ÙŠØ±{% endif %}
{% endblock %}

{% block head %}
<style>
  /* =========================================================
     ReportType Form â€” RTL / Tailwind-like polish (Ø¨Ø¯ÙˆÙ† ÙƒØ³Ø± base/app.css)
     ========================================================= */
  .rt-wrap{max-width:860px;margin:0 auto;padding:18px}
  .rt-card{padding:18px}

  .rt-head{
    display:flex;justify-content:space-between;align-items:flex-start;
    gap:12px;flex-wrap:wrap;margin-bottom:12px
  }
  .rt-title{margin:0;font-weight:950;font-size:1.3rem;color:var(--ink)}
  .rt-sub{margin:6px 0 0;color:var(--muted);font-weight:850;line-height:1.6;max-width:680px}

  .rt-badge{
    display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;
    background:rgba(37,99,235,.10);color:var(--brand);
    border:1px solid rgba(37,99,235,.18);font-weight:950;white-space:nowrap
  }

  .rt-alert{
    border-radius:14px;padding:12px 14px;font-weight:900;
    border:1px solid var(--line-2);background:rgba(239,68,68,.08);color:var(--danger)
  }
  .rt-alert ul{margin:0;padding-right:18px}
  .rt-alert li{margin:4px 0}

  .rt-form{display:grid;gap:12px}
  .rt-grid{display:grid;gap:12px}
  @media(min-width:860px){.rt-grid{grid-template-columns:1fr 1fr}}

  .rt-field{position:relative}
  .rt-field label{display:block;font-weight:950;color:var(--ink);margin-bottom:6px}
  .rt-help{margin-top:6px;color:var(--muted);font-weight:850;font-size:.88rem;line-height:1.5}
  .rt-err{margin-top:6px;color:var(--danger);font-weight:950;font-size:.9rem}

  /* Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ app.cssØŒ ÙÙ‚Ø· Ù†Ø¶Ù…Ù† full width + ØªØ­Ø³ÙŠÙ†Ø§Øª ØµØºÙŠØ±Ø© */
  .rt-wrap .input,
  .rt-wrap .select,
  .rt-wrap .textarea{
    width:100%;
  }

  .rt-inline{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-top:10px}
  .rt-inline .check-label{font-weight:950;color:var(--ink)}

  .rt-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .rt-actions .btn{min-height:42px}
  .rt-actions .btn-primary{flex:1}

  /* Ø´Ø±ÙŠØ· ØµØºÙŠØ± Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ±Ù… Ù„Ù„ØªÙ„Ù…ÙŠØ­ */
  .rt-tip{
    display:flex;align-items:flex-start;gap:10px;
    padding:10px 12px;border-radius:14px;border:1px solid var(--line);
    background:linear-gradient(180deg, var(--line-2), var(--card));
    color:var(--ink);font-weight:850
  }
  html[data-theme="dark"] .rt-tip{border-color:#1b2744;background:rgba(20,35,73,.35)}
  .rt-tip i{margin-top:2px;opacity:.85}
</style>
{% endblock %}

{% block content %}
<div class="container rt-wrap" dir="rtl">
  <div class="card rt-card">

    <div class="rt-head">
      <div>
        <h1 class="rt-title">
          {% if mode == "edit" %}
            âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ù†ÙˆØ¹ ØªÙ‚Ø±ÙŠØ±
          {% else %}
            â• Ø¥Ø¶Ø§ÙØ© Ù†ÙˆØ¹ ØªÙ‚Ø±ÙŠØ±
          {% endif %}
        </h1>
        <p class="rt-sub">Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ØªØ¸Ù‡Ø± ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØªÙØ³ØªØ®Ø¯Ù… Ù„Ù„ÙÙ„Ø§ØªØ± ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©.</p>
      </div>

      <span class="rt-badge" aria-label="ÙˆØ¶Ø¹ Ø§Ù„ØµÙØ­Ø©">
        {% if mode == "edit" %}ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„{% else %}ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ©{% endif %}
      </span>
    </div>

    <div class="rt-tip" style="margin-bottom:12px">
      <i class="fa-solid fa-circle-info"></i>
      <div>
        <div style="font-weight:950;margin-bottom:2px">ØªÙ†Ø¨ÙŠÙ‡</div>
        <div style="color:var(--muted);font-weight:850;line-height:1.6">
          Ø§Ù„Ø±Ù…Ø² <b>(code)</b> ÙŠÙØ­ÙØ¸ Ø¯Ø§Ø®Ù„ <code>Report.category</code>. Ø§Ø®ØªÙØ± Ù‚ÙŠÙ…Ø© Ø«Ø§Ø¨ØªØ© ÙˆÙ„Ø§ ØªØºÙŠÙ‘Ø±Ù‡Ø§ ÙƒØ«ÙŠØ±Ù‹Ø§ Ø¨Ø¹Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†ÙˆØ¹ ÙÙŠ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±.
        </div>
      </div>
    </div>

    {% if form.non_field_errors %}
      <div class="rt-alert" data-autohide="false" style="margin-bottom:12px">
        <ul>
          {% for e in form.non_field_errors %}
            <li>{{ e }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    <form method="post" class="rt-form" novalidate>
      {% csrf_token %}

      <div class="rt-grid">
        <div class="rt-field">
          <label for="{{ form.name.id_for_label }}">Ø§Ù„Ø§Ø³Ù…</label>
          {{ form.name }}
          {% if form.name.errors %}
            <div class="rt-err">{{ form.name.errors.0 }}</div>
          {% endif %}
        </div>

        <div class="rt-field">
          <label for="{{ form.code.id_for_label }}">Ø§Ù„Ø±Ù…Ø² (code)</label>
          {{ form.code }}
          <div class="rt-help">
            ÙŠÙÙØ¶Ù‘Ù„ Ø£Ø­Ø±Ù Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ØµØºÙŠØ±Ø© ÙˆØ´Ø±Ø·Ø© Ø³ÙÙ„ÙŠØ©. Ù…Ø«Ø§Ù„: <code>activity</code> Ø£Ùˆ <code>school_affairs</code>.
          </div>
          {% if form.code.errors %}
            <div class="rt-err">{{ form.code.errors.0 }}</div>
          {% endif %}
        </div>
      </div>

      {% if form.description %}
        <div class="rt-field">
          <label for="{{ form.description.id_for_label }}">Ø§Ù„ÙˆØµÙ</label>
          {{ form.description }}
          {% if form.description.errors %}
            <div class="rt-err">{{ form.description.errors.0 }}</div>
          {% endif %}
        </div>
      {% endif %}

      <div class="rt-grid">
        <div class="rt-field">
          <label for="{{ form.order.id_for_label }}">Ø§Ù„ØªØ±ØªÙŠØ¨</label>
          {{ form.order }}
          <div class="rt-help">ÙƒÙ„Ù…Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… Ø£Ù‚Ù„ Ø¸Ù‡Ø± Ø§Ù„Ù†ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹.</div>
          {% if form.order.errors %}
            <div class="rt-err">{{ form.order.errors.0 }}</div>
          {% endif %}
        </div>

        <div class="rt-field">
          <label style="visibility:hidden">Ù†Ø´Ø·</label>
          <div class="rt-inline">
            {{ form.is_active }}
            <label class="check-label" for="{{ form.is_active.id_for_label }}">Ù†Ø´Ø· (ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬)</label>
          </div>
          {% if form.is_active.errors %}
            <div class="rt-err">{{ form.is_active.errors.0 }}</div>
          {% endif %}
        </div>
      </div>

      {% for h in form.hidden_fields %}{{ h }}{% endfor %}

      <div class="rt-actions">
        <button type="submit" class="btn btn-primary">ğŸ’¾ Ø­ÙØ¸</button>
        <a class="btn btn-outline" href="{% url 'reports:reporttypes_list' %}">â†©ï¸ Ø±Ø¬ÙˆØ¹</a>
      </div>
    </form>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script nonce="{{ CSP_NONCE }}">
  (function(){
    // Ø¥Ø¶Ø§ÙØ© classØ§Øª Ù…ÙˆØ­Ù‘Ø¯Ø© Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø¯ÙˆÙ† ÙÙ„Ø§ØªØ± Django
    const map = [
      ['input[type="text"]', 'input'],
      ['input[type="number"]', 'input'],
      ['input[type="email"]', 'input'],
      ['input[type="url"]', 'input'],
      ['input[type="search"]', 'input'],
      ['select', 'select'],
      ['textarea', 'textarea']
    ];

    map.forEach(([sel, cls]) => {
      document.querySelectorAll('.rt-wrap ' + sel).forEach(el => {
        if (!el.classList.contains(cls)) el.classList.add(cls);
      });
    });

    // ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© code: ØªØ­ÙˆÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ù„Ù‰ lower_snake_case Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© (Ø¨Ø¯ÙˆÙ† Ø¥Ø¬Ø¨Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ù„ØµÙ‚)
    var codeEl = document.querySelector('.rt-wrap #{{ form.code.id_for_label }}');
    if(codeEl){
      codeEl.setAttribute('inputmode','latin');
      codeEl.setAttribute('autocomplete','off');

      codeEl.addEventListener('input', function(){
        var v = (codeEl.value || '');
        // Ù†ØªØ±Ùƒ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø´Ø±Ø·Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ©ØŒ ÙˆÙ†Ø­ÙˆÙ‘Ù„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØ§Ù„Ø´Ø±Ø·Ø§Øª Ø¥Ù„Ù‰ _
        v = v.toLowerCase().replace(/\s+/g,'_').replace(/-+/g,'_').replace(/[^a-z0-9_]/g,'');
        // Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± __
        v = v.replace(/_+/g,'_');
        // Ù‚Øµ Ù„Ø·ÙˆÙ„ Ù…Ø¹Ù‚ÙˆÙ„ (Ø­ØªÙ‰ Ù„Ø§ ÙŠØ·ÙˆÙ„ Ø§Ù„Ø±Ù…Ø²)
        if(v.length > 50) v = v.slice(0,50);
        codeEl.value = v;
      });
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£ Ø¨Ø§Ù„Ù€Esc Ø¥Ù† ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    document.addEventListener('keydown', function(ev){
      if(ev.key !== 'Escape') return;
      var alertEl = document.querySelector('.rt-alert');
      if(alertEl) alertEl.style.display = 'none';
    });
  })();
</script>
{% endblock %}
