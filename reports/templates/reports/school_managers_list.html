{% extends "base.html" %}
{% block title %}مدراء المدارس{% endblock %}

{% block content %}
<div class="container" dir="rtl">
  <div class="page-head" style="max-width:980px;margin-inline:auto">
    <div>
      <h1 class="page-title">مدراء المدارس</h1>
      <p class="page-subtitle">قائمة بجميع مدراء المدارس والمدارس المرتبطة بكل مدير.</p>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <a class="btn btn-primary" href="{% url 'reports:school_manager_create' %}">+ إنشاء مدير مدرسة جديد</a>
      <a class="btn btn-outline" href="{% url 'reports:schools_admin_list' %}">إدارة المدارس</a>
    </div>
  </div>

  <div style="max-width:980px;margin-inline:auto">
    <div class="card">
      <div class="section-title">قائمة المدراء</div>

      {% if managers %}
      <div class="table-responsive">
        <table class="rtable">
          <thead>
            <tr>
              <th>المدير</th>
              <th>رقم الجوال</th>
              <th>الحالة</th>
              <th>المدارس المرتبطة</th>
              <th>إجراءات</th>
            </tr>
          </thead>
          <tbody>
            {% for item in managers %}
              {% with m=item.manager schools=item.schools %}
              <tr>
                <td data-label="المدير"><b>{{ m.name }}</b></td>
                <td data-label="رقم الجوال">{{ m.phone }}</td>
                <td data-label="الحالة">
                  {% if m.is_active %}
                    <span class="badge success">نشط</span>
                  {% else %}
                    <span class="badge danger">موقوف</span>
                  {% endif %}
                </td>
                <td data-label="المدارس المرتبطة">
                  {% if schools %}
                    {% for s in schools %}
                      {{ s.name }}{% if not forloop.last %}، {% endif %}
                    {% endfor %}
                  {% else %}
                    <span class="muted" style="font-weight:900">لا توجد مدارس مرتبطة</span>
                  {% endif %}
                </td>
                <td data-label="إجراءات">
                  <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-start">
                    <a class="btn btn-outline" href="{% url 'reports:school_manager_update' m.id %}" style="padding:8px 10px">تعديل المدير</a>
                    <a class="btn btn-outline" href="{% url 'reports:manage_teachers' %}" style="padding:8px 10px">قائمة المعلّمين</a>
                    <form method="post" action="{% url 'reports:school_manager_delete' m.id %}" style="display:inline" onsubmit="return confirm('هل أنت متأكد من حذف هذا المدير؟ سيتم إيقاف حسابه وإلغاء صلاحياته.');">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-danger" style="padding:8px 10px">حذف المدير</button>
                    </form>
                  </div>
                </td>
              </tr>
              {% endwith %}
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <div class="muted" style="font-weight:900">لا يوجد أي مدير مدرسة بعد.</div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
