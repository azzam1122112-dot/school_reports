{% extends 'base.html' %}
{% load static humanize %}

{% block title %}Ù„ÙˆØ­Ø© Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… | ØªØ­Ø¯ÙŠØ« 2026{% endblock %}

{% block head %}
<style>
    /* 2026 Modern Dashboard Styling */
    :root {
        --primary-color: #4f46e5; /* Indigo */
        --secondary-color: #10b981; /* Emerald */
        --danger-color: #ef4444; /* Red */
        --warning-color: #f59e0b; /* Amber */
        --dark-bg: #111827;
        --card-bg: #ffffff;
        --text-main: #1f2937;
        --text-muted: #6b7280;
        --border-color: #e5e7eb;
        --radius-lg: 16px;
        --radius-md: 12px;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    [data-theme="dark"] {
        --card-bg: #1f2937;
        --text-main: #f9fafb;
        --text-muted: #9ca3af;
        --border-color: #374151;
    }

    .dashboard-container {
        padding: 2rem;
        max-width: 1440px;
        margin: 0 auto;
    }

    .welcome-header {
        margin-bottom: 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .welcome-title h1 {
        font-size: 1.875rem;
        font-weight: 800;
        color: var(--text-main);
        margin: 0;
    }
    
    .welcome-date {
        color: var(--text-muted);
        font-size: 0.95rem;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2.5rem;
    }

    .stat-card {
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-color);
        transition: transform 0.2s, box-shadow 0.2s;
        display: flex;
        flex-direction: column;
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    .stat-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
    }

    .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        flex-shrink: 0;
    }
    
    .bg-indigo-light { background: #e0e7ff; color: #4338ca; }
    .bg-emerald-light { background: #d1fae5; color: #065f46; }
    .bg-amber-light { background: #fef3c7; color: #92400e; }
    .bg-rose-light { background: #ffe4e6; color: #be123c; }

    .stat-value {
        font-size: 2rem;
        font-weight: 800;
        color: var(--text-main);
        line-height: 1;
        margin-bottom: 0.25rem;
    }

    .stat-label {
        color: var(--text-muted);
        font-size: 0.9rem;
        font-weight: 500;
    }

    /* Sections */
    .section-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text-main);
        margin-bottom: 1.25rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .content-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
    }
    
    @media (max-width: 1024px) {
        .content-grid { grid-template-columns: 1fr; }
    }

    .card-panel {
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-sm);
        overflow: hidden;
        margin-bottom: 2rem;
    }
    
    .card-header {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(0,0,0,0.01);
    }

    .card-body {
        padding: 1.5rem;
    }

    /* Activity Feed & Tables */
    .modern-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .modern-table th {
        text-align: right;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        color: var(--text-muted);
        padding: 1rem 1.5rem;
        background: rgba(0,0,0,0.02);
    }
    
    .modern-table td {
        padding: 1rem 1.5rem;
        color: var(--text-main);
        border-bottom: 1px solid var(--border-color);
        font-size: 0.95rem;
    }
    
    .modern-table tr:last-child td { border-bottom: none; }

    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .status-active { background: #d1fae5; color: #047857; }
    .status-inactive { background: #f3f4f6; color: #374151; }
    .status-warning { background: #fef3c7; color: #b45309; }
    .status-danger { background: #fee2e2; color: #b91c1c; }

    /* Action Buttons */
    .btn-modern {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.625rem 1.25rem;
        background: var(--primary-color);
        color: white;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 0.9rem;
        text-decoration: none;
        transition: all 0.2s;
        border: none;
        cursor: pointer;
    }
    
    .btn-modern:hover {
        background: #4338ca;
        transform: translateY(-1px);
    }
    
    .btn-modern.outline {
        background: transparent;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
    }
    
    .btn-modern.outline:hover {
        background: #eef2ff;
    }

    /* Notification List */
    .notif-item {
        display: flex;
        gap: 1rem;
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
    }
    .notif-item:last-child { border-bottom: none; }
    
    .notif-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: #f3f4f6;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .notif-content h4 { margin: 0 0 0.25rem 0; font-size: 0.95rem; font-weight: 600; color: var(--text-main); }
    .notif-content p { margin: 0; font-size: 0.85rem; color: var(--text-muted); }
    .notif-time { font-size: 0.75rem; color: #9ca3af; margin-top: 0.25rem; display: block; }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    
    <!-- Welcome Header -->
    <div class="welcome-header">
        <div class="welcome-title">
            <h1>Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒØŒ Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… ğŸ‘‹</h1>
            <span class="welcome-date">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†ØµØ© ÙˆØªØ­Ù„ÙŠÙ„Ø§Øª ÙÙˆØ±ÙŠØ©.</span>
        </div>
        <div class="actions" style="display:flex; gap:0.75rem;">
            <a href="{% url 'reports:platform_schools_directory' %}" class="btn-modern outline">
                <i class="fas fa-search"></i> Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³
            </a>
            <a href="{% url 'reports:platform_admin_create' %}" class="btn-modern">
                <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù
            </a>
        </div>
    </div>

    <!-- Main Stats Grid -->
    <div class="stats-grid">
        <!-- Schools -->
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon bg-indigo-light"><i class="fas fa-school"></i></div>
                <span class="status-badge status-active">+{{ platform_schools_active }} Ù†Ø´Ø·Ø©</span>
            </div>
            <div class="stat-value">{{ platform_schools_total }}</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</div>
        </div>

        <!-- Revenue -->
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon bg-emerald-light"><i class="fas fa-coins"></i></div>
            </div>
            <div class="stat-value">{{ total_revenue|intcomma }} Ø±.Ø³</div>
            <div class="stat-label">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</div>
        </div>

        <!-- Reports -->
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon bg-amber-light"><i class="fas fa-file-alt"></i></div>
            </div>
            <div class="stat-value">{{ reports_count }}</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØµØ¯Ø±Ø©</div>
        </div>

        <!-- Tickets -->
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon bg-rose-light"><i class="fas fa-headset"></i></div>
                <span class="status-badge status-danger">{{ tickets_open }} Ù…ÙØªÙˆØ­Ø©</span>
            </div>
            <div class="stat-value">{{ tickets_total }}</div>
            <div class="stat-label">ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</div>
        </div>
    </div>

    <!-- System Actions Grid -->
    <div style="margin-bottom: 2.5rem;">
        <h3 class="section-title"><i class="fas fa-cogs"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
        <div class="stats-grid" style="grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));">
            <a href="{% url 'reports:platform_subscriptions_list' %}" class="stat-card" style="text-decoration:none; align-items:center; text-align:center; padding:2rem; justify-content:center;">
                <div class="stat-icon bg-indigo-light" style="margin-bottom:1rem;"><i class="fas fa-file-invoice-dollar"></i></div>
                <span class="stat-value" style="font-size:1.1rem;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</span>
            </a>
            <a href="{% url 'reports:platform_plans_list' %}" class="stat-card" style="text-decoration:none; align-items:center; text-align:center; padding:2rem; justify-content:center;">
                <div class="stat-icon bg-emerald-light" style="margin-bottom:1rem;"><i class="fas fa-tags"></i></div>
                <span class="stat-value" style="font-size:1.1rem;">Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</span>
            </a>
            <a href="{% url 'reports:platform_payments_list' %}" class="stat-card" style="text-decoration:none; align-items:center; text-align:center; padding:2rem; justify-content:center;">
                <div class="stat-icon bg-amber-light" style="margin-bottom:1rem;"><i class="fas fa-receipt"></i></div>
                <span class="stat-value" style="font-size:1.1rem;">Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span>
            </a>
            <a href="{% url 'reports:notifications_create' %}" class="stat-card" style="text-decoration:none; align-items:center; text-align:center; padding:2rem; justify-content:center;">
                <div class="stat-icon bg-rose-light" style="margin-bottom:1rem;"><i class="fas fa-bullhorn"></i></div>
                <span class="stat-value" style="font-size:1.1rem;">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ø§Ù…</span>
            </a>
            <a href="{% url 'reports:platform_admins_list' %}" class="stat-card" style="text-decoration:none; align-items:center; text-align:center; padding:2rem; justify-content:center;">
                <div class="stat-icon" style="background:#f3f4f6; color:#374151; margin-bottom:1rem;"><i class="fas fa-users-cog"></i></div>
                <span class="stat-value" style="font-size:1.1rem;">Ù…Ø´Ø±ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©</span>
            </a>
            <a href="{% url 'reports:school_managers_list' %}" class="stat-card" style="text-decoration:none; align-items:center; text-align:center; padding:2rem; justify-content:center;">
                <div class="stat-icon" style="background:#e0e7ff; color:#4338ca; margin-bottom:1rem;"><i class="fas fa-user-tie"></i></div>
                <span class="stat-value" style="font-size:1.1rem;">Ù…Ø¯Ø±Ø§Ø¡ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³</span>
            </a>
            <a href="{% url 'reports:schools_admin_list' %}" class="stat-card" style="text-decoration:none; align-items:center; text-align:center; padding:2rem; justify-content:center;">
                <div class="stat-icon" style="background:#d1fae5; color:#065f46; margin-bottom:1rem;"><i class="fas fa-school"></i></div>
                <span class="stat-value" style="font-size:1.1rem;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø§Ø±Ø³</span>
            </a>
            <a href="{% url 'reports:school_create' %}" class="stat-card" style="text-decoration:none; align-items:center; text-align:center; padding:2rem; justify-content:center;">
                <div class="stat-icon" style="background:#fef3c7; color:#92400e; margin-bottom:1rem;"><i class="fas fa-plus"></i></div>
                <span class="stat-value" style="font-size:1.1rem;">Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø±Ø³Ø©</span>
            </a>
            <a href="{% url 'reports:platform_audit_logs' %}" class="stat-card" style="text-decoration:none; align-items:center; text-align:center; padding:2rem; justify-content:center;">
                <div class="stat-icon" style="background:#f3f4f6; color:#1f2937; margin-bottom:1rem;"><i class="fas fa-history"></i></div>
                <span class="stat-value" style="font-size:1.1rem;">Ø³Ø¬Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…</span>
            </a>
        </div>
    </div>

    <div class="content-grid">
        <!-- Main Content Area -->
        <div class="main-column">
            
            <!-- Financial Logic / Recent Activity Mockup -->
            <div class="card-panel">
                <div class="card-header">
                    <h3 style="margin:0; font-size:1.1rem; font-weight:700">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª (ØªÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹)</h3>
                </div>
                <div style="overflow-x:auto;">
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</th>
                                <th>Ø§Ù„Ø¨Ø§Ù‚Ø©</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- This data would ideally come from the view. Assuming user hasn't asked us to change the view logic significantly, we might not have the list. But if we do, we iterate. -->
                            <!-- Fallback for now: showing static suggestion if empty or loop if available -->
                            {% if subscriptions_expiring_soon > 0 %}
                            <tr>
                                <td colspan="5" style="text-align:center; padding: 2rem;">
                                    ÙŠÙˆØ¬Ø¯ {{ subscriptions_expiring_soon }} Ø§Ø´ØªØ±Ø§Ùƒ ÙŠÙ†ØªÙ‡ÙŠ Ø®Ù„Ø§Ù„ 30 ÙŠÙˆÙ….
                                    <br><br>
                                    <a href="#" class="btn-modern outline">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</a>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="5" style="text-align:center; color:var(--text-muted);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ØªÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹.</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>

        </div>

        <!-- Sidebar / Alerts -->
        <div class="side-column">
            
            <!-- Notifications Panel -->
            <div class="card-panel">
                <div class="card-header">
                    <h3 style="margin:0; font-size:1.1rem; font-weight:700">ğŸ”” Ø¢Ø®Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3>
                </div>
                <div class="card-body" style="padding:0;">
                    <!-- We need a context variable for notifications. Usually 'notifications' in context processors. -->
                    <!-- Simulating structure -->
                    <div class="notif-item">
                        <div class="notif-icon"><i class="fas fa-info"></i></div>
                        <div class="notif-content">
                            <h4>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯</h4>
                            <p>ØªÙ… ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª.</p>
                            <span class="notif-time">Ø§Ù„Ø¢Ù†</span>
                        </div>
                    </div>
                    {% if tickets_open > 0 %}
                    <div class="notif-item">
                        <div class="notif-icon" style="background:#fee2e2; color:#be123c"><i class="fas fa-ticket-alt"></i></div>
                        <div class="notif-content">
                            <h4>ØªØ°Ø§ÙƒØ± Ù…ÙØªÙˆØ­Ø©</h4>
                            <p>ÙŠÙˆØ¬Ø¯ {{ tickets_open }} ØªØ°ÙƒØ±Ø© Ø¯Ø¹Ù… ÙÙ†ÙŠ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯.</p>
                            <span class="notif-time">ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø³ØªÙ…Ø±</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
                <div style="padding:1rem; border-top:1px solid var(--border-color); text-align:center;">
                    <a href="#" style="font-size:0.9rem; font-weight:600; color:var(--primary-color);">Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</a>
                </div>
            </div>
            
            <!-- Quick Ticket Stats -->
            <div class="card-panel">
                <div class="card-header">
                    <h3 style="margin:0; font-size:1.1rem; font-weight:700">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</h3>
                </div>
                <div class="card-body">
                    <div style="display:flex; justify-content:space-between; margin-bottom:0.75rem;">
                        <span>Ù…ÙƒØªÙ…Ù„Ø©</span>
                        <span class="status-badge status-active">{{ tickets_done }}</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:0.75rem;">
                        <span>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© (Ù…ÙØªÙˆØ­Ø©)</span>
                        <span class="status-badge status-warning">{{ tickets_open }}</span>
                    </div>
                    <div style="display:flex; justify-content:space-between;">
                        <span>Ù…Ø±ÙÙˆØ¶Ø©</span>
                        <span class="status-badge status-danger">{{ tickets_rejected }}</span>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

{% endblock %}
