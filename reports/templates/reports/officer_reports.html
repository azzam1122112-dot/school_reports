{% extends "base.html" %}
{% block title %}Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ - ØªÙ‚Ø§Ø±ÙŠØ± Ù‚Ø³Ù…ÙŠ{% endblock %}

{% block head %}
<style>
  /* ===== Scoped Officer Reports ===== */
  .or-scope{
    --ink: var(--ink, #0f172a);
    --ink-soft: var(--ink-soft, #334155);
    --muted: var(--muted, #64748b);
    --line: var(--line, #e5e7eb);
    --card: var(--card, #ffffff);
    --bg: var(--bg, #f8fafc);
    --brand: var(--brand, #2563eb);
    --accent: var(--accent, #10b981);
    --danger: var(--danger, #ef4444);
    --shadow: var(--shadow, 0 10px 28px rgba(2,6,23,.08));
  }

  .or-scope .wrap{max-width:1400px;margin-inline:auto;padding:18px 14px}
  .or-scope .page-head{margin-bottom:14px}
  .or-scope .title{
    margin:0;
    font-weight:900;
    font-size:1.35rem;
    color:var(--ink);
    display:flex;
    gap:10px;
    align-items:center;
    flex-wrap:wrap;
  }
  .or-scope .subtitle{
    margin:6px 0 0;
    color:var(--muted);
    font-weight:800;
    line-height:1.7;
  }

  .or-scope .card{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:16px;
    box-shadow:var(--shadow);
    padding:18px;
  }

  /* ===== Filters ===== */
  .or-scope .filters-form{margin-bottom:16px}
  .or-scope .filters-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
    gap:12px;
  }
  .or-scope .filter-group{display:flex;flex-direction:column;gap:6px}
  .or-scope .filter-group label{font-weight:900;color:var(--muted)}
  .or-scope .filter-input{
    padding:11px 12px;
    border:1px solid var(--line);
    border-radius:12px;
    font:inherit;
    background:#fff;
    color:var(--ink);
    min-height:44px;
  }
  .or-scope .filter-actions{
    margin-top:12px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    justify-content:flex-start;
  }

  /* ===== Buttons ===== */
  .or-scope .btn{
    display:inline-flex;align-items:center;justify-content:center;gap:8px;
    padding:10px 14px;border-radius:12px;
    font-weight:900;text-decoration:none;
    border:1px solid var(--line);
    background:#fff;color:var(--ink);
    cursor:pointer;
    transition:transform .15s ease, filter .15s ease, background .15s ease;
    min-height:44px;
  }
  .or-scope .btn:hover{transform:translateY(-1px)}
  .or-scope .btn-primary{background:var(--brand);border-color:var(--brand);color:#fff}
  .or-scope .btn-outline{background:#fff;border-color:#cbd5e1;color:var(--ink)}
  .or-scope .btn-print{background:var(--accent);border-color:var(--accent);color:#fff}
  .or-scope .btn-danger{background:var(--danger);border-color:var(--danger);color:#fff}
  .or-scope .btn-ico{padding:10px 12px;min-width:44px}

  /* ===== Table ===== */
  .or-scope .table-responsive{overflow:auto;border:1px solid var(--line);border-radius:16px;margin-top:10px}
  .or-scope table{width:100%;border-collapse:collapse;min-width:1100px;background:#fff}
  .or-scope thead th{
    background:#f8fafc;
    border-bottom:1px solid var(--line);
    padding:12px 10px;
    text-align:right;
    color:var(--ink);
    font-weight:900;
    white-space:nowrap;
  }
  .or-scope tbody td{
    border-bottom:1px solid var(--line);
    padding:12px 10px;
    vertical-align:top;
    color:var(--ink-soft);
    font-weight:800;
  }
  .or-scope tbody tr:hover{background:#f8fafc}
  .or-scope .muted{color:var(--muted);font-weight:800}
  .or-scope .text-center{text-align:center}

  /* Images in table */
  .or-scope .table-images{display:flex;gap:8px;flex-wrap:wrap}
  .or-scope .table-images img{
    width:54px;height:54px;object-fit:cover;border-radius:10px;
    border:1px solid var(--line);
    cursor:zoom-in;
    background:#f8fafc;
  }

  /* ===== Mobile Cards ===== */
  .or-scope .cards-view{display:grid;gap:12px;margin-top:10px}
  .or-scope .report-card{
    background:#fff;border:1px solid var(--line);
    border-radius:16px;box-shadow:var(--shadow);
    padding:14px;
    display:grid;
    gap:10px;
  }
  .or-scope .report-header{
    display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;
    font-weight:900;color:var(--ink);
  }
  .or-scope .report-program{margin:0;color:var(--muted);font-weight:900;line-height:1.7}
  .or-scope .report-idea{margin:0;color:var(--ink-soft);font-weight:800;line-height:1.9}
  .or-scope .report-images{display:flex;gap:8px;flex-wrap:wrap}
  .or-scope .report-images img{
    width:72px;height:72px;object-fit:cover;border-radius:12px;border:1px solid var(--line);cursor:zoom-in
  }
  .or-scope .card-actions{
    display:flex;gap:8px;flex-wrap:wrap;align-items:center
  }

  /* ===== Pagination ===== */
  .or-scope .pagination{
    display:flex;gap:10px;align-items:center;justify-content:center;
    margin-top:16px;flex-wrap:wrap
  }
  .or-scope .page-btn{
    padding:9px 14px;border:1px solid var(--line);
    border-radius:12px;background:#fff;color:var(--ink);
    text-decoration:none;font-weight:900;
  }
  .or-scope .page-current{color:var(--muted);font-weight:900}

  /* ===== Modal ===== */
  .or-scope .modal{
    display:none;
    position:fixed;inset:0;
    background:rgba(0,0,0,.6);
    z-index:2000;
    justify-content:center;align-items:center;
    padding:18px;
    overflow:auto;
  }
  .or-scope .modal-dialog{
    width:min(820px, 100%);
    background:#fff;
    border-radius:18px;
    border:1px solid var(--line);
    box-shadow:0 24px 80px rgba(0,0,0,.35);
    position:relative;
    padding:16px;
  }
  .or-scope .modal-close{
    position:absolute;top:12px;left:12px;
    width:42px;height:42px;border-radius:999px;
    border:1px solid #fecaca;
    background:#fee2e2;color:#991b1b;
    cursor:pointer;font-weight:900;
    display:grid;place-items:center;
  }
  .or-scope .modal-title{margin:0 0 10px 0;font-weight:900;color:var(--ink)}
  .or-scope .modal-idea{
    white-space:pre-line;
    margin:10px 0;
    font-size:15px;
    line-height:1.9;
    color:var(--ink-soft);
    padding:12px;
    background:#f8fafc;
    border:1px solid var(--line);
    border-radius:14px;
    overflow-wrap:anywhere;
  }
  .or-scope .modal-meta{
    display:grid;
    grid-template-columns:1fr;
    gap:6px;
    margin-top:8px;
    color:var(--muted);
    font-weight:900;
  }
  @media(min-width:720px){
    .or-scope .modal-meta{grid-template-columns:1fr 1fr}
  }
  .or-scope .modal-images{
    margin-top:14px;
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
    gap:12px;
  }
  .or-scope .modal-images img{
    width:100%;height:140px;object-fit:cover;border-radius:14px;
    border:1px solid var(--line);
    box-shadow:0 6px 16px rgba(0,0,0,.12);
    cursor:zoom-in;
    transition:transform .2s ease;
    background:#f8fafc;
  }
  .or-scope .modal-images img:hover{transform:scale(1.03)}

  /* ===== Responsive: hide/show ===== */
  .or-scope .desktop-only{display:block}
  .or-scope .mobile-only{display:none}
  @media(max-width: 860px){
    .or-scope .desktop-only{display:none}
    .or-scope .mobile-only{display:block}
  }
</style>
{% endblock %}

{% block content %}
<div class="or-scope" dir="rtl">
  <div class="wrap">

    <!-- Header -->
    <header class="page-head">
      <h1 class="title">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ â€“ ØªÙ‚Ø§Ø±ÙŠØ± Ù‚Ø³Ù…ÙŠ</h1>
      <p class="subtitle">
        Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù‚Ø³Ù…:
        <b>{% if department %}{{ department.name }}{% else %}â€”{% endif %}</b>
      </p>
    </header>

    <div class="card">

      <!-- Filters -->
      <form method="get" class="filters-form" novalidate>
        <div class="filters-grid">
          <div class="filter-group">
            <label>ğŸ“… Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
            <input type="date" name="start_date" value="{{ start_date }}" class="filter-input">
          </div>
          <div class="filter-group">
            <label>ğŸ“… Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
            <input type="date" name="end_date" value="{{ end_date }}" class="filter-input">
          </div>
          <div class="filter-group">
            <label>ğŸ‘¨â€ğŸ« Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</label>
            <input type="text" name="teacher_name" value="{{ teacher_name }}"
                   placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù… Ø£Ùˆ Ø¬Ø²Ø¡ Ù…Ù†Ù‡" class="filter-input">
          </div>

          {% if categories %}
          <div class="filter-group">
            <label>ğŸ·ï¸ Ø§Ù„ØªØµÙ†ÙŠÙ (Ø®Ø§Øµ Ø¨Ù‚Ø³Ù…ÙŠ)</label>
            <select name="category" class="filter-input">
              <option value="">ÙƒÙ„ ØªØµÙ†ÙŠÙØ§Øª Ù‚Ø³Ù…ÙŠ</option>
              {% for c_val, c_label in categories %}
                <option value="{{ c_val }}" {% if category == c_val %}selected{% endif %}>{{ c_label }}</option>
              {% endfor %}
            </select>
          </div>
          {% endif %}
        </div>

        <div class="filter-actions">
          <button class="btn btn-primary" type="submit">âœ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±</button>
          {% if start_date or end_date or teacher_name or category %}
            <a href="{{ request.path }}" class="btn btn-outline">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±</a>
          {% endif %}
        </div>
      </form>

      {# Ù†Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ querystring Ù„Ù„ØªØ±Ù‚ÙŠÙ… #}
      {% with qs="" %}
        {% if start_date %}{% with qs=qs|add:"&start_date="|add:start_date %}{% endwith %}{% endif %}
      {% endwith %}

      {% with qsp="" %}
        {% if start_date %}{% with qsp=qsp|add:"&start_date="|add:start_date %}{% endwith %}{% endif %}
        {% if end_date %}{% with qsp=qsp|add:"&end_date="|add:end_date %}{% endwith %}{% endif %}
        {% if teacher_name %}{% with qsp=qsp|add:"&teacher_name="|add:teacher_name|urlencode %}{% endwith %}{% endif %}
        {% if category %}{% with qsp=qsp|add:"&category="|add:category %}{% endwith %}{% endif %}

        <!-- Desktop Table -->
        <div class="table-responsive desktop-only">
          <table class="reports-table">
            <thead>
              <tr>
                <th>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                <th>ğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…</th>
                <th>ğŸ“– Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                <th>ğŸ·ï¸ Ø§Ù„ØªØµÙ†ÙŠÙ</th>
                <th>ğŸ‘¥ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ†</th>
                <th>ğŸ’¡ Ø§Ù„ÙÙƒØ±Ø©</th>
                <th>ğŸ–¼ Ø§Ù„ØµÙˆØ±</th>
                <th>âš™ï¸ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody>
              {% for r in reports %}
              <tr>
                <td>
                  {{ r.report_date|date:"Y-m-d" }}<br>
                  <small class="muted">{{ r.day_name|default_if_none:"" }}</small>
                </td>
                <td>{% firstof r.teacher_name r.teacher.name "â€”" %}</td>
                <td>{{ r.title|default:"â€”" }}</td>
                <td>
                  {% if r.category %}{{ r.category.name }}
                  {% else %}{{ r.get_category_display|default:r.category|default:"â€”" }}
                  {% endif %}
                </td>
                <td class="text-center">{{ r.beneficiaries_count|default_if_none:"â€”" }}</td>
                <td>
                  <textarea id="idea-{{ r.pk }}" style="display:none;">{{ r.idea|default_if_none:''|escape }}</textarea>
                  {{ r.idea|default_if_none:""|truncatewords:12 }}
                </td>
                <td>
                  <div class="table-images">
                    {% if r.image1 %}<img src="{{ r.image1.url }}" alt="ØµÙˆØ±Ø© 1" data-full="{{ r.image1.url }}">{% endif %}
                    {% if r.image2 %}<img src="{{ r.image2.url }}" alt="ØµÙˆØ±Ø© 2" data-full="{{ r.image2.url }}">{% endif %}
                    {% if r.image3 %}<img src="{{ r.image3.url }}" alt="ØµÙˆØ±Ø© 3" data-full="{{ r.image3.url }}">{% endif %}
                    {% if r.image4 %}<img src="{{ r.image4.url }}" alt="ØµÙˆØ±Ø© 4" data-full="{{ r.image4.url }}">{% endif %}
                  </div>
                </td>
                <td>
                  <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
                    <button class="btn btn-primary btn-ico js-show"
                            type="button"
                            data-idea-id="idea-{{ r.pk }}"
                            data-teacher="{% firstof r.teacher_name r.teacher.name '' %}"
                            data-program="{{ r.title|default_if_none:''|escapejs }}"
                            data-date="{{ r.report_date|date:'Y-m-d' }} - {{ r.day_name|default_if_none:''|escapejs }}"
                            data-images="{% if r.image1 %}{{ r.image1.url }}{% endif %}|{% if r.image2 %}{{ r.image2.url }}{% endif %}|{% if r.image3 %}{{ r.image3.url }}{% endif %}|{% if r.image4 %}{{ r.image4.url }}{% endif %}">
                      ğŸ‘
                    </button>

                    <a href="{% url 'reports:report_print' r.pk %}" target="_blank" rel="noopener" class="btn btn-print btn-ico">ğŸ–¨</a>

                    <form method="post" action="{% url 'reports:officer_delete_report' r.pk %}">
                      {% csrf_token %}
                      <input type="hidden" name="next" value="{{ request.get_full_path }}">
                      <button class="btn btn-danger btn-ico" type="submit" onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ');">ğŸ—‘</button>
                    </form>
                  </div>
                </td>
              </tr>
              {% empty %}
              <tr><td colspan="8" class="text-center muted" style="padding:18px">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ø¶Ù…Ù† Ù‚Ø³Ù…Ùƒ.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- Mobile Cards -->
        <div class="cards-view mobile-only">
          {% for r in reports %}
          <article class="report-card">
            <div class="report-header">
              <span>ğŸ“… {{ r.report_date|date:"Y-m-d" }} â€“ {{ r.day_name|default_if_none:"" }}</span>
              <span>ğŸ‘¨â€ğŸ« {% firstof r.teacher_name r.teacher.name "â€”" %}</span>
            </div>

            <p class="report-program">
              ğŸ“– {{ r.title|default:"â€”" }}
              | ğŸ·ï¸ {% if r.category %}{{ r.category.name }}{% else %}{{ r.get_category_display|default:r.category|default:"â€”" }}{% endif %}
              | ğŸ‘¥ {{ r.beneficiaries_count|default_if_none:"â€”" }}
            </p>

            <textarea id="idea-m-{{ r.pk }}" style="display:none;">{{ r.idea|default_if_none:''|escape }}</textarea>
            <p class="report-idea">{{ r.idea|default_if_none:""|truncatewords:20 }}</p>

            <div class="report-images">
              {% if r.image1 %}<img src="{{ r.image1.url }}" alt="img" data-full="{{ r.image1.url }}">{% endif %}
              {% if r.image2 %}<img src="{{ r.image2.url }}" alt="img" data-full="{{ r.image2.url }}">{% endif %}
              {% if r.image3 %}<img src="{{ r.image3.url }}" alt="img" data-full="{{ r.image3.url }}">{% endif %}
              {% if r.image4 %}<img src="{{ r.image4.url }}" alt="img" data-full="{{ r.image4.url }}">{% endif %}
            </div>

            <div class="card-actions">
              <button class="btn btn-primary js-show" type="button"
                      data-idea-id="idea-m-{{ r.pk }}"
                      data-teacher="{% firstof r.teacher_name r.teacher.name '' %}"
                      data-program="{{ r.title|default_if_none:''|escapejs }}"
                      data-date="{{ r.report_date|date:'Y-m-d' }} - {{ r.day_name|default_if_none:''|escapejs }}"
                      data-images="{% if r.image1 %}{{ r.image1.url }}{% endif %}|{% if r.image2 %}{{ r.image2.url }}{% endif %}|{% if r.image3 %}{{ r.image3.url }}{% endif %}|{% if r.image4 %}{{ r.image4.url }}{% endif %}">
                ğŸ‘ Ø¹Ø±Ø¶
              </button>

              <a href="{% url 'reports:report_print' r.pk %}" target="_blank" rel="noopener" class="btn btn-print">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</a>

              <form method="post" action="{% url 'reports:officer_delete_report' r.pk %}">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.get_full_path }}">
                <button class="btn btn-danger" type="submit" onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ');">ğŸ—‘ Ø­Ø°Ù</button>
              </form>
            </div>
          </article>
          {% empty %}
            <div class="muted" style="text-align:center;padding:18px">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ø¶Ù…Ù† Ù‚Ø³Ù…Ùƒ.</div>
          {% endfor %}
        </div>

        <!-- Pagination -->
        {% if reports.paginator and reports.paginator.num_pages > 1 %}
        <nav class="pagination" aria-label="ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª">
          {% if reports.has_previous %}
            <a class="page-btn" href="?page={{ reports.previous_page_number }}{{ qsp }}">Ø§Ù„Ø³Ø§Ø¨Ù‚</a>
          {% endif %}
          <span class="page-current">ØµÙØ­Ø© {{ reports.number }} Ù…Ù† {{ reports.paginator.num_pages }}</span>
          {% if reports.has_next %}
            <a class="page-btn" href="?page={{ reports.next_page_number }}{{ qsp }}">Ø§Ù„ØªØ§Ù„ÙŠ</a>
          {% endif %}
        </nav>
        {% endif %}
      {% endwith %}

    </div>
  </div>

  <!-- Modal -->
  <div id="ideaModal" class="modal" aria-hidden="true">
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-label="ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±">
      <button class="modal-close" type="button" aria-label="Ø¥ØºÙ„Ø§Ù‚">âœ•</button>
      <h2 class="modal-title">ğŸ’¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙƒØ§Ù…Ù„</h2>

      <div id="modalIdea" class="modal-idea"></div>

      <div class="modal-meta">
        <div>ğŸ‘¨â€ğŸ« <b>Ø§Ù„Ù…Ø¹Ù„Ù…:</b> <span id="modalTeacher"></span></div>
        <div>ğŸ“– <b>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</b> <span id="modalProgram"></span></div>
        <div>ğŸ“… <b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> <span id="modalDate"></span></div>
      </div>

      <div id="modalImages" class="modal-images"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  (function(){
    const modal = document.getElementById('ideaModal');
    const closeBtn = modal ? modal.querySelector('.modal-close') : null;
    const modalIdea = document.getElementById('modalIdea');
    const modalTeacher = document.getElementById('modalTeacher');
    const modalProgram = document.getElementById('modalProgram');
    const modalDate = document.getElementById('modalDate');
    const modalImages = document.getElementById('modalImages');

    if(!modal) return;

    function openModalFromBtn(btn){
      const ideaId = btn.getAttribute('data-idea-id');
      const ta = ideaId ? document.getElementById(ideaId) : null;
      let idea = ta ? ta.value : '';
      idea = (idea || '').replace(/\r/g, '');
      if(modalIdea) modalIdea.textContent = idea;

      if(modalTeacher) modalTeacher.textContent = btn.getAttribute('data-teacher') || '';
      if(modalProgram) modalProgram.textContent = btn.getAttribute('data-program') || '';
      if(modalDate) modalDate.textContent = btn.getAttribute('data-date') || '';

      if(modalImages){
        modalImages.innerHTML = '';
        const imgs = (btn.getAttribute('data-images') || '').split('|').map(s => (s || '').trim()).filter(Boolean);
        imgs.forEach(url => {
          const im = document.createElement('img');
          im.src = url;
          im.alt = 'ØµÙˆØ±Ø©';
          im.loading = 'lazy';
          im.setAttribute('data-full', url);
          modalImages.appendChild(im);
        });
      }

      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }

    function closeModal(){
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = 'auto';
      if(modalImages) modalImages.innerHTML = '';
    }

    document.querySelectorAll('.or-scope .js-show').forEach(btn => {
      btn.addEventListener('click', function(){ openModalFromBtn(btn); });
    });

    if(closeBtn) closeBtn.addEventListener('click', closeModal);
    window.addEventListener('click', function(e){
      if(e.target === modal) closeModal();
    });
    window.addEventListener('keydown', function(e){
      if(modal.style.display === 'flex' && e.key === 'Escape') closeModal();
    });

    // Lightbox for modal images
    document.addEventListener('click', function(e){
      const img = e.target;
      if(!img) return;
      if(!img.matches('#modalImages img')) return;

      const full = img.getAttribute('data-full') || img.src;
      const overlay = document.createElement('div');
      overlay.style.position = 'fixed';
      overlay.style.inset = '0';
      overlay.style.background = 'rgba(0,0,0,0.88)';
      overlay.style.display = 'flex';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '3000';
      overlay.innerHTML = '<img src="' + full + '" alt="preview" style="max-width:92%;max-height:92%;border-radius:14px;box-shadow:0 16px 60px rgba(0,0,0,.55)">';
      overlay.addEventListener('click', function(){ overlay.remove(); });
      document.body.appendChild(overlay);
    });

    // Click-to-zoom for thumbs in table/cards (optional)
    document.addEventListener('click', function(e){
      const img = e.target;
      if(!img) return;
      if(!img.matches('.table-images img') && !img.matches('.report-images img')) return;

      const full = img.getAttribute('data-full') || img.src;
      const overlay = document.createElement('div');
      overlay.style.position = 'fixed';
      overlay.style.inset = '0';
      overlay.style.background = 'rgba(0,0,0,0.88)';
      overlay.style.display = 'flex';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '3000';
      overlay.innerHTML = '<img src="' + full + '" alt="preview" style="max-width:92%;max-height:92%;border-radius:14px;box-shadow:0 16px 60px rgba(0,0,0,.55)">';
      overlay.addEventListener('click', function(){ overlay.remove(); });
      document.body.appendChild(overlay);
    });
  })();
</script>
{% endblock %}
