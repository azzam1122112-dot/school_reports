{% extends "base.html" %}
{% load static %}

{% block title %}تفاصيل عملية الدفع #{{ payment.id }}{% endblock %}

{% block head %}
<style>
  .pay-scope .row{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;padding:12px 0;border-bottom:1px solid var(--line-2)}
  .pay-scope .row:last-child{border-bottom:none}
  .pay-scope .label{font-weight:900;color:var(--muted)}
  .pay-scope .value{font-weight:950;color:var(--ink)}
  .pay-scope .img-preview{max-width:100%;border-radius:12px;border:1px solid var(--line-2);margin-top:10px;box-shadow:var(--shadow-sm)}
</style>
{% endblock %}

{% block content %}
<div class="container pay-scope" dir="rtl">
  <div class="page-head" style="max-width:980px;margin-inline:auto">
    <div>
      <h1 class="page-title">تفاصيل عملية الدفع #{{ payment.id }}</h1>
      <p class="page-subtitle">مراجعة بيانات الدفع واتخاذ الإجراء المناسب.</p>
    </div>
    <a href="{% url 'reports:platform_payments_list' %}" class="btn btn-outline">عودة للقائمة</a>
  </div>

  <div style="max-width:980px;margin-inline:auto">
    <div class="card">
      <div class="section-title">معلومات الدفع</div>
      <div class="row"><span class="label">المدرسة</span><span class="value">{{ payment.school.name }}</span></div>
      <div class="row"><span class="label">المبلغ</span><span class="value" style="color:var(--brand);font-size:1.15rem">{{ payment.amount }} ريال</span></div>
      <div class="row"><span class="label">التاريخ</span><span class="value">{{ payment.payment_date|date:"Y-m-d" }}</span></div>
      <div class="row"><span class="label">رقم العملية</span><span class="value" style="font-family:monospace">{{ payment.transaction_id|default:"-" }}</span></div>
      <div class="row">
        <span class="label">الحالة الحالية</span>
        <span class="value">
          {% if payment.status == 'approved' %}
            <span class="badge success">مقبول</span>
          {% elif payment.status == 'rejected' %}
            <span class="badge danger">مرفوض</span>
          {% else %}
            <span class="badge warning">قيد المراجعة</span>
          {% endif %}
        </span>
      </div>
      <div class="row"><span class="label">ملاحظات</span><span class="value">{{ payment.notes|default:"-" }}</span></div>
    </div>

    <div class="card">
      <div class="section-title">صورة الإيصال</div>
      {% if payment.receipt_image %}
        <a href="{{ payment.receipt_image.url }}" target="_blank" rel="noopener">
          <img src="{{ payment.receipt_image.url }}" class="img-preview" alt="إيصال الدفع">
        </a>
      {% else %}
        <div class="muted" style="padding:14px;text-align:center;font-weight:900">لا توجد صورة مرفقة</div>
      {% endif %}
    </div>

    <div class="card">
      <div class="section-title">إجراءات الإدارة</div>
      <form method="post" class="form-grid">
        {% csrf_token %}

        <div>
          <label style="display:block;font-weight:950;margin-bottom:6px;color:var(--ink)">تحديث الحالة</label>
          <select name="status" class="select">
            <option value="pending" {% if payment.status == 'pending' %}selected{% endif %}>قيد المراجعة</option>
            <option value="approved" {% if payment.status == 'approved' %}selected{% endif %}>قبول الدفع</option>
            <option value="rejected" {% if payment.status == 'rejected' %}selected{% endif %}>رفض الدفع</option>
          </select>
        </div>

        <div>
          <label style="display:block;font-weight:950;margin-bottom:6px;color:var(--ink)">ملاحظات الإدارة (تظهر للمدرسة)</label>
          <textarea name="notes" class="textarea" rows="3">{{ payment.notes }}</textarea>
        </div>

        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button type="submit" class="btn btn-primary" style="flex:1">حفظ التغييرات</button>
          <a href="{% url 'reports:platform_payments_list' %}" class="btn btn-outline">رجوع</a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
