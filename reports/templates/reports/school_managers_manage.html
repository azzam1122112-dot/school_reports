{% extends "base.html" %}
{% block title %}إدارة مدراء المدرسة{% endblock %}

{% block content %}
<div class="container" dir="rtl">
  <div class="page-head" style="max-width:900px;margin-inline:auto">
    <div>
      <h1 class="page-title">إدارة مدراء المدرسة</h1>
      <p class="page-subtitle">إضافة أو إزالة المدراء لهذه المدرسة.</p>
    </div>
    <a href="{% url 'reports:schools_admin_list' %}" class="btn btn-outline">عودة لقائمة المدارس</a>
  </div>

  <div style="max-width:900px;margin-inline:auto">
    <div class="card">
      <div style="margin-bottom:12px">
        <span class="badge info">المدرسة: {{ school.name }} — الكود: {{ school.code }}</span>
      </div>

      <div class="section-title">المدراء الحاليون</div>
      {% if managers %}
        <div class="table-responsive">
          <table class="rtable">
            <thead>
              <tr>
                <th>المدير</th>
                <th>إجراء</th>
              </tr>
            </thead>
            <tbody>
              {% for m in managers %}
              <tr>
                <td data-label="المدير"><b>{{ m.name }}</b></td>
                <td data-label="إجراء">
                  <form method="post" style="margin:0">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="remove">
                    <input type="hidden" name="teacher_id" value="{{ m.id }}">
                    <button type="submit" class="btn btn-danger" style="padding:8px 10px">إزالة من المدراء</button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="muted" style="font-weight:900">لا يوجد مدراء معيّنون لهذه المدرسة بعد.</div>
      {% endif %}

      <div style="height:12px"></div>

      <div class="section-title">إضافة مدير جديد</div>
      <form method="post" class="form-grid">
        {% csrf_token %}
        <input type="hidden" name="action" value="add">

        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
          <div style="flex:1;min-width:220px">
            <input type="search" id="managerSearch" placeholder="ابحث باسم المدير">
          </div>
          <div style="flex:2;min-width:260px">
            <select name="teacher_id" id="managerSelect" required>
              <option value="" disabled selected>اختر المعلّم ليصبح مديراً...</option>
              {% for t in teachers %}
                <option value="{{ t.id }}">{{ t.name }}</option>
              {% endfor %}
            </select>
          </div>
          <button type="submit" class="btn btn-primary">إضافة كمدير</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

  {% block scripts %}
  {{ block.super }}
  <script>
    (function(){
      const input = document.getElementById('managerSearch');
      const select = document.getElementById('managerSelect');
      if (!input || !select) return;
      const allOptions = Array.from(select.options).slice(1); // تخطي خيار العنوان

      input.addEventListener('input', function(){
        const q = (this.value || '').toLowerCase().trim();
        // إعادة جميع الخيارات ثم إخفاء غير المطابق
        select.innerHTML = '';
        const placeholder = document.createElement('option');
        placeholder.value = '';
        placeholder.disabled = true;
        placeholder.selected = true;
        placeholder.textContent = 'اختر المعلّم ليصبح مديراً...';
        select.appendChild(placeholder);

        allOptions.forEach(function(opt){
          const txt = (opt.textContent || '').toLowerCase();
          if (!q || txt.includes(q)) {
            select.appendChild(opt);
          }
        });
      });
    })();
  </script>
  {% endblock %}
