{# templates/reports/departments_list.html (Ø£Ùˆ Ø§Ø³Ù… Ù…Ù„ÙÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠ) #}
{% extends "base.html" %}
{% block title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…{% endblock %}

{% block head %}
<style>
  .deptlist-scope{
    --ink:#0f172a;--muted:#6b7280;--line:#e5e7eb;--line2:#f1f5f9;--card:#fff;--bg:#f8fafc;
    --brand:#2563eb;--brand2:#3b82f6;--danger:#ef4444;--danger-bg:#fee2e2;--danger-border:#fecaca;
    --radius:14px;--shadow:0 10px 30px rgba(2,6,23,.08);--tap:48px;--t:all .2s ease;
  }
  @media (prefers-color-scheme:dark){
    .deptlist-scope{
      --ink:#e6ebff;--muted:#a9b8de;--line:#1b2744;--line2:#152547;--card:#0f1629;--bg:#0b1220;
      --danger-bg:#2a0f14;--danger-border:#4a151c;
    }
  }

  .deptlist-scope .wrap{max-width:1100px;margin:0 auto;padding:clamp(10px,2.2vw,14px)}
  .deptlist-scope .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:clamp(12px,2vw,16px)}
  .deptlist-scope .title{margin:0 0 10px;font-weight:950;color:var(--ink);display:flex;align-items:center;gap:8px;flex-wrap:wrap;font-size:1.05rem}
  .deptlist-scope .title .hint{font-size:.9rem;color:var(--muted);font-weight:800}

  .deptlist-scope .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:0 0 12px;align-items:center}
  .deptlist-scope .btn{
    min-height:var(--tap);display:inline-flex;align-items:center;justify-content:center;gap:8px;
    padding:10px 14px;border-radius:12px;border:1px solid var(--line);
    background:var(--card);font-weight:900;text-decoration:none;color:var(--ink);
    transition:transform .18s ease, box-shadow .18s ease, filter .18s ease
  }
  .deptlist-scope .btn:hover{transform:translateY(-1px)}
  .deptlist-scope .btn:focus-visible{outline:2px solid var(--brand);outline-offset:2px;box-shadow:0 0 0 3px rgba(37,99,235,.25)}
  .deptlist-scope .btn-primary{background:linear-gradient(135deg,var(--brand),var(--brand2));border-color:transparent;color:#fff}
  .deptlist-scope .btn-danger{background:var(--danger-bg);color:#991b1b;border-color:var(--danger-border)}
  @media (prefers-color-scheme:dark){.deptlist-scope .btn-danger{color:#fecaca}}

  .deptlist-scope .count-badge{
    display:inline-flex;align-items:center;gap:6px;
    background:#eef2ff;border:1px solid #e5edff;color:#1e40af;border-radius:999px;
    padding:6px 10px;font-weight:950
  }
  @media (prefers-color-scheme:dark){.deptlist-scope .count-badge{background:#0e1b36;border-color:#1e2e59;color:#cdd9ff}}

  .deptlist-scope .table-headnote{display:flex;flex-wrap:wrap;align-items:center;gap:10px;justify-content:space-between;margin-bottom:8px}
  .deptlist-scope .muted{color:var(--muted);font-weight:800}

  .deptlist-scope .table-wrap{overflow:auto;border:1px solid var(--line);border-radius:12px;background:var(--card)}
  .deptlist-scope .table-wrap{-webkit-overflow-scrolling:touch}
  .deptlist-scope .table-wrap::-webkit-scrollbar{height:10px}
  .deptlist-scope .table-wrap::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:999px}
  @media (prefers-color-scheme:dark){.deptlist-scope .table-wrap::-webkit-scrollbar-thumb{background:#374b7a}}

  .deptlist-scope table{width:100%;border-collapse:collapse}
  .deptlist-scope caption{display:none}
  .deptlist-scope th,.deptlist-scope td{padding:12px 10px;border-bottom:1px solid var(--line);white-space:nowrap;vertical-align:middle}
  .deptlist-scope thead th{background:#f8fafc;text-align:right;font-weight:950;position:sticky;top:0;z-index:1}
  @media (prefers-color-scheme:dark){.deptlist-scope thead th{background:#0e1b35}}
  .deptlist-scope td code{direction:ltr;unicode-bidi:embed}

  .deptlist-scope .pill{
    display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;
    border:1px solid var(--line);background:#f8fafc;font-weight:900;white-space:nowrap
  }
  .deptlist-scope .pill.on{background:linear-gradient(180deg,#ecfdf5,#ffffff);border-color:#c7f3e3;color:#065f46}
  .deptlist-scope .pill.off{background:#fff7ed;border-color:#fed7aa;color:#7c2d12}
  @media (prefers-color-scheme:dark){
    .deptlist-scope .pill{background:#0e1b35;border-color:#1e2e59}
    .deptlist-scope .pill.on{background:#0f2b22;border-color:#134e4a;color:#a7f3d0}
    .deptlist-scope .pill.off{background:#2b1b0f;border-color:#4a2e14;color:#fed7aa}
  }

  .deptlist-scope .actions{display:flex;gap:8px;flex-wrap:wrap}
  .deptlist-scope .actions .btn{padding:8px 12px;min-height:40px}

  /* Mobile cards (â‰¤820px) */
  @media (max-width: 820px){
    .deptlist-scope .table-wrap{border:none;padding:0}
    .deptlist-scope table, .deptlist-scope thead, .deptlist-scope tbody, .deptlist-scope th, .deptlist-scope td, .deptlist-scope tr{display:block;width:100%}
    .deptlist-scope thead{display:none}
    .deptlist-scope tbody{display:grid;gap:12px}
    .deptlist-scope tr{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:var(--card)}
    .deptlist-scope td{
      display:grid;grid-template-columns:9.5em 1fr;gap:8px;
      border:0;border-bottom:1px solid var(--line);
      padding:12px 14px;white-space:normal;word-break:break-word
    }
    .deptlist-scope td:last-child{border-bottom:0}
    .deptlist-scope td::before{content:attr(data-th);font-weight:950;color:var(--muted)}
    .deptlist-scope .actions{padding:10px;border-top:1px dashed var(--line)}
    .deptlist-scope .actions .btn{flex:1 1 auto}
  }
  @media (max-width:420px){
    .deptlist-scope td{grid-template-columns:7.5em 1fr}
  }
</style>
{% endblock %}

{% block content %}
<div class="deptlist-scope">
  <div class="wrap" dir="rtl">
    <div class="card" role="region" aria-labelledby="dept-title">
      <div class="title" id="dept-title">
        <span>ğŸ·ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</span>
        <span class="hint">Ø¥Ø¶Ø§ÙØ©ØŒ ØªØ¹Ø¯ÙŠÙ„ØŒ Ø­Ø°ÙØŒ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø£Ø¹Ø¶Ø§Ø¡ ÙƒÙ„ Ù‚Ø³Ù…</span>
      </div>

      <div class="toolbar" role="toolbar" aria-label="Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª">
        <a class="btn btn-primary" href="{% url 'reports:department_create' %}">â• Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯</a>
        <span class="count-badge" aria-live="polite">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…: <b>{{ departments|length|default:"0" }}</b></span>
      </div>

      <div class="table-headnote">
        <span class="muted">Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ Ø³ØªØ¸Ù‡Ø± ÙƒØ¨Ø·Ø§Ù‚Ø§Øª. Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙˆØ§Ø³Ø¹Ø© ÙŠØ¨Ù‚Ù‰ Ø¬Ø¯ÙˆÙ„Ù‹Ø§ ÙˆÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø£ÙÙ‚ÙŠÙ‹Ø§ Ø¥Ø°Ø§ Ù„Ø²Ù….</span>
      </div>

      <div class="table-wrap" tabindex="0" aria-label="Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… â€” Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ…Ø±ÙŠØ±">
        <table>
          <caption>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</caption>
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Ø§Ù„ÙƒÙˆØ¯ (slug)</th>
              <th scope="col">Ø§Ù„Ø§Ø³Ù…</th>
              <th scope="col">Ø§Ù„Ø­Ø§Ù„Ø©</th>
              <th scope="col">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</th>
              <th scope="col">Ø§Ù„ØªØ°Ø§ÙƒØ± (Ø¬Ù€Ø¯ÙŠØ¯Ø© / Ù‚ÙŠØ¯ / Ù…Ù†Ø¬Ø²Ø©)</th>
              <th scope="col">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>

          <tbody>
            {% for d in departments %}
              {% with code=d.slug|default:d.code %}
              <tr>
                <td data-th="#" aria-label="Ø§Ù„ØªØ±ØªÙŠØ¨">{{ forloop.counter }}</td>

                <td data-th="Ø§Ù„ÙƒÙˆØ¯ (slug)"><code>{{ code|default:"â€”" }}</code></td>

                <td data-th="Ø§Ù„Ø§Ø³Ù…">{{ d.name|default:"â€”" }}</td>

                <td data-th="Ø§Ù„Ø­Ø§Ù„Ø©">
                  {% if d.is_active %}
                    <span class="pill on" aria-label="Ù†Ø´Ø·" title="Ù†Ø´Ø·">âœ… Ù†Ø´Ø·</span>
                  {% else %}
                    <span class="pill off" aria-label="Ù…ÙˆÙ‚Ù‘Ù" title="Ù…ÙˆÙ‚Ù‘Ù">â›” Ù…ÙˆÙ‚Ù‘Ù</span>
                  {% endif %}
                </td>

                <td data-th="Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡">{{ d.members_count|default:"0" }}</td>

                <td data-th="Ø­Ø§Ù„Ø© Ø§Ù„ØªØ°Ø§ÙƒØ±" class="muted">
                  {{ d.stats.open|default:"0" }} /
                  {{ d.stats.in_progress|default:"0" }} /
                  {{ d.stats.done|default:"0" }}
                </td>

                <td data-th="Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª">
                  <div class="actions" role="group" aria-label="Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù‚Ø³Ù…">
                    <a class="btn" href="{% url 'reports:department_members' code=code %}">ğŸ‘¥ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</a>
                    <a class="btn" href="{% url 'reports:department_edit' code=code %}">âœï¸ ØªØ¹Ø¯ÙŠÙ„</a>
                    <form action="{% url 'reports:department_delete' code=code %}" method="post" style="display:inline" onsubmit="return confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…ØŸ');">
                      {% csrf_token %}
                      <button class="btn btn-danger" type="submit">ğŸ—‘ Ø­Ø°Ù</button>
                    </form>
                  </div>
                </td>
              </tr>
              {% endwith %}
            {% empty %}
              <tr>
                <td data-th="Ù…Ù„Ø§Ø­Ø¸Ø©" colspan="7" class="muted" style="text-align:center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù….</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
