{# reports/templates/reports/support_tickets.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ{% endblock %}

{% block head %}
<style>
  /* ===== Scoped: Support Tickets (Ù„Ø§ ÙŠÙ„Ù…Ø³ .btn/.card Ø§Ù„Ø¹Ø§Ù…Ø©) ===== */
  .support-scope .wrap{max-width:1100px;margin:0 auto;padding:20px 12px}

  .support-scope .hero{
    border-radius:22px;
    color:#fff;
    padding:18px 20px;
    box-shadow: var(--shadow, 0 18px 50px rgba(2,6,23,.10));
    background:
      radial-gradient(900px 380px at 15% 10%, rgba(255,255,255,.16), transparent 55%),
      linear-gradient(135deg, var(--brand, #2563eb), #0ea5e9);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:14px;
    flex-wrap:wrap;
    border: 1px solid rgba(255,255,255,.16);
  }
  .support-scope .hero .title{
    margin:0;
    font-weight:950;
    font-size:1.55rem;
    display:flex;
    align-items:center;
    gap:10px;
    letter-spacing: -.3px;
  }
  .support-scope .hero .sub{
    margin:6px 0 0;
    font-weight:800;
    opacity:.92;
  }

  .support-scope .btnx{
    border:1px solid rgba(255,255,255,.25);
    border-radius:14px;
    background:rgba(255,255,255,.14);
    color:#fff;
    font-weight:900;
    padding:10px 14px;
    min-height:44px;
    cursor:pointer;
    text-decoration:none;
    display:inline-flex;
    align-items:center;
    gap:8px;
    backdrop-filter:saturate(160%) blur(8px);
    -webkit-backdrop-filter:saturate(160%) blur(8px);
    transition:transform .15s ease, filter .15s ease, box-shadow .15s ease;
    white-space:nowrap;
    outline:none;
  }
  .support-scope .btnx:hover{transform:translateY(-1px);filter:brightness(1.02)}
  .support-scope .btnx:focus-visible{box-shadow:0 0 0 4px rgba(255,255,255,.22)}
  .support-scope .btnx.primary{
    background:#ffffff;
    color:#1e3a8a;
    border-color:#ffffff;
  }

  /* Toolbar */
  .support-scope .toolbar{
    margin-top:14px;
    background:var(--card);
    border:1px solid var(--line);
    border-radius:18px;
    box-shadow: var(--shadow, 0 18px 50px rgba(2,6,23,.10));
    padding:12px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }
  .support-scope .input{
    border:1px solid var(--line);
    border-radius:14px;
    background:var(--card);
    color:var(--ink);
    padding:10px 12px;
    font-size:.95rem;
    min-height:44px;
    min-width:min(380px, 100%);
    outline:none;
  }
  .support-scope .input::placeholder{color:color-mix(in srgb, var(--muted) 80%, transparent)}
  .support-scope .input:focus{
    border-color: rgba(37,99,235,.45);
    box-shadow: 0 0 0 4px rgba(37,99,235,.14);
  }

  .support-scope .toolbar .meta{
    margin-inline-start:auto;
    color:var(--muted);
    font-weight:900;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }

  /* List */
  .support-scope .list{margin-top:12px;display:grid;gap:12px}
  .support-scope .item{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:16px;
    box-shadow: var(--shadow, 0 18px 50px rgba(2,6,23,.10));
    padding:14px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:14px;
    text-decoration:none;
    color:inherit;
    position:relative;
    overflow:hidden;
    transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease, background .15s ease;
  }
  .support-scope .item:hover{
    transform:translateY(-2px);
    box-shadow:0 14px 40px rgba(2,6,23,.12);
    border-color:#c7d2fe;
    background: color-mix(in srgb, var(--card) 92%, #dbeafe 8%);
  }
  .support-scope .item:focus-visible{
    outline:none;
    box-shadow:0 0 0 4px rgba(37,99,235,.14), 0 14px 40px rgba(2,6,23,.12);
    border-color: rgba(37,99,235,.45);
  }
  .support-scope .item::after{
    content:"";
    position:absolute;
    top:0;bottom:0;
    inset-inline-start:0;
    width:6px;
    background:rgba(148,163,184,.55);
  }

  .support-scope .left{display:grid;gap:6px;min-width:0}
  .support-scope .row1{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .support-scope .tid{
    background:#eef2ff;
    border:1px solid #c7d2fe;
    color:#1e40af;
    border-radius:999px;
    padding:6px 10px;
    font-weight:900;
    font-size:.85rem;
    white-space:nowrap;
  }
  html[data-theme="dark"] .support-scope .tid{
    background: rgba(99,102,241,.14);
    border-color: rgba(99,102,241,.28);
    color: #c7d2fe;
  }

  .support-scope .t-title{
    margin:0;
    font-weight:950;
    font-size:1.08rem;
    color:var(--ink);
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
    max-width:820px;
  }
  .support-scope .date{
    color:var(--muted);
    font-weight:900;
    font-size:.92rem;
    white-space:nowrap;
  }

  /* Status badge */
  .support-scope .badge{
    --bg:#f1f5f9; --fg:#0f172a; --bd:#e2e8f0;
    background:var(--bg);
    color:var(--fg);
    border:1px solid var(--bd);
    padding:10px 14px;
    border-radius:14px;
    font-weight:950;
    display:inline-flex;
    align-items:center;
    gap:8px;
    white-space:nowrap;
  }
  .support-scope .b-open{--bg:#ecfdf5;--fg:#065f46;--bd:#a7f3d0}
  .support-scope .b-in{--bg:#fef3c7;--fg:#92400e;--bd:#fde68a}
  .support-scope .b-done{--bg:#e0f2fe;--fg:#075985;--bd:#bae6fd}
  .support-scope .b-rej{--bg:#fee2e2;--fg:#991b1b;--bd:#fecaca}

  .support-scope .item.state-open::after{background:#10b981}
  .support-scope .item.state-in::after{background:#f59e0b}
  .support-scope .item.state-done::after{background:#2563eb}
  .support-scope .item.state-rej::after{background:#ef4444}

  /* Empty */
  .support-scope .empty{
    margin-top:12px;
    border:1px dashed var(--line);
    border-radius:18px;
    background: linear-gradient(180deg, var(--card), var(--line-2));
    padding:22px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    color:var(--muted);
    font-weight:900;
    flex-wrap:wrap;
  }
  .support-scope .empty .big{font-size:1.1rem;color:var(--ink);font-weight:950}
  .support-scope .empty .sub{font-weight:800;margin-top:4px}
  .support-scope .empty .spark{
    width:52px;height:52px;border-radius:18px;
    display:grid;place-items:center;
    background:rgba(37,99,235,.08);
    border:1px solid rgba(37,99,235,.18);
    color:var(--brand, #2563eb);
    font-size:1.2rem;
  }

  @media(max-width:680px){
    .support-scope .t-title{max-width:420px}
    .support-scope .toolbar .meta{width:100%;margin-inline-start:0;justify-content:space-between}
  }

  @media (prefers-reduced-motion: reduce){
    .support-scope .btnx,
    .support-scope .item{
      transition:none !important;
    }
    .support-scope .btnx:hover,
    .support-scope .item:hover{
      transform:none !important;
    }
  }
</style>
{% endblock %}

{% block content %}
  {{ block.super }}

  <div class="support-scope">
    <div class="wrap" dir="rtl">

      <!-- Hero -->
      <section class="hero" aria-label="ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ">
        <div>
          <h1 class="title"><i class="fa-solid fa-life-ring" aria-hidden="true"></i> ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</h1>
          <p class="sub">Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨Ø§ØªÙƒ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØµØ©</p>
        </div>

        <a href="{% url 'reports:support_ticket_create' %}" class="btnx primary">
          <i class="fa-solid fa-plus" aria-hidden="true"></i> Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
        </a>
      </section>

      <!-- Toolbar -->
      <form class="toolbar" method="get" role="search" aria-label="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ØªØ°Ø§ÙƒØ±">
        <input
          class="input"
          type="search"
          name="q"
          placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ØªØ°Ø§ÙƒØ±â€¦"
          value="{% firstof request.GET.q "" %}"
          autocomplete="off"
        >
        <button class="btnx" type="submit">
          <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i> Ø¨Ø­Ø«
        </button>

        {% if request.GET.q %}
          <a class="btnx" href="{% url 'reports:support_tickets' %}">
            <i class="fa-solid fa-rotate-left" aria-hidden="true"></i> Ù…Ø³Ø­
          </a>
        {% endif %}

        <div class="meta" aria-label="Ø¥Ø­ØµØ§Ø¡Ø§Øª">
          <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <b style="color:var(--ink)">{{ tickets|length }}</b></span>
        </div>
      </form>

      {% if tickets %}
        <section class="list" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ°Ø§ÙƒØ±">
          {% for ticket in tickets %}
            <a
              href="{% url 'reports:ticket_detail' ticket.pk %}"
              class="item
                {% if ticket.status == 'open' or ticket.status == 'new' %}state-open
                {% elif ticket.status == 'in_progress' or ticket.status == 'pending' %}state-in
                {% elif ticket.status == 'done' %}state-done
                {% else %}state-rej{% endif %}"
              aria-label="ÙØªØ­ Ø§Ù„ØªØ°ÙƒØ±Ø© Ø±Ù‚Ù… {{ ticket.pk }}"
            >
              <div class="left">
                <div class="row1">
                  <span class="tid">#{{ ticket.pk }}</span>
                  <h3 class="t-title">{{ ticket.title|default:"ØªØ°ÙƒØ±Ø© Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†" }}</h3>
                </div>
                <div class="date">ğŸ“… {{ ticket.created_at|date:"Y-m-d H:i" }}</div>
              </div>

              <div class="right">
                <span class="badge
                  {% if ticket.status == 'open' or ticket.status == 'new' %}b-open
                  {% elif ticket.status == 'in_progress' or ticket.status == 'pending' %}b-in
                  {% elif ticket.status == 'done' %}b-done
                  {% else %}b-rej{% endif %}">
                  {% if ticket.status == 'open' or ticket.status == 'new' %}
                    âœ… Ø¬Ø¯ÙŠØ¯
                  {% elif ticket.status == 'in_progress' or ticket.status == 'pending' %}
                    â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
                  {% elif ticket.status == 'done' %}
                    ğŸ‰ Ù…ÙƒØªÙ…Ù„
                  {% else %}
                    â›” {{ ticket.get_status_display|default:ticket.status }}
                  {% endif %}
                </span>
              </div>
            </a>
          {% endfor %}
        </section>
      {% else %}
        <div class="empty" role="status" aria-live="polite">
          <div>
            <div class="big">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°Ø§ÙƒØ± Ø¯Ø¹Ù… ÙÙ†ÙŠ</div>
            <div class="sub">Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠ Ø·Ù„Ø¨ Ø¯Ø¹Ù… ÙÙ†ÙŠ Ø¨Ø¹Ø¯. Ø§Ø¶ØºØ· â€œØ·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯â€ Ù„ÙØªØ­ ØªØ°ÙƒØ±Ø©.</div>
          </div>
          <div class="spark"><i class="fa-regular fa-envelope" aria-hidden="true"></i></div>
        </div>
      {% endif %}

    </div>
  </div>
{% endblock %}
