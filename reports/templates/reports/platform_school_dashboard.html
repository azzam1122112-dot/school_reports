{% extends 'base.html' %}
{% load static humanize %}

{% block title %}المشرف العام - المدرسة{% endblock %}

{% block head %}
<style>
    /* Clean Supervisor View */
    .supervisor-container {
        padding: 2rem;
        max-width: 1400px;
        margin: 0 auto;
    }
    .sup-header {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .school-title h1 {
        font-size: 1.5rem;
        font-weight: 800;
        margin: 0;
        color: #1e293b;
    }
    .badge-role {
        background: #f1f5f9;
        color: #64748b;
        padding: 0.25rem 0.75rem;
        border-radius: 99px;
        font-size: 0.8rem;
        vertical-align: middle;
        margin-right: 0.5rem;
    }
    
    .grid-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }
    
    .card-sup {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        border: 1px solid #e2e8f0;
    }
    .card-sup h3 { font-size: 1rem; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 700; margin-top: 0; }
    
    .big-num { font-size: 2.5rem; font-weight: 800; color: #0f172a; margin: 0.5rem 0; }
    
    .action-row {
        margin-top: 2rem;
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }
    
    .btn-sup {
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: white;
        border: 1px solid #cbd5e1;
        color: #334155;
        transition: all 0.2s;
    }
    .btn-sup:hover {
        background: #f8fafc;
        border-color: #94a3b8;
    }
    .btn-sup.primary {
        background: #0f172a;
        color: white;
        border-color: #0f172a;
    }
    .btn-sup.primary:hover {
        background: #1e293b;
    }
</style>
{% endblock %}

{% block content %}
<div class="supervisor-container">
    <div class="sup-header">
        <div class="school-title">
            <span class="badge-role">لوحة المشرف العام</span>
            <h1>{{ school.name }}</h1>
        </div>
        <div>
            <a href="{% url 'reports:platform_schools_directory' %}" class="btn-sup">
                <i class="fas fa-arrow-right"></i> العودة للقائمة
            </a>
        </div>
    </div>

    <div class="grid-cards">
        <div class="card-sup">
            <h3>التقارير</h3>
            <div class="big-num">{{ school.reports.count }}</div>
            <p style="color:#64748b; font-size:0.9rem">إجمالي التقارير المرفوعة</p>
        </div>
        <div class="card-sup">
            <h3>المعلمين</h3>
            <div class="big-num">{{ school.memberships.count }}</div>
            <p style="color:#64748b; font-size:0.9rem">أعضاء الهيئة التعليمية</p>
        </div>
        <div class="card-sup">
            <h3>حالة الاشتراك</h3>
            <div class="big-num" style="font-size:1.5rem;">
                {% if subscription %}
                    {% if subscription.is_cancelled %}
                        <span style="color:#ef4444;">ملغي</span>
                    {% elif subscription.is_expired %}
                        <span style="color:#f59e0b;">منتهي</span>
                    {% elif subscription.is_active %}
                        <span style="color:#10b981;">نشط</span>
                    {% else %}
                        <span style="color:#64748b;">غير نشط</span>
                    {% endif %}
                {% else %}
                    <span style="color:#64748b;">غير مشترك</span>
                {% endif %}
            </div>
            <p style="color:#64748b; font-size:0.9rem">
                ينتهي: {% if subscription and subscription.end_date %}{{ subscription.end_date|date:"Y-m-d" }}{% else %}-{% endif %}
            </p>
        </div>
    </div>

    <div class="action-row">
        <a href="{% url 'reports:platform_school_reports' %}" class="btn-sup primary">
            <i class="fas fa-file-alt"></i> استعراض التقارير
        </a>
        <a href="{% url 'reports:platform_school_tickets' %}" class="btn-sup">
            <i class="fas fa-ticket-alt"></i> متابعة التذاكر
        </a>
        <a href="{% url 'reports:platform_school_notify' %}" class="btn-sup">
            <i class="fas fa-bell"></i> إرسال إشعار
        </a>

        <a href="{% url 'reports:circulars_create' %}" class="btn-sup">
            <i class="fas fa-pen-to-square"></i> إرسال تعميم
        </a>
        <a href="{% url 'reports:circulars_sent' %}" class="btn-sup">
            <i class="fas fa-box-archive"></i> متابعة التعاميم
        </a>
        <a href="{% url 'reports:notifications_sent' %}" class="btn-sup">
            <i class="fas fa-paper-plane"></i> الإشعارات المرسلة
        </a>
    </div>

    <!-- Alert Section -->
    <div style="margin-top:3rem; padding: 2rem; background: #fffbeb; border: 1px solid #fcd34d; border-radius: 12px; color: #92400e;">
        <h4 style="margin:0 0 0.5rem 0; font-weight:700"><i class="fas fa-info-circle"></i> ملاحظات المشرف</h4>
        <p style="margin:0; font-size:0.95rem;">
            تأكد من متابعة مؤشرات الأداء بشكل دوري. في حال انخفاض عدد التقارير عن المعدل الطبيعي، يرجى التواصل مع إدارة المدرسة.
        </p>
    </div>
</div>
{% endblock %}
